# 电子保单创建功能使用指南

## 功能概述

在运单详情页面中，用户可以批量选择车辆并创建电子保单。该功能采用两步操作流程，确保保单信息的完整性和准确性。

## 主要功能特性

### 1. 两步操作流程
- **第一步**：选择保险生效起期，展示车辆保险信息
- **第二步**：填写投被保信息，完成保单创建

### 2. 智能数据计算
- **保额计算**：自动按合同价的80%计算保额
- **保险金额**：自动按合同价的0.8%计算保险金额
- **保险期限**：选择起期后自动计算3个月的保险期限

### 3. 完整的表单验证
- 必填字段验证
- 手机号格式验证
- 统一社会信用代码验证

## 使用流程

### 步骤1：选择车辆并触发创建
1. 在运单详情页面的车辆信息表格中选择需要创建保单的车辆
2. 点击"创建保单"按钮
3. 系统弹出"创建电子保单"模态框

### 步骤2：第一步 - 选择保险起期
1. **选择保险生效起期**：
   - 点击日期选择器选择保险生效日期
   - 不能选择过去的日期
   - 选择后系统自动计算保险终期（起期+3个月）

2. **查看车辆保险信息表格**：
   - 序号：车辆序号
   - 车架号：车辆识别码
   - 车辆属性：车型、内外饰信息
   - 起始地：车辆起始位置
   - 目的地：目标仓库
   - 合同价(万元)：车辆合同价格
   - 保额：按合同价80%自动计算
   - 保险金额(万元)：按合同价0.8%自动计算
   - 保险起期：根据选择的生效起期自动填充
   - 保险终期：起期后3个月自动计算

3. **确认信息**：
   - 检查车辆信息是否正确
   - 确认保险起期和终期
   - 点击"下一步"继续

### 步骤3：第二步 - 投被保信息
填写完整的投被保信息：

#### 基本信息
- **对象类型**：选择企业或个人

#### 被投保人信息
- **被投保人**：被保险人名称
- **统一社会信用代码**：被保险人信用代码
- **被投保联系人**：联系人姓名
- **联系电话**：有效的手机号码

#### 投保人信息
- **投保人**：投保人名称
- **统一社会信用代码**：投保人信用代码
- **投保联系人**：联系人姓名
- **联系电话**：有效的手机号码

### 步骤4：创建保单
1. 填写完所有必填信息
2. 点击"创建"按钮
3. 系统处理保单创建请求
4. 显示创建成功提示
5. 自动关闭模态框并刷新数据

## 界面设计

### 步骤条
```
[1] 选择保险起期 ——————— [2] 投被保信息
```

### 第一步界面布局
```
┌─────────────────────────────────────────┐
│ 保险生效起期: [日期选择器] 提示信息        │
├─────────────────────────────────────────┤
│ 车辆保险信息表格                         │
│ ┌─────┬─────┬─────┬─────┬─────┬─────┐  │
│ │序号 │车架号│车辆属性│起始地│目的地│...│  │
│ └─────┴─────┴─────┴─────┴─────┴─────┘  │
├─────────────────────────────────────────┤
│                     [关闭] [下一步]      │
└─────────────────────────────────────────┘
```

### 第二步界面布局
```
┌─────────────────────────────────────────┐
│ 投被保信息                               │
│ ┌─────────────────────────────────────┐ │
│ │ 对象类型: [下拉选择]                 │ │
│ │ 被投保人: [输入框] 信用代码: [输入框] │ │
│ │ 联系人: [输入框]   电话: [输入框]    │ │
│ │ 投保人: [输入框]   信用代码: [输入框] │ │
│ │ 联系人: [输入框]   电话: [输入框]    │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│                [关闭] [上一步] [创建]    │
└─────────────────────────────────────────┘
```

## 技术实现

### 核心组件
```typescript
// 保单Modal组件
<InsuranceModal
  visible={insuranceModalVisible}
  onCancel={handleInsuranceModalClose}
  selectedVehicles={selectedVehicles}
  onSuccess={handleInsuranceSuccess}
/>
```

### 数据结构
```typescript
// 车辆保险信息
interface VehicleInsuranceInfo {
  id: string;
  vin: string;
  vehicleAttribute: string;
  startLocation: string;
  endLocation: string;
  contractPrice: number;
  insuranceAmount: number;
  insurancePremium: number;
  insuranceStartDate?: string;
  insuranceEndDate?: string;
}

// 投被保信息
interface InsurancePartyInfo {
  objectType: string;
  insuredName: string;
  insuredCreditCode: string;
  insuredContact: string;
  insuredPhone: string;
  applicantName: string;
  applicantCreditCode: string;
  applicantContact: string;
  applicantPhone: string;
}
```

### API接口
```typescript
// 创建保单API
createVehicleInsurance({
  vehicleIds: string[];
  effectiveDate: string;
  insuranceInfo: InsurancePartyInfo;
})
```

## 数据计算规则

### 保险金额计算
- **保额** = 合同价 × 80%
- **保险金额** = 合同价 × 0.8%
- **保险期限** = 生效起期 + 3个月

### 格式要求
- **日期格式**：YYYY-MM-DD
- **金额格式**：万元为单位，保留2位小数
- **手机号格式**：11位数字，1开头

## 注意事项

### ⚠️ 重要提醒
1. **数据准确性**：请确保车辆信息和投被保信息的准确性
2. **保险起期**：不能选择过去的日期
3. **必填信息**：所有标记为必填的字段都必须填写
4. **联系方式**：请填写有效的联系电话

### 最佳实践
1. **分批处理**：建议一次处理的车辆数量不超过20辆
2. **信息确认**：在每一步都仔细确认信息的准确性
3. **网络稳定**：确保网络连接稳定，避免数据丢失
4. **及时保存**：填写完信息后及时提交

## 相关文件

- `src/components/InsuranceModal/index.tsx` - 保单Modal组件
- `src/components/InsuranceModal/index.module.less` - 组件样式
- `src/pages/Waybill/WaybillDetail/index.tsx` - 运单详情页面
- `src/services/waybill.ts` - API服务接口

## 更新日志

### v1.0 初始功能
- ✅ 两步操作流程
- ✅ 保险起期选择和自动计算
- ✅ 车辆保险信息展示
- ✅ 投被保信息表单
- ✅ 完整的表单验证
- ✅ 响应式界面设计
- ✅ 数据自动计算功能 
# 提车完成功能使用指南

## 功能概述

在运单详情页面的车辆信息表格中，用户可以批量选择车辆并执行"完成提车"操作。该功能会弹出专门的模态框，要求用户填写提车完成时间和预计到达时间。

## 主要功能特性

### 1. 批量选择车辆
- 在车辆信息表格中勾选需要完成提车的车辆
- 支持多选，可以同时处理多辆车的提车操作
- 显示已选中的车辆数量

### 2. 提车完成模态框
- **提车完成时间**：记录实际完成提车的时间
  - 支持日期和时间选择
  - 默认值为当前时间
  - 格式：YYYY-MM-DD HH:mm:ss

- **预计到达时间**：预估车辆到达目的地的时间
  - 支持日期和时间选择
  - 限制不能选择过去的时间
  - 格式：YYYY-MM-DD HH:mm:ss

### 3. 数据验证
- 两个时间字段都是必填项
- 预计到达时间不能早于当前时间
- 表单验证失败时会显示相应提示

## 使用流程

### 步骤1：选择车辆
1. 在运单详情页面找到车辆信息表格
2. 勾选需要完成提车的车辆（可多选）
3. 确认选中车辆数量

### 步骤2：触发提车操作
1. 点击表格上方的"完成提车"按钮
2. 系统会弹出"完成提车操作"模态框
3. 模态框显示选中的车辆数量

### 步骤3：填写时间信息
1. **提车完成时间**：
   - 选择实际完成提车的日期和时间
   - 默认为当前时间，可根据实际情况调整

2. **预计到达时间**：
   - 选择预估车辆到达目的地的日期和时间
   - 系统会自动禁用过去的日期

### 步骤4：确认提交
1. 检查填写的时间信息是否正确
2. 点击"确认完成"按钮提交
3. 系统处理完成后会显示成功提示
4. 自动刷新页面数据

## 技术实现

### 核心组件
```typescript
// 状态管理
const [pickupModalVisible, setPickupModalVisible] = useState(false);
const [pickupForm] = Form.useForm();

// 表单字段
- pickupCompletedTime: 提车完成时间
- estimatedArrivalTime: 预计到达时间
```

### API接口
```typescript
// 批量操作API
batchOperateVehicles(vehicleIds, 'completePickup', {
  pickupCompletedTime: '2024-03-01 14:30:00',
  estimatedArrivalTime: '2024-03-03 16:00:00'
})
```

### 表单验证规则
- 必填验证：两个时间字段都必须填写
- 时间格式：YYYY-MM-DD HH:mm:ss
- 业务规则：预计到达时间不能早于当前时间

## 用户体验优化

### 1. 界面设计
- 清晰的模态框标题："完成提车操作"
- 突出显示选中车辆数量
- 垂直布局的表单，便于填写

### 2. 交互反馈
- 实时表单验证
- 操作过程中的loading提示
- 成功/失败的消息提示
- 自动关闭模态框并刷新数据

### 3. 数据安全
- 表单重置：取消操作时清空表单数据
- 错误处理：网络异常时的友好提示
- 数据持久化：成功提交后更新本地数据

## 注意事项

1. **时间准确性**：请确保填写的时间信息准确，这将影响后续的物流跟踪
2. **批量操作**：一次操作会影响所有选中的车辆，请仔细确认选择
3. **网络状态**：提交时请确保网络连接正常，避免数据丢失
4. **权限控制**：只有具备相应权限的用户才能执行提车完成操作

## 相关文件

- `src/pages/Waybill/WaybillDetail/index.tsx` - 主要组件实现
- `src/pages/Waybill/WaybillDetail/index.module.less` - 样式文件
- `src/services/waybill.ts` - API服务接口

## 更新日志

### v1.0 初始功能
- ✅ 批量选择车辆功能
- ✅ 提车完成模态框
- ✅ 时间选择和验证
- ✅ 数据提交和反馈
- ✅ 响应式界面设计 
import{y as c,F as o,j as s,M as b,I as h,r as n,B as S,s as l,S as se}from"./index-D8ReppmJ.js";import{R as te}from"./SearchOutlined-BvVBc35E.js";import{F as ae}from"./Table-uXQ28xlW.js";import{S as w}from"./index-D5ba-O3m.js";import{T as re}from"./index-BzBpE7l5.js";import"./Pagination-DkTh5KJv.js";const ne="_container_1mvle_1",oe="_header_1mvle_6",T={container:ne,header:oe},le=async t=>c.post("/userStaff/pageQuery",t).then(r=>r),ie=async()=>c.get("/userDept/getDeptList").then(t=>t.result),ce=async t=>c.post("/userRole/pageQuery",t).then(r=>r.result),de=async t=>c.post("/userStaff/saveUser",t).then(r=>r),ue=async t=>c.post("/userStaff/saveUser",t),pe=async t=>c.post("/userStaff/removeUser?id="+t),me=async t=>c.post("/userStaff/resetPsw",t),he=({visible:t,onCancel:r,onOk:k,loading:v=!1})=>{const[p]=o.useForm(),d=async()=>{try{const i=await p.validateFields();k(i)}catch{}},f=()=>{p.resetFields(),r()};return s.jsx(b,{title:"重置密码",open:t,onOk:d,onCancel:f,destroyOnClose:!0,children:s.jsxs(o,{form:p,layout:"vertical",requiredMark:!1,children:[s.jsx(o.Item,{name:"password",label:"新密码",rules:[{required:!0,message:"请输入新密码"},{min:6,message:"密码长度不能小于6位"},{max:20,message:"密码长度不能超过20位"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{6,20}$/,message:"密码必须包含大小写字母和数字"}],children:s.jsx(h.Password,{placeholder:"请输入新密码"})}),s.jsx(o.Item,{name:"confirmPassword",label:"确认密码",dependencies:["password"],rules:[{required:!0,message:"请确认密码"},({getFieldValue:i})=>({validator(C,m){return!m||i("password")===m?Promise.resolve():Promise.reject(new Error("两次输入的密码不一致"))}})],children:s.jsx(h.Password,{placeholder:"请再次输入新密码"})})]})})},we=()=>{const[t,r]=n.useState(!1),[k,v]=n.useState(""),[p,d]=n.useState(!1),[f,i]=n.useState("add"),[C,m]=n.useState(null),[u]=o.useForm(),[N,D]=n.useState([]),[g,I]=n.useState({current:1,pageSize:10,total:0}),[O,j]=n.useState(!1),[P,q]=n.useState(null),[z,L]=n.useState([]),[_,R]=n.useState(!1),[V,E]=n.useState([]),[A,F]=n.useState(!1),U=async()=>{R(!0);try{const e=await ie();console.log(e,"response"),L(e||[])}catch(e){console.error("获取部门数据失败:",e),l.error("获取部门数据失败")}finally{R(!1)}},$=async(e={pageSize:1e3})=>{F(!0);try{const a=await ce(e);console.log(a,"response"),E(a||[])}catch(a){console.error("获取角色数据失败:",a),l.error("获取角色数据失败")}finally{F(!1)}},y=async(e,a)=>{try{r(!0);const x=a||g,Y={...e,pageNo:x.current,pageSize:x.pageSize},M=await le(Y);D(M.result||[]),I(ee=>({...ee,total:M.totalCount||0}))}catch(x){console.error("获取员工列表失败:",x)}finally{r(!1)}};n.useEffect(()=>{y(),U(),$()},[g.current,g.pageSize]);const Q=e=>{I(e)},B=e=>{v(e),y({nameOrMobilePhone:e})},Z=()=>{i("add"),m(null),d(!0),u.resetFields()},J=e=>{i("edit"),m(e),d(!0),u.setFieldsValue(e)},K=e=>{b.confirm({title:"确认删除",content:`确定要删除员工 ${e.personName} 吗？`,okText:"确认",cancelText:"取消",onOk:async()=>{try{r(!0),await pe(e.id),l.success("删除成功"),y()}catch(a){console.error("删除失败:",a)}finally{r(!1)}}})},G=async()=>{try{const e=await u.validateFields();f==="add"?(await de(e),l.success("新增成功")):(await ue({...C,...e}),l.success("编辑成功")),d(!1),u.resetFields(),y()}catch(e){console.error("表单提交失败:",e),l.error("新增员工失败")}},H=[{title:"姓名",dataIndex:"personName",key:"personName",width:120},{title:"手机号",dataIndex:"mobilePhone",key:"mobilePhone",width:150},{title:"部门",dataIndex:"deptName",key:"deptName",width:150},{title:"角色",dataIndex:"roleDTOS",key:"roleDTOS",width:200,render:e=>s.jsx("span",{children:e?e.map(a=>a.roleName).join(", "):""})},{title:"状态",dataIndex:"status",key:"status",width:100,render:e=>s.jsx(re,{color:e===1?"green":"red",children:e===1?"在职":"离职"})},{title:"操作",key:"action",width:200,render:(e,a)=>s.jsxs(se,{size:"middle",children:[s.jsx(S,{type:"link",onClick:()=>J(a),children:"编辑"}),s.jsx(S,{type:"link",danger:!0,onClick:()=>K(a),children:"删除"}),s.jsx(S,{type:"link",onClick:()=>W(a),children:"重置密码"})]})}],W=e=>{q(e),j(!0)},X=async e=>{if(P)try{r(!0),await me({id:P.id,pwd:e.password}),l.success("密码重置成功"),j(!1)}catch{l.error("密码重置失败，请重试")}finally{r(!1)}};return s.jsxs("div",{className:T.container,children:[s.jsxs("div",{className:T.header,children:[s.jsx(h,{placeholder:"搜索姓名/手机号",prefix:s.jsx(te,{}),onChange:e=>B(e.target.value),style:{width:200}}),s.jsx(S,{type:"primary",onClick:Z,children:"新增员工"})]}),s.jsx(ae,{columns:H,dataSource:N,loading:t,rowKey:"id",pagination:{...g,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条`},onChange:Q}),s.jsx(b,{title:f==="add"?"新增员工":"编辑员工",open:p,onOk:G,onCancel:()=>{d(!1),u.resetFields()},destroyOnClose:!0,children:s.jsxs(o,{form:u,layout:"vertical",children:[s.jsx(o.Item,{name:"personName",label:"姓名",rules:[{required:!0,message:"请输入姓名"}],children:s.jsx(h,{placeholder:"请输入姓名"})}),s.jsx(o.Item,{name:"mobilePhone",label:"手机号",rules:[{required:!0,message:"请输入手机号"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号"}],children:s.jsx(h,{placeholder:"请输入手机号",maxLength:11})}),s.jsx(o.Item,{name:"deptId",label:"部门",rules:[{required:!1,message:"请选择部门"}],children:s.jsx(w,{loading:_,placeholder:"请选择部门",options:z.map(e=>({label:e.deptName,value:e.id}))})}),s.jsx(o.Item,{name:"roleIds",label:"角色",rules:[{required:!1,message:"请选择角色"}],children:s.jsx(w,{loading:A,mode:"multiple",placeholder:"请选择角色",options:V.map(e=>({label:e.roleName,value:e.id}))})}),s.jsx(o.Item,{name:"status",label:"状态",initialValue:1,rules:[{required:!0,message:"请选择状态"}],children:s.jsx(w,{options:[{label:"在职",value:1},{label:"离职",value:0}]})})]})}),s.jsx(he,{visible:O,onCancel:()=>j(!1),onOk:X})]})};export{we as default};

import{F as a,r as n,j as s,R as J,a as l,I as v,S as Se,B as y,M as q,s as o}from"./index-D-wqIkuG.js";import{g as Ce,a as Q,b as ve,c as ke,d as G,e as H,f as be,h as U}from"./wareHouse-MPsWgVxM.js";import{S as d}from"./index-DbWrGEU6.js";import{R as Te}from"./SearchOutlined-C1ZYjfiz.js";import{R as Le}from"./ReloadOutlined-XiCbexZJ.js";import{R as Ae}from"./PlusOutlined-DwBRAV9i.js";import{F as Fe}from"./Table-CAvvVgJI.js";import{T as Re}from"./index-lnPGni--.js";import"./Pagination-DhMnuXBS.js";const De="_container_agzf4_1",qe={container:De},Je=()=>{const[z]=a.useForm(),[u]=a.useForm(),[V,W]=n.useState(!1),[X,A]=n.useState(!1),[w,F]=n.useState(!1),[E,R]=n.useState(null),[p,Y]=n.useState({current:1,pageSize:10,total:0}),[Z,ee]=n.useState([]),[j,N]=n.useState([]),[M,k]=n.useState(""),[b,f]=n.useState([]),[se,T]=n.useState(""),[ze,m]=n.useState([]),[Oe,L]=n.useState(""),[te,$]=n.useState(!1),[ae,_]=n.useState(!1),[Pe,B]=n.useState(!1),[D,ne]=n.useState([]),oe=async()=>{$(!0);try{const e=await Q({});console.log(e,"response"),N(e||[])}catch(e){console.error("获取省份数据失败:",e),o.error("获取省份数据失败")}finally{$(!1)}},re=async e=>{_(!0);try{const t=await G({provinceCode:e});console.log(t,"cities response"),f(t||[])}catch(t){console.error("获取城市数据失败:",t),o.error("获取城市数据失败")}finally{_(!1)}},le=async e=>{B(!0);try{const t=await H({cityId:e,provinceId:M.split("-")[0]});console.log(t,"districts response"),m(t||[])}catch(t){console.error("获取区域数据失败:",t),o.error("获取区域数据失败")}finally{B(!1)}},ie=e=>{if(k(e),u.setFieldsValue({city:void 0,district:void 0}),f([]),m([]),e){let t=j.find(i=>i.id===e);re(t.code)}},ce=e=>{T(e),u.setFieldsValue({district:void 0}),m([]),L(""),e&&le(e)},h=async(e={},t=p.current,i=p.pageSize)=>{W(!0);try{const c={...e,pageNo:t,pageSize:i},I=await ve(c);console.log("仓库列表响应:",I);const{result:S=[],totalCount:g=0}=I||{},C=S.map((r,x)=>({...r,key:r.id||x}));ee(C),Y(r=>({...r,current:t,pageSize:i,total:g}))}catch(c){console.error("获取仓库列表失败:",c),o.error("获取仓库列表失败")}finally{W(!1)}};n.useEffect(()=>{oe(),h(),de()},[]);const de=async()=>{let e=await Ce({});console.log("仓库管理员列表响应:",e),ne(e||[])},O=[{label:"自建仓",value:"1"},{label:"合作仓",value:"2"}],P=[{label:"启用",value:"1"},{label:"作废",value:"0"}],ue=[{title:"仓库名称",dataIndex:"name",width:150},{title:"仓库地址",dataIndex:"warehouseAddress",width:200},{title:"仓库类型",dataIndex:"warehouseTypeDesc",width:120},{title:"仓库状态",dataIndex:"warehouseStatusDesc",width:100},{title:"仓库管理员",dataIndex:"keeperName",width:150},{title:"总车位数",dataIndex:"parkingLotCount",width:100},{title:"经纬度",dataIndex:"location",width:150},{title:"是否银行准入",dataIndex:"isCapitalAccess",width:120,render:e=>s.jsx(Re,{color:e?"success":"error",children:e?"是":"否"})},{title:"在库车辆数",dataIndex:"onLotCarCount",width:100},{title:"操作",key:"action",fixed:"right",width:200,render:(e,t)=>s.jsxs("span",{children:[s.jsx(y,{type:"link",onClick:()=>ge(t),children:"编辑"}),s.jsx(y,{type:"link",onClick:()=>xe(t),children:"删除"}),t.warehouseStatus=="1"&&s.jsx(y,{type:"link",onClick:()=>ye(t),children:"作废"}),t.warehouseStatus=="0"&&s.jsx(y,{type:"link",onClick:()=>we(t),children:"启用"})]})}],he=e=>{console.log("搜索条件:",e),h(e,1,p.pageSize)},pe=()=>{z.resetFields(),h({},1,p.pageSize)},me=e=>{const t=z.getFieldsValue();h(t,e.current,e.pageSize)},K=(e,t)=>{const i=t.find(c=>c.label===e);return i?i.value:e},ge=async e=>{console.log("编辑仓库:",e),F(!0),R(e);try{const t=await Q({});if(N(t||[]),e.provinceId){k(e.provinceId);let I=j.find(g=>g.id===e.provinceId);const S=await G({provinceCode:I.code});if(f(S||[]),e.cityId){T(e.cityId);const g=await H({cityId:e.cityId,provinceId:e.provinceId});m(g||[]),L(e.districtId||"")}}const i=K(e.warehouseTypeDesc||"",O),c=K(e.warehouseStatusDesc||"",P);u.setFieldsValue({name:e.name,province:e.provinceId,city:e.cityId,warehouseAddress:e.warehouseAddress,warehouseType:i,warehouseStatus:c,keeperId:e.keeperId,parkingLotCount:e.parkingLotCount,longitude:e.longitude,latitude:e.latitude}),A(!0)}catch(t){console.error("获取编辑数据失败:",t),o.error("获取编辑数据失败")}},xe=e=>{q.confirm({title:"确认删除",content:`确定要删除仓库"${e.name}"吗？删除后无法恢复。`,okText:"确定",cancelText:"取消",onOk:async()=>{try{console.log("删除仓库:",e);const t=await be({id:e.id});console.log("删除仓库响应:",t),t&&t.code==="00000"?(o.success("删除仓库成功"),h()):o.error((t==null?void 0:t.message)||"删除仓库失败")}catch(t){console.error("删除仓库失败:",t),o.error("删除仓库失败，请重试")}}})},ye=e=>{q.confirm({title:"确认作废",content:`确定要作废仓库"${e.name}"吗？`,okText:"确定",cancelText:"取消",onOk:async()=>{try{console.log("作废仓库:",e);const t=await U({id:e.id,status:0});console.log("作废仓库响应:",t),t&&t.code==="00000"?(o.success("作废仓库成功"),h()):o.error((t==null?void 0:t.message)||"作废仓库失败")}catch(t){console.error("作废仓库失败:",t),o.error("作废仓库失败，请重试")}}})},we=e=>{q.confirm({title:"确认启用",content:`确定要启用仓库"${e.name}"吗？`,okText:"确定",cancelText:"取消",onOk:async()=>{try{console.log("启用仓库:",e);const t=await U({id:e.id,status:1});console.log("启用仓库响应:",t),t&&t.code==="00000"?(o.success("启用仓库成功"),h()):o.error((t==null?void 0:t.message)||"启用仓库失败")}catch(t){console.error("启用仓库失败:",t),o.error("启用仓库失败，请重试")}}})},je=()=>{F(!1),R(null),u.resetFields(),k(""),T(""),L(""),f([]),m([]),A(!0)},fe=()=>{A(!1),u.resetFields(),F(!1),R(null),k(""),T(""),L(""),f([]),m([])},Ie=async()=>{try{const e=await u.validateFields();console.log("表单数据:",e);const t=j.find(x=>x.id===e.province),i=t?t.name:"",c=b.find(x=>x.id===e.city),I=c?c.name:"",S=D.find(x=>x.id===e.keeperId),g=S?S.personName:"",C={name:e.name,provinceId:e.province?e.province.split("-")[0]:"",provinceName:i,cityId:e.city,cityName:I,warehouseAddress:e.warehouseAddress,warehouseType:e.warehouseType,warehouseStatus:e.warehouseStatus,keeperId:e.keeperId,keeperName:g,parkingLotCount:e.parkingLotCount,longitude:e.longitude,latitude:e.latitude};let r;w&&E?(C.id=E.id,console.log("编辑仓库接口参数:",C),r={code:"00000"}):(console.log("新增仓库接口参数:",C),r=await ke(C)),console.log("接口响应:",r),r&&r.code=="00000"?(o.success(w?"编辑仓库成功":"新增仓库成功"),A(!1),u.resetFields(),F(!1),R(null),k(""),T(""),L(""),f([]),m([]),h()):o.error((r==null?void 0:r.message)||(w?"编辑仓库失败":"新增仓库失败"))}catch(e){console.error(w?"编辑仓库失败:":"新增仓库失败:",e),o.error(w?"编辑仓库失败，请重试":"新增仓库失败，请重试")}};return s.jsxs("div",{className:qe.container,children:[s.jsxs(a,{form:z,onFinish:he,layout:"inline",children:[s.jsxs(J,{gutter:24,style:{width:"100%"},children:[s.jsx(l,{span:8,children:s.jsx(a.Item,{name:"name",label:"仓库名称",children:s.jsx(v,{placeholder:"请输入仓库名称",allowClear:!0})})}),s.jsx(l,{span:8,children:s.jsx(a.Item,{name:"warehouseType",label:"仓库类型",children:s.jsx(d,{placeholder:"请选择仓库类型",allowClear:!0,options:O})})}),s.jsx(l,{span:8,children:s.jsx(a.Item,{name:"warehouseStatus",label:"仓库状态",children:s.jsx(d,{placeholder:"请选择仓库状态",allowClear:!0,options:P})})})]}),s.jsx(J,{style:{width:"100%"},children:s.jsx(l,{span:24,children:s.jsxs(Se,{children:[s.jsx(y,{icon:s.jsx(Te,{}),type:"primary",htmlType:"submit",loading:V,children:"查询"}),s.jsx(y,{icon:s.jsx(Le,{}),onClick:pe,children:"重置"}),s.jsx(y,{type:"primary",icon:s.jsx(Ae,{}),onClick:je,children:"新增仓库"})]})})})]}),s.jsx(Fe,{columns:ue,dataSource:Z,loading:V,pagination:{current:p.current,pageSize:p.pageSize,total:p.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条`},onChange:me,scroll:{x:1500}}),s.jsx(q,{title:w?"编辑仓库":"新增仓库",open:X,onOk:Ie,onCancel:fe,width:600,okText:"确认",cancelText:"取消",children:s.jsxs(a,{form:u,layout:"inline",requiredMark:!1,children:[s.jsx(l,{span:24,children:s.jsx(a.Item,{name:"name",label:"仓库名称",rules:[{required:!0,message:"请输入仓库名称"}],children:s.jsx(v,{placeholder:"请输入仓库名称"})})}),s.jsxs(l,{span:24,children:[s.jsx(a.Item,{name:"province",label:"省份",rules:[{required:!0,message:"请选择省份"}],children:s.jsx(d,{placeholder:"请选择省份",loading:te,onChange:ie,allowClear:!0,value:M,children:j==null?void 0:j.map(e=>s.jsx(d.Option,{value:e.id,children:e.name},e.id))})}),s.jsx(a.Item,{name:"city",label:"城市",rules:[{required:!0,message:"请选择城市"}],children:s.jsx(d,{placeholder:"请选择城市",loading:ae,onChange:ce,allowClear:!0,disabled:b.length===0,value:se,children:b==null?void 0:b.map(e=>s.jsx(d.Option,{value:e.id||e.value,children:e.name||e.label},e.id||e.value))})}),s.jsx(a.Item,{name:"warehouseAddress",label:"详细地址",rules:[{required:!0,message:"请输入详细地址"}],children:s.jsx(v.TextArea,{placeholder:"请输入详细地址",rows:3})})]}),s.jsx(l,{span:24,children:s.jsx(a.Item,{name:"warehouseType",label:"仓库类型",rules:[{required:!0,message:"请选择仓库类型"}],children:s.jsx(d,{placeholder:"请选择仓库类型",options:O})})}),s.jsx(l,{span:24,children:s.jsx(a.Item,{name:"warehouseStatus",label:"仓库状态",rules:[{required:!0,message:"请选择仓库状态"}],children:s.jsx(d,{placeholder:"请选择仓库状态",options:P})})}),s.jsx(l,{span:24,children:s.jsx(a.Item,{name:"keeperId",label:"仓库管理员",rules:[{required:!0,message:"请选择仓库管理员"}],children:s.jsx(d,{placeholder:"请选择仓库管理员",allowClear:!0,children:D==null?void 0:D.map(e=>s.jsx(d.Option,{value:e.id,children:e.personName},e.id))})})}),s.jsx(l,{span:24,children:s.jsx(a.Item,{name:"parkingLotCount",label:"总车位数",rules:[{required:!0,message:"请输入总车位数"}],children:s.jsx(v,{placeholder:"请输入总车位数",type:"number",min:0})})}),s.jsx(l,{span:12,children:s.jsx(a.Item,{name:"longitude",label:"经度",rules:[{required:!0,message:"请输入经度"}],children:s.jsx(v,{placeholder:"请输入经度",type:"number",step:"0.000001"})})}),s.jsx(l,{span:12,children:s.jsx(a.Item,{name:"latitude",label:"纬度",rules:[{required:!0,message:"请输入纬度"}],children:s.jsx(v,{placeholder:"请输入纬度",type:"number",step:"0.000001"})})})]})})]})};export{Je as default};

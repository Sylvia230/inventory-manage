import{F as h,r,j as e,M as X,C as ce,I as G,S as ne,B as V,s as n,T as ke,R as de,a as ee}from"./index-DMKvYnLr.js";import{a as Ae,b as Te,c as Pe}from"./vehicle-CoRkSDdL.js";import{b as Ve,m as Fe,n as ze,o as ue,j as Oe,p as De,q as Re,r as he}from"./wareHouse-CUSThtKz.js";import{S as R}from"./index-CIhK1E4t.js";import{F as te}from"./Table-34TOMWnZ.js";import{R as ie}from"./PlusOutlined-BKiRrpec.js";import{R as je}from"./DeleteOutlined-7T6n7EEt.js";import{D as f}from"./index-DFjPstm4.js";import{V as Ue}from"./index-BOxJcu1o.js";import{u as Me}from"./waybill-CHNW2Ach.js";import{U as qe}from"./index-Cv_lnqN9.js";import{R as $e}from"./EyeOutlined-C5Km8UI_.js";import{I as Be}from"./index-DrbpgBqH.js";import{D as Ge}from"./index-C6qo0pvQ.js";import{R as We}from"./SearchOutlined-DDdjSPdr.js";import{R as He}from"./ReloadOutlined-Ch4B7x8x.js";import"./Pagination-D83B2W2M.js";import"./dayjs.min-E07o7nAg.js";const Ee="_container_1psrb_1",Ye={container:Ee},Ke="_cardWrapper_1ynlv_1",me={cardWrapper:Ke},Je=({open:y,onCancel:S,onOk:l})=>{const[p]=h.useForm(),[t]=h.useForm(),[w,L]=r.useState([]),[U,C]=r.useState(null),[g,A]=r.useState([]),[_,N]=r.useState(!1),[T,M]=r.useState([]),[c,m]=r.useState([]),[z,i]=r.useState([]),[x,F]=r.useState(!1),[O,B]=r.useState(!1),[K,b]=r.useState(!1),[D,Y]=r.useState([]),[W,q]=r.useState([]),[H,$]=r.useState([]),[I,Z]=r.useState(!1),j=[{code:1,desc:"国产",label:"国产",value:1},{code:2,desc:"中规",label:"中规",value:2},{code:3,desc:"美规",label:"美规",value:3},{code:4,desc:"加规",label:"加规",value:4},{code:5,desc:"中东",label:"中东",value:5},{code:6,desc:"欧规",label:"欧规",value:6},{code:7,desc:"墨西哥版",label:"墨西哥版",value:7},{code:8,desc:"平行进口",label:"平行进口",value:8},{code:9,desc:"亚洲版",label:"亚洲版",value:9}],d=async()=>{var s,o;try{F(!0);const a=await Ae({pageNo:1,pageSize:1e3});(s=a==null?void 0:a.result)!=null&&s.result&&M((o=a==null?void 0:a.result)==null?void 0:o.result)}catch{n.error("获取品牌列表失败")}finally{F(!1)}},J=async s=>{var o,a;try{B(!0);const u=await Te({pageNo:1,pageSize:1e3,carBrandId:s});(o=u==null?void 0:u.result)!=null&&o.result&&m((a=u==null?void 0:u.result)==null?void 0:a.result)}catch{n.error("获取车系列表失败")}finally{B(!1)}},le=async s=>{var o,a;try{b(!0);const u=await Pe({pageNo:1,pageSize:1e3,carSeriesId:s});(o=u==null?void 0:u.result)!=null&&o.result&&i((a=u==null?void 0:u.result)==null?void 0:a.result)}catch{n.error("获取车型列表失败")}finally{b(!1)}},oe=async s=>{try{Z(!0);const o=await ue({carVehicleId:s,colorType:1,pageNo:1,pageSize:1e3});if(console.log(o,"外观"),o!=null&&o.result){const u=o.result;q(u)}const a=await ue({carVehicleId:s,colorType:2,pageNo:1,pageSize:1e3});if(console.log(a,"内饰"),a!=null&&a.result){const u=a.result;$(u)}}catch{n.error("获取外观内饰列表失败")}finally{Z(!1)}},be=async()=>{const s=await Ve({pageSize:1e3,pageNo:1});Y(s.result),console.log(s,"getInboundList")},ge=async()=>{var o;const s=await Fe({pageSize:1e3,pageNo:1});console.log(s,"getCustomerList"),L((o=s==null?void 0:s.result)==null?void 0:o.result)};r.useEffect(()=>{y&&(d(),be())},[y]),r.useEffect(()=>{ge()},[]);const Ie=s=>{const o=w.find(a=>a.id===s);C(o||null),o&&p.setFieldsValue({contactPerson:o.contactName,contactPhone:o.contactMobile})},ve=s=>{t.setFieldsValue({series:void 0,vehicleId:void 0,outerColorId:void 0,innerColorId:void 0}),m([]),i([]),q([]),$([]),s&&J(s)},ye=s=>{t.setFieldsValue({model:void 0,vehicleId:void 0,outerColorId:void 0,innerColorId:void 0}),i([]),q([]),$([]),s&&le(s)},Se=s=>{t.setFieldsValue({outerColorId:void 0,innerColorId:void 0}),q([]),$([]),s&&oe(s)},we=async()=>{try{const s=await t.validateFields(),o=s.vins.split(",").filter(P=>!!P).map(P=>P.trim());if(console.log(o,"vins",s.quantity),o.length!=s.quantity){n.error("车架号数量与车辆数量不匹配");return}const a=T.find(P=>P.id===s.brand),u=c.find(P=>P.id===s.series),k=z.find(P=>P.id===s.vehicleId),v=W.find(P=>P.id===s.outerColorId),re=H.find(P=>P.id===s.innerColorId),_e={key:Date.now().toString(),...s,brandId:a==null?void 0:a.id,brandName:a==null?void 0:a.carBrandName,seriesId:u==null?void 0:u.id,guidePrice:k==null?void 0:k.guidePrice,emission:k==null?void 0:k.emission,specName:k.spec,seriesName:u==null?void 0:u.carSeriesName,vehicleName:k==null?void 0:k.carVehicleName,outerColorName:v==null?void 0:v.colorName,innerColorName:re==null?void 0:re.colorName,vins:o};A([...g,_e]),N(!1),t.resetFields()}catch(s){console.error("表单验证失败:",s)}},Ce=s=>{A(g.filter(o=>o.key!==s))},Ne=async()=>{try{const s=await p.validateFields();console.log(g,"vehicleList");const o=D.find(v=>v.id===s.warehouse),a=w.find(v=>v.id===s.customerId),u={warehouseId:s.warehouse,warehouseName:o==null?void 0:o.name,type:2,customerId:s.customerId,customerName:(a==null?void 0:a.name)||"",remark:s.remarks,inboundCarDTOS:g.map(v=>({brandId:v.brand,spec:v.spec,seriesId:v.seriesId,vehicleId:v.vehicleId,vehicleName:v.vehicleName,outerColorId:v.outerColorId,innerColorId:v.innerColorId,carCount:Number(v.quantity),vin:v.vins.join(","),guidePrice:v.guidePrice,emission:v.emission}))};if(console.log(u,"handleOk"),g.length===0){n.error("请至少添加一个车辆");return}const k=await ze(u);(k==null?void 0:k.code)=="00000"?(n.success("入库成功"),ae(),l(u)):n.error("入库失败"),console.log("新增入库数据:",s)}catch(s){console.error("表单验证失败:",s)}},ae=()=>{p.resetFields(),t.resetFields(),C(null),A([]),N(!1),S()},Le=[{title:"车型信息",dataIndex:"model",render:(s,o)=>e.jsxs("span",{children:[o.brandName," ",o.seriesName," ",o.vehicleName]})},{title:"内饰/外饰",dataIndex:"style",render:(s,o)=>e.jsxs("span",{children:[o.outerColorName," / ",o.innerColorName]})},{title:"数量",dataIndex:"quantity"},{title:"车架号",dataIndex:"vins",render:s=>s.join(", ")},{title:"操作",key:"action",render:(s,o)=>e.jsx(V,{type:"link",danger:!0,icon:e.jsx(je,{}),onClick:()=>Ce(o.key),children:"删除"})}];return e.jsxs(X,{title:"新增入库",open:y,onOk:Ne,onCancel:ae,width:1e3,bodyStyle:{maxHeight:"80vh",overflow:"auto"},children:[e.jsx(ce,{title:"基本信息",style:{marginBottom:16},className:me.cardWrapper,children:e.jsxs(h,{form:p,layout:"horizontal",labelCol:{span:6},wrapperCol:{span:16},children:[e.jsx(h.Item,{name:"warehouse",label:"停放仓库",rules:[{required:!0,message:"请选择停放仓库"}],children:e.jsx(R,{options:D.map(s=>({label:s.name,value:s.id})),placeholder:"请选择停放仓库"})}),e.jsx(h.Item,{name:"customerId",label:"客户",rules:[{required:!0,message:"请选择客户"}],children:e.jsx(R,{options:w.map(s=>({label:s.name,value:s.id})),placeholder:"请选择客户",onChange:Ie})}),e.jsx(h.Item,{name:"contactPerson",label:"联系人",children:e.jsx(G,{disabled:!0,placeholder:"选择客户后自动填充"})}),e.jsx(h.Item,{name:"contactPhone",label:"联系方式",children:e.jsx(G,{disabled:!0,placeholder:"选择客户后自动填充"})}),e.jsx(h.Item,{name:"remarks",label:"备注",children:e.jsx(G.TextArea,{rows:4,placeholder:"请输入备注信息"})})]})}),e.jsx(ce,{title:"车辆信息",className:me.cardWrapper,extra:!_&&e.jsx(V,{type:"primary",icon:e.jsx(ie,{}),onClick:()=>N(!0),children:"添加车辆"}),children:_?e.jsxs(h,{form:t,layout:"horizontal",labelCol:{span:6},wrapperCol:{span:16},children:[e.jsx(h.Item,{name:"spec",label:"车规",rules:[{required:!0,message:"请选择车规"}],children:e.jsx(R,{options:j,placeholder:"请选择车规"})}),e.jsx(h.Item,{name:"brand",label:"品牌",rules:[{required:!0,message:"请选择品牌"}],children:e.jsx(R,{loading:x,options:T.map(s=>({label:s.carBrandName,value:s.id})),placeholder:"请选择品牌",onChange:ve})}),e.jsx(h.Item,{name:"series",label:"车系",rules:[{required:!0,message:"请选择车系"}],children:e.jsx(R,{loading:O,options:c.map(s=>({label:s.carSeriesName,value:s.id})),placeholder:"请选择车系",onChange:ye,disabled:!t.getFieldValue("brand")})}),e.jsx(h.Item,{name:"vehicleId",label:"车型",rules:[{required:!0,message:"请选择车型"}],children:e.jsx(R,{loading:K,options:z.map(s=>({label:s.carVehicleName,value:s.id})),placeholder:"请选择车型",onChange:Se,disabled:!t.getFieldValue("series")})}),e.jsx(h.Item,{name:"outerColorId",label:"外观",rules:[{required:!0,message:"请选择外观"}],children:e.jsx(R,{loading:I,options:W.map(s=>({label:s.colorName,value:s.id})),placeholder:"请选择外观",disabled:!t.getFieldValue("vehicleId")})}),e.jsx(h.Item,{name:"innerColorId",label:"内饰",rules:[{required:!0,message:"请选择内饰"}],children:e.jsx(R,{loading:I,options:H.map(s=>({label:s.colorName,value:s.id})),placeholder:"请选择内饰",disabled:!t.getFieldValue("vehicleId")})}),e.jsx(h.Item,{name:"quantity",label:"数量",rules:[{required:!0,message:"请输入数量"}],children:e.jsx(G,{type:"number",min:1,placeholder:"请输入数量"})}),e.jsx(h.Item,{name:"vins",label:"车架号",rules:[{required:!0,message:"请输入车架号"}],children:e.jsx(G.TextArea,{rows:4,placeholder:"请输入车架号，多个车架号用逗号分隔"})}),e.jsx(h.Item,{wrapperCol:{offset:6,span:16},children:e.jsxs(ne,{children:[e.jsx(V,{type:"primary",onClick:we,children:"保存"}),e.jsx(V,{onClick:()=>{N(!1),t.resetFields()},children:"取消"})]})})]}):e.jsx(te,{columns:Le,dataSource:g,pagination:!1})})]})},Qe="_detailContent_1wtjl_1",Xe="_vehicleTable_1wtjl_9",pe={detailContent:Qe,vehicleTable:Xe},Ze=({open:y,onCancel:S,data:l})=>{var t;const p=[{title:"车架号",dataIndex:"vin",width:180},{title:"车辆属性",dataIndex:"vehicleName",width:200},{title:"车辆状态",dataIndex:"statusDesc",width:120}];return e.jsx(X,{title:"入库单详情",open:y,onCancel:S,footer:null,width:1200,bodyStyle:{maxHeight:"80vh",overflow:"auto"},children:e.jsxs("div",{className:pe.detailContent,children:[e.jsxs(f,{title:"基本信息",bordered:!0,column:3,children:[e.jsx(f.Item,{label:"入库单编号",children:l==null?void 0:l.inboundNo}),e.jsx(f.Item,{label:"接收仓库",children:l==null?void 0:l.warehouseName}),e.jsx(f.Item,{label:"入库单生成时间",children:l==null?void 0:l.createTime}),e.jsx(f.Item,{label:"入库类型",children:l==null?void 0:l.typeDesc}),e.jsx(f.Item,{label:"车辆总数",children:(t=l==null?void 0:l.wmsCarDTOList)==null?void 0:t.length}),e.jsx(f.Item,{label:"备注",span:2,children:l==null?void 0:l.remark})]}),e.jsxs(f,{title:"客户信息",bordered:!0,column:3,style:{marginTop:24},children:[e.jsx(f.Item,{label:"客户名称",children:l==null?void 0:l.customerName}),e.jsx(f.Item,{label:"联系人",children:l==null?void 0:l.customerContact}),e.jsx(f.Item,{label:"联系方式",children:l==null?void 0:l.customerPhone})]}),e.jsxs("div",{className:pe.vehicleTable,children:[e.jsx("h3",{children:"车辆信息"}),e.jsx(te,{columns:p,dataSource:l==null?void 0:l.wmsCarDTOList,pagination:!1,scroll:{x:1e3}})]})]})})},es="_certificatePhotoUpload_1vcwf_1",ss="_uploadHeader_1vcwf_1",ts="_photoList_1vcwf_14",ls="_photoItem_1vcwf_25",os="_photoWrapper_1vcwf_31",rs="_photoActions_1vcwf_43",ns="_photoName_1vcwf_75",E={certificatePhotoUpload:es,uploadHeader:ss,photoList:ts,photoItem:ls,photoWrapper:os,photoActions:rs,photoName:ns},xe=({value:y=[],onChange:S,maxSize:l=10,accept:p="image/*",disabled:t=!1,type:w,title:L})=>{const[U,C]=r.useState(!1),[g,A]=r.useState(""),[_,N]=r.useState(""),T=i=>i.type.startsWith("image/")?i.size/1024/1024<l?!0:(n.error(`图片大小不能超过 ${l}MB！`),!1):(n.error("只能上传图片文件！"),!1),M=async i=>{try{n.loading(`正在上传${L}...`,0);const x=await Me({file:i});console.log("上传结果:",x);const F=URL.createObjectURL(i),O={uid:Date.now().toString(),name:i.name,url:F,fileUrl:x.result.path,type:w},B=[...y,O];S==null||S(B),n.destroy(),n.success(`${L} 上传成功`)}catch(x){n.destroy(),n.error("照片上传失败"),console.error("照片上传失败:",x)}},c=i=>{const x=y.find(O=>O.uid===i);x!=null&&x.url&&URL.revokeObjectURL(x.url);const F=y.filter(O=>O.uid!==i);S==null||S(F),n.success("照片删除成功")},m=(i,x="照片预览")=>{A(i),N(x),C(!0)},z=()=>({name:"file",multiple:!1,accept:p,showUploadList:!1,beforeUpload:i=>(T(i)&&M(i),!1)});return e.jsxs("div",{className:E.certificatePhotoUpload,children:[e.jsxs("div",{className:E.uploadHeader,children:[e.jsx("h4",{children:L}),e.jsx(qe,{...z(),disabled:t,children:e.jsxs(V,{icon:e.jsx(ie,{}),disabled:t,children:["上传",L]})})]}),e.jsx("div",{className:E.photoList,children:y.map(i=>e.jsxs("div",{className:E.photoItem,children:[e.jsxs("div",{className:E.photoWrapper,children:[e.jsx("img",{src:i.url,alt:i.name,style:{width:"120px",height:"80px",objectFit:"cover",borderRadius:"4px"},onClick:()=>m(i.url,i.name)}),e.jsxs("div",{className:E.photoActions,children:[e.jsx(V,{type:"text",icon:e.jsx($e,{}),onClick:()=>m(i.url,i.name),style:{color:"white"}}),e.jsx(V,{type:"text",icon:e.jsx(je,{}),onClick:()=>c(i.uid),style:{color:"white"},disabled:t})]})]}),e.jsx("div",{className:E.photoName,children:i.name})]},i.uid))}),e.jsx(X,{open:U,title:_,footer:null,onCancel:()=>C(!1),width:800,children:e.jsx(Be,{alt:_,style:{width:"100%"},src:g})})]})},is="_form_ij7fi_1",as="_vehicleInfo_ij7fi_4",cs="_vehicleDetails_ij7fi_17",ds="_inboundInfo_ij7fi_26",us="_photoSection_ij7fi_36",Q={form:is,vehicleInfo:as,vehicleDetails:cs,inboundInfo:ds,photoSection:us},{Option:hs}=R,fe=[{name:"leftFront45",label:"左前45度照片",value:"1"},{name:"leftFrontDoor",label:"左前门含A柱的照片",value:"2"},{name:"leftRearDoor",label:"左后门的照片",value:"3"},{name:"rearWheel",label:"后轮轮毂照片",value:"4"},{name:"centerConsole",label:"中控台照片",value:"5"},{name:"dashboard",label:"仪表盘照片",value:"6"},{name:"rightRear45",label:"右后45度照片",value:"7"},{name:"rightFrontDoor",label:"右前门含A柱的照片",value:"8"},{name:"nameplate",label:"铭牌照片",value:"9"},{name:"inventoryForm",label:"商品车入库信息采集表",value:"10"},{name:"engineBay",label:"发动机舱",value:"11"}],ms=({visible:y,onCancel:S,onOk:l,vehicleData:p,gpsOptions:t=[],data:w})=>{const[L]=h.useForm(),[U,C]=r.useState(!1),[g,A]=r.useState({}),[_,N]=r.useState([]),[T,M]=r.useState([]),[c,m]=r.useState([]),[z,i]=r.useState(0),x=async()=>{var b;try{const D=await L.validateFields();C(!0);const Y=fe.filter(I=>I.required&&(!g[I.name]||g[I.name].length===0));if(Y.length>0){n.error(`请上传以下必填照片：${Y.map(I=>I.label).join("、")}`);return}console.log(g,"uploadedPhotos");let W=[];Object.values(g).forEach(I=>{I&&I.length>0&&W.push({anglePosition:Number(I[0].anglePosition),fileUrl:I[0].fileUrl,type:2})});const q=[];_==null||_.forEach(I=>{q.push(I.fileUrl)});const H=[];T==null||T.forEach(I=>{H.push(I.fileUrl)});const $={carId:p==null?void 0:p.carId,locationNo:D.locationNo,gpsDeviceId:D.gpsDeviceId,inspectionCarDTOList:W,registerCertUrl:q,conformityCertUrl:H,inboundId:w==null?void 0:w.id,inboundNo:w==null?void 0:w.inboundNo,vehicleId:p==null?void 0:p.id,inboundTime:(b=D.inboundTime)==null?void 0:b.format("YYYY-MM-DD HH:mm:ss")};console.log($,"submitData"),await l($),n.success("入库操作成功"),F()}catch(D){D instanceof Error?n.error(D.message):n.error("提交失败，请重试")}finally{C(!1)}},F=()=>{L.resetFields(),A({}),N([]),M([]),i(b=>b+1),S()},O=()=>{F()},B=b=>{console.log(b,"newPhotos"),A(b)},K=async()=>{const b=await Oe({});console.log(b,"getGpsList"),m((b==null?void 0:b.result)||[])};return r.useEffect(()=>{K()},[]),e.jsxs(X,{title:"入库操作",open:y,onCancel:O,onOk:x,confirmLoading:U,width:1e3,bodyStyle:{maxHeight:"80vh",overflow:"auto"},children:[e.jsxs(h,{form:L,layout:"inline",className:Q.form,children:[p&&e.jsxs("div",{className:Q.vehicleInfo,children:[e.jsx("h4",{children:"车辆信息"}),e.jsxs("div",{className:Q.vehicleDetails,children:[e.jsxs("span",{children:["车架号：",p.vin]}),e.jsxs("span",{children:["车型：",p.brand," ",p.series," ",p.vehicleName]}),e.jsxs("span",{children:["外观/内饰：",p.exterior," / ",p.interior]})]})]}),e.jsxs("div",{className:Q.inboundInfo,children:[e.jsx("h4",{children:"入库信息"}),e.jsx(h.Item,{name:"locationNo",label:"车位号",rules:[{required:!0,message:"请输入车位号"}],children:e.jsx(G,{placeholder:"请输入车位号"})}),e.jsx(h.Item,{name:"gpsDeviceId",label:"选择GPS",rules:[{required:!0,message:"请选择GPS"}],children:e.jsx(R,{placeholder:"请选择GPS",children:c.map(b=>e.jsx(hs,{value:b.id,children:b.simNo},b.id))})}),e.jsx(h.Item,{name:"inboundTime",label:"入库时间",rules:[{required:!0,message:"请选择入库时间"}],children:e.jsx(Ge,{showTime:!0,style:{width:"100%"},placeholder:"请选择入库时间"})})]})]}),e.jsx("div",{className:Q.photoSection,children:e.jsx(ke,{items:[{key:"inspection",label:"验车照片",children:e.jsx(Ue,{photoList:fe,value:g,onChange:B,maxSize:10,accept:"image/*"},z)},{key:"registration",label:"登记证照片",children:e.jsx(xe,{value:_,onChange:N,maxSize:10,accept:"image/*",type:"registration",title:"登记证照片"})},{key:"certificate",label:"合格证照片",children:e.jsx(xe,{value:T,onChange:M,maxSize:10,accept:"image/*",type:"certificate",title:"合格证照片"})}]})})]})},ps="_auditContent_ubvor_1",xs="_vehicleTable_ubvor_10",fs="_remarks_ubvor_51",js="_remarksContent_ubvor_59",se={auditContent:ps,vehicleTable:xs,remarks:fs,remarksContent:js},bs=({open:y,onCancel:S,onReject:l,onApprove:p,data:t,onRefresh:w})=>{const[L,U]=r.useState(!1),[C,g]=r.useState(null),A=c=>{g(c),U(!0)},_=async c=>{try{console.log("入库操作数据:",c),await De(c),n.success("入库操作成功"),U(!1),t.wmsCarDTOList=t.wmsCarDTOList.map(m=>(m.id===C.carId&&(m.status=2,m.statusDesc="已入库"),m)),g(null),w&&w()}catch{n.error("入库操作失败")}},N=[{id:"gps1",name:"GPS设备001"},{id:"gps2",name:"GPS设备002"},{id:"gps3",name:"GPS设备003"}],T=[{title:"车型",dataIndex:"model",width:600,render:(c,m)=>e.jsx("span",{children:m.vehicleName})},{title:"车架号",dataIndex:"vin",width:200},{title:"状态",dataIndex:"statusDesc",width:100},{title:"操作",dataIndex:"action",width:150,render:(c,m)=>m.status===1?e.jsx(V,{type:"link",onClick:()=>{A(m)},children:"入库"}):null}],M=()=>{const c=(t==null?void 0:t.availableSpace)||0,m=(t==null?void 0:t.pendingVehicles)||0,z=c-m;return z<0?{color:"#ff4d4f"}:z<10?{color:"#faad14"}:{color:"#52c41a"}};return e.jsxs(e.Fragment,{children:[e.jsx(X,{title:"入库",open:y,onCancel:S,footer:null,width:1200,bodyStyle:{maxHeight:"80vh",overflow:"auto"},children:e.jsxs("div",{className:se.auditContent,children:[e.jsxs(f,{title:"",bordered:!0,column:3,children:[e.jsx(f.Item,{label:"入库单号",children:t==null?void 0:t.inboundNo}),e.jsx(f.Item,{label:"接收仓库",children:t==null?void 0:t.warehouseName}),e.jsx(f.Item,{label:"入库单生成时间",children:t==null?void 0:t.createTime})]}),e.jsxs(f,{title:"",bordered:!0,column:3,style:{marginTop:24},children:[e.jsx(f.Item,{label:"库位可用数",children:t==null?void 0:t.parkingLotCount}),e.jsx(f.Item,{label:"在库车辆数",children:t==null?void 0:t.onLotCarCount}),e.jsx(f.Item,{label:"实际可用库位数",children:e.jsx("span",{style:M(),children:((t==null?void 0:t.availableCount)||0)-((t==null?void 0:t.availableCount)||0)})})]}),e.jsxs(f,{title:"",bordered:!0,column:3,style:{marginTop:24},children:[e.jsx(f.Item,{label:"客户",children:t==null?void 0:t.customerName}),e.jsx(f.Item,{label:"联系人",children:t==null?void 0:t.customerContact}),e.jsx(f.Item,{label:"联系方式",children:t==null?void 0:t.customerPhone})]}),e.jsxs("div",{className:se.vehicleTable,children:[e.jsx("h3",{children:"车辆信息"}),e.jsx(te,{columns:T,dataSource:t==null?void 0:t.wmsCarDTOList,pagination:!1,scroll:{x:1e3}})]}),e.jsxs("div",{className:se.remarks,children:[e.jsx("h3",{children:"备注"}),e.jsx("div",{className:se.remarksContent,children:(t==null?void 0:t.remarks)||"无"})]})]})}),e.jsx(ms,{visible:L,onCancel:()=>{U(!1),g(null)},onOk:_,vehicleData:C,gpsOptions:N,data:t})]})},Ds=()=>{const[y]=h.useForm(),[S,l]=r.useState(!1),[p,t]=r.useState(!1),[w,L]=r.useState(!1),[U,C]=r.useState(!1),[g,A]=r.useState(null),[_,N]=r.useState(null),[T,M]=r.useState([]),[c,m]=r.useState({current:1,pageSize:10,total:0}),z=[{label:"贸融入库",value:"1"},{label:"普通入库",value:"2"},{label:"试驾车",value:"试驾车"}],i=[{title:"入库单号",dataIndex:"inboundNo",width:180},{title:"停放仓库",dataIndex:"warehouseName",width:150},{title:"产品类型",dataIndex:"typeDesc",width:120},{title:"订单号",dataIndex:"orderNo",width:150},{title:"客户名称",dataIndex:"customerName",width:120},{title:"入库状态",dataIndex:"statusDesc",width:100},{title:"操作",key:"action",fixed:"right",width:160,render:(j,d)=>e.jsxs(ne,{size:"middle",children:[e.jsx(V,{type:"link",onClick:()=>K(d),children:"查看"}),d.statusDesc==="待入库"&&e.jsx(V,{type:"link",onClick:()=>q(d),children:"审核"})]})}],x=async j=>{try{l(!0);const d=await Re(j),{result:J,totalCount:le}=d;M(J),m(oe=>({...oe,total:le}))}catch{n.error("获取入库列表失败")}finally{l(!1)}};r.useEffect(()=>{x({pageSize:c.pageSize,current:c.current})},[c.current,c.pageSize]);const F=async j=>{const d={...j,pageSize:c.pageSize,current:1};m(J=>({...J,current:1})),await x(d)},O=()=>{y.resetFields(),m(j=>({...j,current:1})),x({pageSize:c.pageSize,current:1})},B=j=>{m(d=>({...d,current:j.current,pageSize:j.pageSize}))},K=async j=>{try{l(!0);const d=await he({inboundId:j.id});console.log(d,"res"),d!=null&&d.result?(A(d.result),L(!0)):n.error("获取入库单详情失败")}catch{n.error("获取入库单详情失败")}finally{l(!1)}},b=()=>{t(!0)},D=()=>{t(!1)},Y=async j=>{try{l(!0),n.success("新增入库成功"),t(!1),await x({pageSize:c.pageSize,current:1}),m(d=>({...d,current:1}))}catch{n.error("新增入库失败")}finally{l(!1)}},W=()=>{L(!1),A(null)},q=async j=>{try{l(!0);const d=await he({inboundId:j.id});console.log("入库单详情:",d),d!=null&&d.result?(N(d.result),C(!0)):n.error("获取入库单详情失败")}catch(d){console.error("获取入库单详情失败:",d),n.error("获取入库单详情失败")}finally{l(!1)}},H=()=>{C(!1),N(null)},$=async()=>{try{n.success("已拒绝入库申请"),C(!1),N(null),await x({pageSize:c.pageSize,current:c.current})}catch{n.error("拒绝入库失败")}},I=async()=>{try{n.success("已同意入库申请"),C(!1),N(null),await x({pageSize:c.pageSize,current:c.current})}catch{n.error("同意入库失败")}},Z=async()=>{try{await x({pageSize:c.pageSize,current:c.current})}catch(j){console.error("刷新审核数据失败:",j)}};return e.jsxs("div",{className:Ye.container,children:[e.jsxs(h,{form:y,onFinish:F,layout:"inline",children:[e.jsxs(de,{gutter:24,style:{width:"100%",marginBottom:16},children:[e.jsx(ee,{span:8,children:e.jsx(h.Item,{name:"inStockNo",label:"入库单号",children:e.jsx(G,{placeholder:"请输入入库单号",allowClear:!0})})}),e.jsx(ee,{span:8,children:e.jsx(h.Item,{name:"vin",label:"车架号",children:e.jsx(G,{placeholder:"请输入车架号",allowClear:!0})})}),e.jsx(ee,{span:8,children:e.jsx(h.Item,{name:"productType",label:"产品类型",children:e.jsx(R,{placeholder:"请选择产品类型",allowClear:!0,options:z})})})]}),e.jsx(de,{style:{width:"100%",marginBottom:16},children:e.jsxs(ee,{span:24,style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(ne,{children:[e.jsx(V,{icon:e.jsx(We,{}),type:"primary",htmlType:"submit",loading:S,children:"查询"}),e.jsx(V,{icon:e.jsx(He,{}),onClick:O,children:"重置"})]}),e.jsx(V,{type:"primary",icon:e.jsx(ie,{}),onClick:b,children:"新增入库"})]})})]}),e.jsx(te,{columns:i,dataSource:T,loading:S,pagination:{...c,showSizeChanger:!0,showQuickJumper:!0,showTotal:j=>`共 ${j} 条`},onChange:B,scroll:{x:1200}}),e.jsx(Je,{open:p,onCancel:D,onOk:Y}),e.jsx(Ze,{open:w,onCancel:W,data:g}),e.jsx(bs,{open:U,onCancel:H,onReject:$,onApprove:I,data:_,onRefresh:Z})]})};export{Ds as default};

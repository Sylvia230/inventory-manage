import{y as h,r as a,F as n,j as t,B as u,M as w,I as P,S as A,s as p}from"./index-D2rM6ovj.js";import{F as O,T as V}from"./Table-B7m-L3lW.js";import{S as B}from"./index-Bqt44OL4.js";import"./styleChecker-CcZ-Kr6E.js";const H="_container_iawkd_1",K="_header_iawkd_7",S={container:H,header:K};async function N(i){return h.post("/gdv/role/add",i)}async function $(i){return h.post("/gdv/role/update",i)}async function J(i){return h.post("/gdv/role/delete",i)}const Q=[{title:"系统管理",key:"system",children:[{title:"用户管理",key:"system:user",children:[{title:"查看用户",key:"system:user:view"},{title:"新增用户",key:"system:user:add"},{title:"编辑用户",key:"system:user:edit"},{title:"删除用户",key:"system:user:delete"}]},{title:"角色管理",key:"system:role",children:[{title:"查看角色",key:"system:role:view"},{title:"新增角色",key:"system:role:add"},{title:"编辑角色",key:"system:role:edit"},{title:"删除角色",key:"system:role:delete"}]}]},{title:"订单管理",key:"order",children:[{title:"订单列表",key:"order:list",children:[{title:"查看订单",key:"order:list:view"},{title:"新增订单",key:"order:list:add"},{title:"编辑订单",key:"order:list:edit"},{title:"删除订单",key:"order:list:delete"}]},{title:"订单审核",key:"order:audit",children:[{title:"查看审核",key:"order:audit:view"},{title:"审核操作",key:"order:audit:action"}]}]},{title:"车辆管理",key:"vehicle",children:[{title:"车辆列表",key:"vehicle:list",children:[{title:"查看车辆",key:"vehicle:list:view"},{title:"新增车辆",key:"vehicle:list:add"},{title:"编辑车辆",key:"vehicle:list:edit"},{title:"删除车辆",key:"vehicle:list:delete"}]}]}],G=[{id:"1",name:"张三",phone:"13800138000",department:"技术部",role:"开发工程师",status:"active"},{id:"2",name:"李四",phone:"13800138001",department:"技术部",role:"产品经理",status:"active"},{id:"3",name:"王五",phone:"13800138002",department:"市场部",role:"市场经理",status:"active"},{id:"4",name:"赵六",phone:"13800138003",department:"人事部",role:"HR专员",status:"active"},{id:"5",name:"钱七",phone:"13800138004",department:"财务部",role:"财务专员",status:"active"},{id:"6",name:"孙八",phone:"13800138005",department:"技术部",role:"测试工程师",status:"active"},{id:"7",name:"周九",phone:"13800138006",department:"市场部",role:"市场专员",status:"active"},{id:"8",name:"吴十",phone:"13800138007",department:"人事部",role:"招聘专员",status:"active"}],g=[{id:"1",name:"系统管理员",description:"系统最高权限管理员，可以管理所有功能",staffIds:["1","2"],staffList:[{id:"1",name:"张三",phone:"13800138000",department:"技术部",role:"开发工程师",status:"active"},{id:"2",name:"李四",phone:"13800138001",department:"技术部",role:"产品经理",status:"active"}],createTime:"2024-01-01 12:00:00",updateTime:"2024-01-01 12:00:00"},{id:"2",name:"部门主管",description:"部门负责人，可以管理本部门员工",staffIds:["3"],staffList:[{id:"3",name:"王五",phone:"13800138002",department:"市场部",role:"市场经理",status:"active"}],createTime:"2024-01-01 12:00:00",updateTime:"2024-01-01 12:00:00"},{id:"3",name:"普通员工",description:"普通员工，只能查看和操作自己的数据",staffIds:["4","5"],staffList:[{id:"4",name:"赵六",phone:"13800138003",department:"人事部",role:"HR专员",status:"active"},{id:"5",name:"钱七",phone:"13800138004",department:"财务部",role:"财务专员",status:"active"}],createTime:"2024-01-01 12:00:00",updateTime:"2024-01-01 12:00:00"}],Z=()=>{const[i,l]=a.useState(!1),[j,d]=a.useState(!1),[y,f]=a.useState("add"),[T,k]=a.useState(null),[r]=n.useForm(),[I,b]=a.useState([]),[R,L]=a.useState([]),[c,v]=a.useState({current:1,pageSize:10,total:0}),[x,o]=a.useState([]),C=async()=>{try{L(G)}catch(e){console.error("获取员工列表失败:",e)}},m=async(e={})=>{try{l(!0),b(g),v(s=>({...s,total:g.length}))}catch(s){console.error("获取角色列表失败:",s)}finally{l(!1)}};a.useEffect(()=>{m(),C()},[c.current,c.pageSize]);const F=e=>{v(e)},M=[{title:"角色名称",dataIndex:"name",key:"name",width:150},{title:"已选员工",dataIndex:"staffList",key:"staffList",width:200,render:e=>t.jsx("span",{children:e.map(s=>s.name).join(", ")})},{title:"创建时间",dataIndex:"createTime",key:"createTime",width:180},{title:"更新时间",dataIndex:"updateTime",key:"updateTime",width:180},{title:"操作",key:"action",width:150,render:(e,s)=>t.jsxs(A,{size:"middle",children:[t.jsx(u,{type:"link",onClick:()=>E(s),children:"编辑"}),t.jsx(u,{type:"link",danger:!0,onClick:()=>q(s),children:"删除"})]})}],_=()=>{f("add"),k(null),d(!0),r.resetFields()},E=e=>{f("edit"),k(e),d(!0),o(e.permissions||[]),r.setFieldsValue({...e,staffIds:e.staffIds})},q=e=>{w.confirm({title:"确认删除",content:`确定要删除角色 ${e.name} 吗？`,okText:"确认",cancelText:"取消",onOk:async()=>{try{l(!0),await J(e.id),p.success("删除成功"),m()}catch(s){console.error("删除失败:",s)}finally{l(!1)}}})},z=async()=>{try{const s={...await r.validateFields(),permissions:x};y==="add"?(await N(s),p.success("新增成功")):(await $({...T,...s}),p.success("编辑成功")),d(!1),r.resetFields(),o([]),m()}catch(e){console.error("表单提交失败:",e)}},D=e=>{o(e)};return t.jsxs("div",{className:S.container,children:[t.jsx("div",{className:S.header,children:t.jsx(u,{type:"primary",onClick:_,children:"新增角色"})}),t.jsx(O,{columns:M,dataSource:I,loading:i,rowKey:"id",pagination:{...c,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条`},onChange:F}),t.jsx(w,{title:y==="add"?"新增角色":"编辑角色",open:j,onOk:z,onCancel:()=>{d(!1),r.resetFields(),o([])},destroyOnClose:!0,width:800,children:t.jsxs(n,{form:r,layout:"vertical",children:[t.jsx(n.Item,{name:"name",label:"角色名称",rules:[{required:!0,message:"请输入角色名称"}],children:t.jsx(P,{placeholder:"请输入角色名称"})}),t.jsx(n.Item,{name:"staffIds",label:"选择员工",rules:[{required:!0,message:"请选择员工"}],children:t.jsx(B,{mode:"multiple",placeholder:"请选择员工",style:{width:"100%"},options:R.map(e=>({label:e.name,value:e.id}))})}),t.jsx(n.Item,{label:"菜单权限",required:!0,tooltip:"请选择该角色可以访问的菜单和操作权限",children:t.jsx(V,{checkable:!0,defaultExpandAll:!0,checkedKeys:x,onCheck:D,treeData:Q,height:400,style:{border:"1px solid #d9d9d9",padding:"8px",borderRadius:"4px"}})})]})})]})};export{Z as default};

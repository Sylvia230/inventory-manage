import{F as r,r as n,s as o,j as a,R as _,a as O,I as F,S as V,B as d,M as J}from"./index-D8ReppmJ.js";import{d as N}from"./debounce-Y-c3ZRR0.js";import{b as Ne,c as Q,a as Re,d as G,g as De,s as Ae}from"./finance-DTZW8aOF.js";import{R as ve}from"./SearchOutlined-BvVBc35E.js";import{R as ze}from"./ReloadOutlined-C0hCzlSn.js";import{R as Ee}from"./PlusOutlined-8DBRHyq7.js";import{F as Me}from"./Table-uXQ28xlW.js";import{S as u}from"./index-D5ba-O3m.js";import{D as Pe}from"./index-j7PxaXAn.js";import"./Pagination-DkTh5KJv.js";import"./dayjs.min-BcO9To5O.js";const $e="_container_e2zo2_1",qe={container:$e},{RangePicker:aa}=Pe,ta=()=>{const[b]=r.useForm(),[l]=r.useForm(),[R,D]=n.useState(!1),[H,h]=n.useState(!1),[A,p]=n.useState(!1),[K,f]=n.useState(null),[U,w]=n.useState(!1),[g,x]=n.useState(null),[y,S]=n.useState(1),[j,W]=n.useState(10),[X,Y]=n.useState(0),[Z,ee]=n.useState([]),[ae,te]=n.useState([]),[v,se]=n.useState([]),[m,ne]=n.useState([]),[re,oe]=n.useState(""),[le,z]=n.useState(!1),[E,M]=n.useState([]),[ce,P]=n.useState(!1),[ie,$]=n.useState(!1),[de,ue]=n.useState(1),[_e,Ve]=n.useState({current:1,pageSize:10,total:0}),he=[{title:"银行账户户名",dataIndex:"accountName",width:120},{title:"卡号",dataIndex:"bankAccount",width:100},{title:"开户行",dataIndex:"bankBranchName",width:120},{title:"归属方类型",dataIndex:"ownerTypeDesc",width:80},{title:"用途",dataIndex:"purposeDescList",width:80},{title:"操作",key:"action",fixed:"right",width:100,render:(e,t)=>a.jsxs(V,{size:"middle",children:[a.jsx(d,{type:"link",onClick:()=>ge(t),children:"编辑"}),a.jsx(d,{type:"link",danger:!0,onClick:()=>Te(t),children:"删除"})]})}],[pe,fe]=n.useState([]);n.useEffect(()=>{c(),B(),me(),ke()},[y,j]);const c=async e=>{D(!0);try{const t={page:y,pageSize:j,...e},s=await Ne(t);console.log("银行卡列表",s),s.result&&(fe(s.result),Y(s.totalCount||0))}catch(t){console.error("获取银行卡列表失败:",t),o.error("获取数据失败")}finally{D(!1)}},me=async()=>{try{const e=await Q("OwnerTypeEnum");console.log(e,"response"),ee(e||[])}catch(e){console.error("获取归属方类型枚举数据失败:",e),o.error("获取归属方类型枚举数据失败")}},ke=async()=>{try{const e=await Q("BankCardPurposeEnum");console.log(e,"response"),te(e||[])}catch(e){console.error("获取归属方类型枚举数据失败:",e),o.error("获取归属方类型枚举数据失败")}},C=async(e,t)=>{$(!0);try{let s=[];t?s=await G(t,e):s=await G(de,e),console.log(s,"response"),se(s||[])}catch(s){console.error("获取数据失败:",s),o.error("获取数据失败")}finally{$(!1)}},B=async e=>{z(!0);try{const t={pageSize:1e3,...e},s=await Re(t);console.log(s,"response"),ne(s||[])}catch(t){console.error("获取银行数据失败:",t),o.error("获取银行数据失败")}finally{z(!1)}},I=async e=>{P(!0);try{const t={pageSize:1e3,...e},s=await De(t);console.log(s,"response"),M(s||[])}catch(t){console.error("获取银行数据失败:",t),o.error("获取银行数据失败")}finally{P(!1)}},be=e=>{console.log("搜索条件:",e),S(1),c(e)},we=()=>{b.resetFields(),S(1),c()},ge=e=>{p(!0),f(e),h(!0);let t=e.ownerType;C("",t);let s=e.bankId;const L={bankClscode:m.find(T=>T.id===s).bankCode};I(L),l.setFieldsValue({...e})},xe=()=>{h(!1),p(!1),f(null),l.resetFields()},ye=async()=>{p(!1),f(null),h(!0),l.resetFields()},Se=async()=>{try{let e=await l.validateFields();console.log("保存银行卡:",e);let t=e.bankId,s=m.find(i=>i.id===t);e.bankName=s.bankName;let k=e.bankBranchId,L=E.find(i=>i.id===k);e.bankBranchName=L.bankName;let T=e.ownerId,q=v.find(i=>i.id===T);e.ownerName=q.name,e.accountName=q.name,A&&(e={...K,...e}),await Ae(e),o.success("保存成功"),h(!1),p(!1),f(null),l.resetFields(),c(),B()}catch(e){console.error("表单验证失败:",e)}},je=N(e=>{/[\u4e00-\u9fff\u3400-\u4dbf\uf900-\ufaff]/.test(e)&&B({bankName:e})},400),Ce=N(e=>{/[\u4e00-\u9fff\u3400-\u4dbf\uf900-\ufaff]/.test(e)&&C(e)},400),Be=N(e=>{/[\u4e00-\u9fff\u3400-\u4dbf\uf900-\ufaff]/.test(e)&&I({bankName:e,bankClscode:re})},800),Ie=e=>{let t="";if(e){let s=m.find(k=>k.id===e);t=s.bankCode,oe(s.bankCode)}b.setFieldsValue({bankBranchId:void 0}),M([]),t&&I({bankClscode:t})},Le=e=>{ue(e),e&&C("",e)},Te=e=>{x(e),w(!0)},Oe=async()=>{try{console.log("删除银行卡:",g),o.success("删除成功"),w(!1),x(null),c()}catch(e){console.error("删除失败:",e),o.error("删除失败")}},Fe=()=>{w(!1),x(null)};return a.jsxs("div",{className:qe.container,children:[a.jsxs(r,{form:b,onFinish:be,layout:"inline",children:[a.jsxs(_,{gutter:24,style:{width:"100%"},children:[a.jsx(O,{span:8,children:a.jsx(r.Item,{name:"bankAccount",label:"银行卡账号",children:a.jsx(F,{placeholder:"请输入银行卡账号",allowClear:!0})})}),a.jsx(O,{span:8,children:a.jsx(r.Item,{name:"accountName",label:"户名",children:a.jsx(F,{placeholder:"请输入户名",allowClear:!0})})})]}),a.jsx(_,{gutter:24,style:{width:"100%"},children:a.jsx(O,{span:6,children:a.jsxs(V,{children:[a.jsx(d,{icon:a.jsx(ve,{}),type:"primary",htmlType:"submit",loading:R,children:"查询"}),a.jsx(d,{icon:a.jsx(ze,{}),onClick:we,children:"重置"}),a.jsx(d,{type:"primary",icon:a.jsx(Ee,{}),onClick:ye,children:"新增银行卡"})]})})})]}),a.jsx(Me,{columns:he,dataSource:pe,loading:R,pagination:{current:y,pageSize:j,total:X,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条`},onChange:e=>{S(e.current||1),W(e.pageSize||10)},scroll:{x:1300}}),a.jsx(J,{title:A?"编辑银行卡":"新增银行卡",open:H,onOk:Se,onCancel:xe,width:600,children:a.jsxs(r,{form:l,layout:"vertical",requiredMark:!1,children:[a.jsx(r.Item,{name:"ownerType",label:"归属方类型",style:{width:"100%"},children:a.jsx(u,{placeholder:"请选择归属方类型",style:{width:"100%"},onChange:Le,options:Z.map(e=>({label:e.desc,value:e.code}))})}),a.jsx(r.Item,{name:"ownerId",label:"归属方",style:{width:"100%"},children:a.jsx(u,{showSearch:!0,allowClear:!0,loading:ie,filterOption:!1,onSearch:Ce,placeholder:"请选择归属方",options:v.map(e=>({label:e.name,value:e.id}))})}),a.jsx(r.Item,{name:"bankId",label:"开户行",rules:[{required:!0,message:"请选择开户行"}],children:a.jsx(u,{showSearch:!0,allowClear:!0,loading:le,filterOption:!1,onSearch:je,onChange:Ie,placeholder:"请选择开户行",options:m.map(e=>({label:e.bankName,value:e.id}))})}),a.jsx(r.Item,{name:"bankBranchId",label:"支行",rules:[{required:!0,message:"请选择开户支行"}],children:a.jsx(u,{showSearch:!0,allowClear:!0,loading:ce,filterOption:!1,onSearch:Be,placeholder:"请选择开户支行",options:E.map(e=>({label:e.bankName,value:e.id}))})}),a.jsx(r.Item,{name:"bankAccount",label:"账户",rules:[{required:!0,message:"请输入账户"},{pattern:/^\d{7,19}$/,message:"请输入7-19位数字"}],style:{width:"100%"},children:a.jsx(F,{placeholder:"请输入账户"})}),a.jsx(r.Item,{name:"purposeList",label:"用途",rules:[{required:!1,message:"请选择用途"}],children:a.jsx(u,{mode:"multiple",placeholder:"请选择用途",style:{width:"100%"},options:ae.map(e=>({label:e.desc,value:e.code}))})})]})}),a.jsxs(J,{title:"删除确认",open:U,onOk:Oe,onCancel:Fe,okText:"确认",cancelText:"取消",okButtonProps:{danger:!0},children:[a.jsx("p",{children:"确定要删除该银行卡吗？"}),g&&a.jsxs("p",{style:{color:"#666",fontSize:"14px"},children:["卡号：",g.bankAccount.replace(/(\d{4})\d+(\d{4})/,"$1****$2")]})]})]})};export{ta as default};

import{F as s,r as c,j as e,R,a as d,I as x,S as z,B as i,M as C,s as r}from"./index-CMZTZRIn.js";import{S as T}from"./index-CYJ1echB.js";import{R as ee}from"./SearchOutlined-D2-z65ZP.js";import{R as te}from"./ReloadOutlined-D9mwfiSd.js";import{F as L}from"./Table-Cg2wz00u.js";import{U as le}from"./index-COEYxaOF.js";import{R as ae}from"./UploadOutlined-BYvR2IT_.js";import"./Pagination-BY7MwDV5.js";const ne="_container_1iukc_1",V={container:ne},ue=()=>{const[f]=s.useForm(),[h]=s.useForm(),[_,S]=c.useState(!1),[B,g]=c.useState(!1),[P,k]=c.useState(!1),[D,b]=c.useState(!1),[p,o]=c.useState(null),[j,m]=c.useState([]),[v,u]=c.useState([]),w=[{label:"购车合同",value:"purchase"},{label:"租赁合同",value:"lease"},{label:"服务合同",value:"service"},{label:"其他",value:"other"}],F=[{label:"甲方",value:"party_a"},{label:"乙方",value:"party_b"},{label:"丙方",value:"party_c"},{label:"资方",value:"investor"},{label:"担保方",value:"guarantor"}],E=[{title:"编号",dataIndex:"templateNo",key:"templateNo",width:180},{title:"名称",dataIndex:"name",key:"name",width:200},{title:"创建时间",dataIndex:"createTime",key:"createTime",width:180},{title:"修改时间",dataIndex:"updateTime",key:"updateTime",width:180},{title:"合同类型",dataIndex:"type",key:"type",width:120,render:t=>{const l=w.find(a=>a.value===t);return l?l.label:t}},{title:"资方合同名称",dataIndex:"fundContractName",key:"fundContractName",width:200},{title:"操作",key:"action",fixed:"right",width:180,render:(t,l)=>e.jsxs("span",{children:[e.jsx(i,{size:"small",type:"link",onClick:()=>O(l),children:"编辑"}),e.jsx(i,{type:"link",size:"small",danger:!0,onClick:()=>q(l),children:"删除"}),e.jsx(i,{size:"small",type:"link",onClick:()=>J(l),children:"设置签章位置"}),e.jsx(i,{size:"small",type:"link",onClick:()=>W(l),children:"校验"})]})}],H=[{title:"签署方类型",dataIndex:"signerType",key:"signerType",width:150,render:(t,l)=>{if(l.isNew)return e.jsx(T,{value:t,placeholder:"请选择签署方类型",options:F,style:{width:"100%"},onChange:n=>N(l.id,"signerType",n)});const a=F.find(n=>n.value===t);return a?a.label:t}},{title:"签章关键字",dataIndex:"keyword",key:"keyword",width:200,render:(t,l)=>l.isNew?e.jsx(x,{value:t,placeholder:"请输入签章关键字",onChange:a=>N(l.id,"keyword",a.target.value)}):t},{title:"操作",key:"action",width:150,render:(t,l)=>e.jsxs(z,{children:[l.isNew?e.jsx(i,{type:"primary",size:"small",onClick:()=>G(l),children:"添加"}):null,e.jsx(i,{type:"link",size:"small",danger:!0,onClick:()=>K(l.id),children:"删除"})]})}],M=[{key:"1",templateNo:"MB202403150001",name:"标准购车合同模板",createTime:"2024-03-15 10:00:00",updateTime:"2024-03-15 10:00:00",type:"purchase",fundContractName:"上海银行购车合同",templateFile:"/uploads/template1.html"},{key:"2",templateNo:"MB202403150002",name:"标准租赁合同模板",createTime:"2024-03-15 11:00:00",updateTime:"2024-03-15 11:00:00",type:"lease",fundContractName:"北京银行租赁合同",templateFile:"/uploads/template2.html"}],O=t=>{o(t),h.setFieldsValue({name:t.name,fundContractName:t.fundContractName,type:t.type}),t.templateFile?m([{uid:"-1",name:t.templateFile.split("/").pop()||"template.html",status:"done",url:t.templateFile}]):m([]),k(!0)},q=t=>{o(t),g(!0)},U=async()=>{try{console.log("删除模板:",p),r.success("删除成功"),g(!1),o(null)}catch(t){console.error("删除失败:",t),r.error("删除失败")}},$=async()=>{var t,l,a;try{const n=await h.validateFields();if(j.length===0){r.error("请上传合同模版文件");return}const y={...n,templateFile:((t=j[0])==null?void 0:t.url)||((a=(l=j[0])==null?void 0:l.response)==null?void 0:a.url)};console.log("编辑模板数据:",y),r.success("编辑成功"),k(!1),o(null),h.resetFields(),m([])}catch(n){console.error("编辑失败:",n),r.error("编辑失败")}},A=()=>{k(!1),o(null),h.resetFields(),m([])},X={name:"file",action:"/api/upload/template",fileList:j,accept:".html,.htm,.xhtml",maxCount:1,beforeUpload:t=>{var n;return["html","htm","xhtml"].includes(((n=t.name.split(".").pop())==null?void 0:n.toLowerCase())||"")?t.size/1024/1024<10?!0:(r.error("文件大小不能超过 10MB！"),!1):(r.error("只能上传 HTML、HTM、XHTML 格式的文件！"),!1)},onChange:({fileList:t})=>{m(t)},onRemove:()=>{m([])}},J=t=>{o(t),u([{id:"1",signerType:"party_a",keyword:"甲方签章"},{id:"2",signerType:"party_b",keyword:"乙方签章"}]),b(!0)},Q=()=>{const t={id:Date.now().toString(),signerType:"",keyword:"",isNew:!0};u([...v,t])},N=(t,l,a)=>{u(n=>n.map(y=>y.id===t?{...y,[l]:a}:y))},G=async t=>{try{if(!t.signerType||!t.keyword){r.error("请填写完整的签章位置信息");return}const l={templateNo:p==null?void 0:p.templateNo,signerType:t.signerType,keyword:t.keyword};console.log("添加签章位置:",l),r.success("签章位置添加成功"),u(a=>a.map(n=>n.id===t.id?{...n,isNew:!1}:n))}catch(l){console.error("添加签章位置失败:",l),r.error("添加签章位置失败")}},K=t=>{u(l=>l.filter(a=>a.id!==t))},I=()=>{b(!1),o(null),u([])},W=t=>{console.log("校验模板:",t)},Y=async()=>{try{const t=await f.validateFields();console.log("搜索条件:",t),S(!0),setTimeout(()=>{S(!1)},1e3)}catch(t){console.error("表单验证失败:",t)}},Z=()=>{f.resetFields()};return e.jsxs("div",{className:V.container,children:[e.jsxs(s,{form:f,layout:"inline",className:V.searchForm,children:[e.jsxs(R,{gutter:24,style:{width:"100%"},children:[e.jsx(d,{span:8,children:e.jsx(s.Item,{name:"templateNo",label:"模板编号",children:e.jsx(x,{placeholder:"请输入模板编号"})})}),e.jsx(d,{span:8,children:e.jsx(s.Item,{name:"name",label:"合同模板名称",children:e.jsx(x,{placeholder:"请输入合同模板名称"})})}),e.jsx(d,{span:8,children:e.jsx(s.Item,{name:"type",label:"合同类型",children:e.jsx(T,{placeholder:"请选择合同类型",options:w,allowClear:!0})})})]}),e.jsx(R,{gutter:24,style:{width:"100%"},children:e.jsx(d,{span:8,children:e.jsx(s.Item,{children:e.jsxs(z,{children:[e.jsx(i,{type:"primary",icon:e.jsx(ee,{}),onClick:Y,children:"搜索"}),e.jsx(i,{icon:e.jsx(te,{}),onClick:Z,children:"重置"})]})})})})]}),e.jsx(L,{columns:E,dataSource:M,loading:_,pagination:{total:M.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>`共 ${t} 条`},scroll:{x:1500}}),e.jsx(C,{title:"编辑合同模板",open:P,onOk:$,onCancel:A,okText:"确认",cancelText:"取消",width:600,destroyOnClose:!0,children:e.jsxs(s,{form:h,layout:"inline",preserve:!1,children:[e.jsx(d,{span:24,children:e.jsx(s.Item,{name:"name",label:"合同名称",rules:[{required:!0,message:"请输入合同名称"},{max:20,message:"合同名称不能超过20个字符"}],children:e.jsx(x,{placeholder:"请输入合同名称",showCount:!0,maxLength:20})})}),e.jsx(d,{span:24,children:e.jsx(s.Item,{name:"fundContractName",label:"资方合同名称",children:e.jsx(x,{placeholder:"请输入资方合同名称"})})}),e.jsx(d,{span:24,children:e.jsx(s.Item,{name:"type",label:"合同类型",rules:[{required:!0,message:"请选择合同类型"}],children:e.jsx(T,{placeholder:"请选择合同类型",options:w})})}),e.jsx(d,{span:24,children:e.jsxs(s.Item,{label:"合同模版",required:!0,children:[e.jsx(le,{...X,children:e.jsx(i,{icon:e.jsx(ae,{}),children:"选择文件"})}),e.jsx("div",{style:{marginTop:8,color:"#999",fontSize:12},children:"支持格式：HTML、HTM、XHTML，文件大小不超过10MB"})]})})]})}),e.jsxs(C,{title:"设置签章位置",open:D,onCancel:I,footer:[e.jsx(i,{onClick:I,children:"关闭"},"cancel")],width:800,destroyOnClose:!0,children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(i,{type:"primary",onClick:Q,children:"添加签章位置"})}),e.jsx(L,{columns:H,dataSource:v,pagination:!1,size:"small",locale:{emptyText:"暂无签章位置，请点击上方按钮添加"}})]}),e.jsxs(C,{title:"删除确认",open:B,onOk:U,onCancel:()=>{g(!1),o(null)},okText:"确认",cancelText:"取消",okButtonProps:{danger:!0},children:[e.jsx("p",{children:"确定要删除该合同模板吗？"}),p&&e.jsxs("p",{style:{color:"#666",fontSize:"14px"},children:["模板编号：",p.templateNo]})]})]})};export{ue as default};

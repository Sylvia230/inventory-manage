import{y as g,F as t,j as e,M as w,I as h,r,B as x,S as L,s as m}from"./index-B6A06c6A.js";import{R as B}from"./SearchOutlined-Bb0vlOc9.js";import{F as N}from"./Table-BEusMSwL.js";import{S as v}from"./index-xszfO04H.js";import{T as Z}from"./index-CU3b0-78.js";const J="_container_1mvle_1",K="_header_1mvle_6",R={container:J,header:K};async function Q(l){return g.post("/gdv/staff/add",l)}async function G(l){return g.post("/api/staff/update",l)}async function U(l){return g.post("/api/staff/delete",l)}const W=({visible:l,onCancel:n,onOk:S,loading:b=!1})=>{const[c]=t.useForm(),i=async()=>{try{const o=await c.validateFields();S(o)}catch{}},p=()=>{c.resetFields(),n()};return e.jsx(w,{title:"重置密码",open:l,onOk:i,onCancel:p,destroyOnClose:!0,children:e.jsxs(t,{form:c,layout:"vertical",requiredMark:!1,children:[e.jsx(t.Item,{name:"password",label:"新密码",rules:[{required:!0,message:"请输入新密码"},{min:6,message:"密码长度不能小于6位"},{max:20,message:"密码长度不能超过20位"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{6,20}$/,message:"密码必须包含大小写字母和数字"}],children:e.jsx(h.Password,{placeholder:"请输入新密码"})}),e.jsx(t.Item,{name:"confirmPassword",label:"确认密码",dependencies:["password"],rules:[{required:!0,message:"请确认密码"},({getFieldValue:o})=>({validator(k,u){return!u||o("password")===u?Promise.resolve():Promise.reject(new Error("两次输入的密码不一致"))}})],children:e.jsx(h.Password,{placeholder:"请再次输入新密码"})})]})})},X=[{label:"技术部",value:"技术部"},{label:"市场部",value:"市场部"},{label:"人事部",value:"人事部"},{label:"财务部",value:"财务部"}],Y=[{label:"开发工程师",value:"开发工程师"},{label:"产品经理",value:"产品经理"},{label:"市场经理",value:"市场经理"},{label:"HR专员",value:"HR专员"},{label:"财务专员",value:"财务专员"}],le=()=>{const[l,n]=r.useState(!1),[S,b]=r.useState(""),[c,i]=r.useState(!1),[p,o]=r.useState("add"),[k,u]=r.useState(null),[d]=t.useForm(),[M,T]=r.useState([]),[y,C]=r.useState({current:1,pageSize:10,total:0}),[P,j]=r.useState(!1),[I,q]=r.useState(null),F=[{id:"1",name:"张三",phone:"13800138000",department:"技术部",role:"开发工程师",status:"active"},{id:"2",name:"李四",phone:"13800138001",department:"市场部",role:"市场经理",status:"active"},{id:"3",name:"王五",phone:"13800138002",department:"人事部",role:"HR专员",status:"inactive"}],f=async(a={})=>{try{n(!0),T(F),C(s=>({...s,total:F.length}))}catch(s){console.error("获取员工列表失败:",s)}finally{n(!1)}};r.useEffect(()=>{f()},[y.current,y.pageSize]);const _=a=>{C(a)},O=a=>{b(a),f({})},z=()=>{o("add"),u(null),i(!0),d.resetFields()},V=a=>{o("edit"),u(a),i(!0),d.setFieldsValue(a)},E=a=>{w.confirm({title:"确认删除",content:`确定要删除员工 ${a.name} 吗？`,okText:"确认",cancelText:"取消",onOk:async()=>{try{n(!0),await U(a.id),m.success("删除成功"),f()}catch(s){console.error("删除失败:",s)}finally{n(!1)}}})},A=async()=>{try{const a=await d.validateFields();p==="add"?(await Q(a),m.success("新增成功")):(await G({...k,...a}),m.success("编辑成功")),i(!1),d.resetFields(),f()}catch(a){console.error("表单提交失败:",a)}},$=[{title:"姓名",dataIndex:"name",key:"name",width:120},{title:"手机号",dataIndex:"phone",key:"phone",width:150},{title:"部门",dataIndex:"department",key:"department",width:150},{title:"角色",dataIndex:"role",key:"role",width:150},{title:"状态",dataIndex:"status",key:"status",width:100,render:a=>e.jsx(Z,{color:a==="active"?"green":"red",children:a==="active"?"在职":"离职"})},{title:"操作",key:"action",width:200,render:(a,s)=>e.jsxs(L,{size:"middle",children:[e.jsx(x,{type:"link",onClick:()=>V(s),children:"编辑"}),e.jsx(x,{type:"link",danger:!0,onClick:()=>E(s),children:"删除"}),e.jsx(x,{type:"link",onClick:()=>D(s),children:"重置密码"})]})}],D=a=>{q(a),j(!0)},H=async a=>{if(I)try{n(!0),await resetStaffPassword({staffId:I.id,newPassword:a.password}),m.success("密码重置成功"),j(!1)}catch{m.error("密码重置失败，请重试")}finally{n(!1)}};return e.jsxs("div",{className:R.container,children:[e.jsxs("div",{className:R.header,children:[e.jsx(h,{placeholder:"搜索姓名/手机号",prefix:e.jsx(B,{}),onChange:a=>O(a.target.value),style:{width:200}}),e.jsx(x,{type:"primary",onClick:z,children:"新增员工"})]}),e.jsx(N,{columns:$,dataSource:M,loading:l,rowKey:"id",pagination:{...y,showSizeChanger:!0,showQuickJumper:!0,showTotal:a=>`共 ${a} 条`},onChange:_}),e.jsx(w,{title:p==="add"?"新增员工":"编辑员工",open:c,onOk:A,onCancel:()=>{i(!1),d.resetFields()},destroyOnClose:!0,children:e.jsxs(t,{form:d,layout:"vertical",children:[e.jsx(t.Item,{name:"name",label:"姓名",rules:[{required:!0,message:"请输入姓名"}],children:e.jsx(h,{placeholder:"请输入姓名"})}),e.jsx(t.Item,{name:"phone",label:"手机号",rules:[{required:!0,message:"请输入手机号"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号"}],children:e.jsx(h,{placeholder:"请输入手机号",maxLength:11})}),e.jsx(t.Item,{name:"department",label:"部门",rules:[{required:!0,message:"请选择部门"}],children:e.jsx(v,{placeholder:"请选择部门",options:X})}),e.jsx(t.Item,{name:"role",label:"角色",rules:[{required:!0,message:"请选择角色"}],children:e.jsx(v,{placeholder:"请选择角色",options:Y})}),e.jsx(t.Item,{name:"status",label:"状态",initialValue:"active",rules:[{required:!0,message:"请选择状态"}],children:e.jsx(v,{options:[{label:"在职",value:"active"},{label:"离职",value:"inactive"}]})})]})}),e.jsx(W,{visible:P,onCancel:()=>j(!1),onOk:H})]})};export{le as default};

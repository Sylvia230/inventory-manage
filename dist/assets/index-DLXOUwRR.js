import{F as l,r as t,s as n,j as e,R as T,a as c,I as d,S as L,B as m,M as R}from"./index-D8ReppmJ.js";import{a as G,A as J,D as Q}from"./capital-uRs2kgDL.js";import{R as Z}from"./SearchOutlined-BvVBc35E.js";import{R as H}from"./ReloadOutlined-C0hCzlSn.js";import{R as K}from"./PlusOutlined-8DBRHyq7.js";import{F as U}from"./Table-uXQ28xlW.js";import"./Pagination-DkTh5KJv.js";import"./index-D5ba-O3m.js";const W="_container_1iukc_1",b={container:W},ue=()=>{const[x]=l.useForm(),[i]=l.useForm(),[D,u]=t.useState(!1),[M,h]=t.useState(!1),[C,S]=t.useState(!1),[p,j]=t.useState(null),[N,f]=t.useState(!1),[g,k]=t.useState(null),[I,z]=t.useState([]),[X,A]=t.useState(0),[w,Y]=t.useState(1),[F,ee]=t.useState(10),[se,te]=t.useState([]),v=[{title:"资方ID",dataIndex:"id",key:"id",width:180},{title:"资方名称",dataIndex:"name",key:"name",width:200},{title:"资方简称",dataIndex:"shortName",key:"shortName",width:200},{title:"统一社会码",dataIndex:"socialCreditCode",key:"socialCreditCode",width:200},{title:"操作",key:"action",fixed:"right",width:100,render:(s,a)=>e.jsxs("span",{children:[e.jsx(m,{size:"small",type:"link",onClick:()=>V(a),children:"修改"}),e.jsx(m,{size:"small",type:"link",onClick:()=>E(a),children:"删除"})]})}],E=s=>{k(s),f(!0)},O=async()=>{try{const s=await Q({id:g.id});console.log("删除资方:",s),s?(n.success("删除成功"),y()):n.error(s.msg||"删除失败")}catch(s){console.error("删除失败:",s),n.error("删除失败")}finally{f(!1),k(null)}};t.useEffect(()=>{y()},[w,F]);const y=async s=>{u(!0);try{const a={page:w,pageSize:F,...s},r=await G(a);if(console.log("....fetchData",r),r.result){const ae=(r.result||[]).map(o=>({key:o.id,templateNo:o.id,name:o.templateName,createTime:o.createTime,updateTime:o.updateTime,type:o.templateType,fundContractName:o.remark||"-",templateFile:o.templateContent}));z(r.result),A(r.totalCount||0)}else n.error(r.msg||"获取数据失败")}catch(a){console.error("获取合同模板列表失败:",a),n.error("获取数据失败")}finally{u(!1)}},V=s=>{S(!0),j(s),i.setFieldsValue({name:s.name,shortName:s.shortName,socialCreditCode:s.socialCreditCode}),h(!0)},P=()=>{S(!1),j(null),i.resetFields(),h(!0)},_=async()=>{try{const s=await x.validateFields();console.log("搜索条件:",s),u(!0),setTimeout(()=>{u(!1)},1e3)}catch(s){console.error("表单验证失败:",s)}},$=()=>{x.resetFields()},q=async()=>{try{const s=await i.validateFields();console.log("Modal表单数据:",s);let a={...s};C&&(a.id=p==null?void 0:p.id),console.log("....params",a);const r=await J(a);console.log("新增资方:",s),r?(n.success("操作成功"),h(!1),i.resetFields(),y()):n.error(r.msg||"操作失败")}catch(s){console.error("表单验证或提交失败:",s),n.error("请检查输入内容")}},B=()=>{h(!1),j(null),i.resetFields()};return e.jsxs("div",{className:b.container,children:[e.jsx(l,{form:x,layout:"inline",className:b.searchForm,children:e.jsxs(T,{gutter:24,style:{width:"100%"},children:[e.jsx(c,{span:8,children:e.jsx(l.Item,{name:"name",label:"资方名称",children:e.jsx(d,{placeholder:"请输入资方名称"})})}),e.jsx(c,{span:8,children:e.jsx(l.Item,{name:"legalPerson",label:"法人名称",children:e.jsx(d,{placeholder:"请输入法人名称"})})}),e.jsx(c,{span:8,children:e.jsx(l.Item,{children:e.jsxs(L,{children:[e.jsx(m,{type:"primary",icon:e.jsx(Z,{}),onClick:_,children:"搜索"}),e.jsx(m,{icon:e.jsx(H,{}),onClick:$,children:"重置"}),e.jsx(m,{type:"primary",icon:e.jsx(K,{}),onClick:P,children:"新增"})]})})})]})}),e.jsx(U,{columns:v,dataSource:I,loading:D,pagination:{total:I.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:s=>`共 ${s} 条`},scroll:{x:1200}}),e.jsx(R,{title:C?"编辑资方":"新增资方",open:M,onOk:q,onCancel:B,width:600,destroyOnClose:!0,children:e.jsx(l,{form:i,layout:"vertical",initialValues:p||{},children:e.jsxs(T,{gutter:16,children:[e.jsx(c,{span:12,children:e.jsx(l.Item,{label:"资方名称",name:"name",rules:[{required:!0,message:"请输入资方名称"},{max:50,message:"名称不能超过50个字符"}],children:e.jsx(d,{placeholder:"请输入资方名称"})})}),e.jsx(c,{span:12,children:e.jsx(l.Item,{label:"资方简称",name:"shortName",rules:[{required:!0,message:"请输入资方简称"},{max:20,message:"简称不能超过20个字符"}],children:e.jsx(d,{placeholder:"请输入资方简称"})})}),e.jsx(c,{span:12,children:e.jsx(l.Item,{label:"统一社会信用代码",name:"socialCreditCode",rules:[{required:!0,message:"请输入统一社会信用代码"},{pattern:/^[0-9A-Z]{18}$/,message:"请输入18位大写字母和数字组成的统一社会信用代码"}],children:e.jsx(d,{placeholder:"请输入18位统一社会信用代码"})})})]})})}),e.jsxs(R,{title:"删除确认",open:N,onOk:O,onCancel:()=>f(!1),okText:"确认",cancelText:"取消",okButtonProps:{danger:!0},children:[e.jsx("p",{children:"确定要删除该资方吗？"}),g&&e.jsxs("p",{style:{color:"#666",fontSize:"14px"},children:["资方名称：",g.name]})]})]})};export{ue as default};

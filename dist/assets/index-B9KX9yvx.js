import{F as o,r as n,s as m,j as e,R as p,a as l,I as G,S as C,B as c,M as _}from"./index-DFmaZUvW.js";import{a as J,D as K}from"./merchant-BP2dYbxx.js";import{S as f}from"./index-Bqyftg-u.js";import{R as Q}from"./SearchOutlined-DL9voMCh.js";import{R as q}from"./ReloadOutlined-CzbpDPLD.js";import{R as H}from"./PlusOutlined-BJcRHrv7.js";import{F as U}from"./Table-DIemrw74.js";import{T as u}from"./index-D-yGRGxy.js";import"./Pagination-B-JRzDfY.js";const W="_container_15n9t_1",X={container:W},le=()=>{var I;const[x]=o.useForm(),[T,w]=n.useState(!1),[N,b]=n.useState([]),[F,k]=n.useState(0),[j,g]=n.useState(1),[y,S]=n.useState(10),[R,L]=n.useState(!1),[a,z]=n.useState(null),v=[{label:"新车",value:"new_car"},{label:"二手车",value:"used_car"},{label:"试驾车",value:"test_car"}],D=[{label:"上海银行",value:"shanghai_bank"},{label:"北京金融租赁",value:"beijing_finance"},{label:"广州融资租赁",value:"guangzhou_leasing"}],$=[{label:"正常",value:"active"},{label:"停用",value:"inactive"},{label:"待审核",value:"pending"}];n.useEffect(()=>{h()},[j,y]);const h=async t=>{w(!0);try{const i={page:j,pageSize:y,...t},s=await J(i);if(console.log("授信额度列表",s),s!=null&&s.result){const d=(s.result||[]).map(r=>({id:r.id,key:r.id,merchantId:r.merchantId,merchantName:r.merchantName,productType:r.productType,capitalId:r.capitalId,capitalName:r.capitalName,creditLimit:r.creditLimit||0,usedLimit:r.usedLimit||0,availableLimit:r.availableLimit||0,status:r.status||"active",createTime:r.createTime,updateTime:r.updateTime}));b(d),k(s.totalCount||0)}else{const d=[{id:"1",key:"1",merchantId:"merchant_001",merchantName:"上海汽车销售有限公司",productType:"new_car",capitalId:"capital_001",capitalName:"上海银行",creditLimit:1e7,usedLimit:35e5,availableLimit:65e5,status:"active",createTime:"2024-03-15 10:00:00",updateTime:"2024-03-15 10:00:00"},{id:"2",key:"2",merchantId:"merchant_002",merchantName:"北京汽车贸易集团",productType:"used_car",capitalId:"capital_002",capitalName:"北京金融租赁",creditLimit:8e6,usedLimit:52e5,availableLimit:28e5,status:"active",createTime:"2024-03-14 14:30:00",updateTime:"2024-03-14 14:30:00"},{id:"3",key:"3",merchantId:"merchant_003",merchantName:"广州汽车服务有限公司",productType:"test_car",capitalId:"capital_003",capitalName:"广州融资租赁",creditLimit:5e6,usedLimit:0,availableLimit:5e6,status:"pending",createTime:"2024-03-13 09:15:00",updateTime:"2024-03-13 09:15:00"}];b(d),k(d.length)}}catch(i){console.error("获取授信额度列表失败:",i),m.error("获取数据失败")}finally{w(!1)}},M=[{title:"商家名称",dataIndex:"merchantName",key:"merchantName",width:200},{title:"产品类型",dataIndex:"productType",key:"productType",width:120,render:t=>{const i=v.find(s=>s.value===t);return i?i.label:t}},{title:"资方名称",dataIndex:"capitalName",key:"capitalName",width:150},{title:"授信额度",dataIndex:"creditLimit",key:"creditLimit",width:120,render:t=>`¥${(t/1e4).toFixed(2)}万`},{title:"已用额度",dataIndex:"usedLimit",key:"usedLimit",width:120,render:t=>`¥${(t/1e4).toFixed(2)}万`},{title:"可用额度",dataIndex:"availableLimit",key:"availableLimit",width:120,render:t=>`¥${(t/1e4).toFixed(2)}万`},{title:"使用率",key:"usageRate",width:100,render:(t,i)=>{const s=i.creditLimit>0?(i.usedLimit/i.creditLimit*100).toFixed(1):"0.0",d=parseFloat(s)>80?"red":parseFloat(s)>60?"orange":"green";return e.jsxs(u,{color:d,children:[s,"%"]})}},{title:"状态",dataIndex:"status",key:"status",width:100,render:t=>{const i=t==="active"?"success":t==="inactive"?"default":"warning",s=t==="active"?"正常":t==="inactive"?"停用":"待审核";return e.jsx(u,{color:i,children:s})}},{title:"创建时间",dataIndex:"createTime",key:"createTime",width:180},{title:"操作",key:"action",fixed:"right",width:200,render:(t,i)=>e.jsxs(C,{children:[e.jsx(c,{size:"small",type:"link",onClick:()=>E(i),children:"查看"}),e.jsx(c,{size:"small",type:"link",onClick:()=>O(),children:"编辑"}),e.jsx(c,{type:"link",size:"small",danger:!0,onClick:()=>P(i),children:"删除"})]})}],E=t=>{z(t),L(!0)},O=t=>{m.info("编辑功能开发中")},P=t=>{_.confirm({title:"确认删除",content:`确定要删除商家"${t.merchantName}"的授信额度记录吗？`,okText:"确认",cancelText:"取消",onOk:async()=>{try{await K({id:t.id})?(m.success("删除成功"),h()):m.error("删除失败")}catch(i){console.error("删除授信额度失败:",i),m.error("删除失败")}}})},V=async()=>{try{const t=await x.validateFields();console.log("搜索条件:",t),g(1),h(t)}catch(t){console.error("表单验证失败:",t)}},A=()=>{x.resetFields(),g(1),h()},B=t=>{g(t.current),S(t.pageSize)};return e.jsxs("div",{className:X.container,children:[e.jsxs(o,{form:x,onFinish:V,layout:"inline",children:[e.jsxs(p,{gutter:24,style:{width:"100%"},children:[e.jsx(l,{span:8,children:e.jsx(o.Item,{name:"merchantName",label:"商家名称",children:e.jsx(G,{placeholder:"请输入商家名称",allowClear:!0})})}),e.jsx(l,{span:8,children:e.jsx(o.Item,{name:"productType",label:"产品类型",children:e.jsx(f,{placeholder:"请选择产品类型",allowClear:!0,options:v})})}),e.jsx(l,{span:8,children:e.jsx(o.Item,{name:"capitalId",label:"资方",children:e.jsx(f,{placeholder:"请选择资方",allowClear:!0,options:D})})})]}),e.jsxs(p,{gutter:24,style:{width:"100%"},children:[e.jsx(l,{span:8,children:e.jsx(o.Item,{name:"status",label:"状态",children:e.jsx(f,{placeholder:"请选择状态",allowClear:!0,options:$})})}),e.jsx(l,{span:16,children:e.jsxs(C,{children:[e.jsx(c,{icon:e.jsx(Q,{}),type:"primary",htmlType:"submit",loading:T,children:"查询"}),e.jsx(c,{icon:e.jsx(q,{}),onClick:A,children:"重置"}),e.jsx(c,{icon:e.jsx(H,{}),type:"primary",onClick:()=>m.info("新增功能开发中"),children:"新增授信额度"})]})})]})]}),e.jsx(U,{columns:M,dataSource:N,loading:T,pagination:{current:j,pageSize:y,total:F,showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>`共 ${t} 条`},onChange:B,scroll:{x:1500},rowKey:"id"}),e.jsx(_,{title:"授信额度详情",open:R,onCancel:()=>L(!1),width:800,footer:[e.jsx(c,{onClick:()=>L(!1),children:"关闭"},"close")],children:a&&e.jsxs("div",{children:[e.jsxs(p,{gutter:16,children:[e.jsxs(l,{span:12,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"商家名称："}),a.merchantName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"产品类型："}),(I=v.find(t=>t.value===a.productType))==null?void 0:I.label]}),e.jsxs("p",{children:[e.jsx("strong",{children:"资方名称："}),a.capitalName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"授信额度："}),"¥",(a.creditLimit/1e4).toFixed(2),"万"]})]}),e.jsxs(l,{span:12,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"已用额度："}),"¥",(a.usedLimit/1e4).toFixed(2),"万"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"可用额度："}),"¥",(a.availableLimit/1e4).toFixed(2),"万"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"使用率："}),e.jsxs(u,{color:a.usedLimit/a.creditLimit*100>80?"red":a.usedLimit/a.creditLimit*100>60?"orange":"green",children:[(a.usedLimit/a.creditLimit*100).toFixed(1),"%"]})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"状态："}),e.jsx(u,{color:a.status==="active"?"success":a.status==="inactive"?"default":"warning",children:a.status==="active"?"正常":a.status==="inactive"?"停用":"待审核"})]})]})]}),e.jsx(p,{children:e.jsxs(l,{span:24,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"创建时间："}),a.createTime]}),e.jsxs("p",{children:[e.jsx("strong",{children:"更新时间："}),a.updateTime]})]})})]})})]})};export{le as default};

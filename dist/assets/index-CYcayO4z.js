import{F as o,r as n,s as f,G as w,j as t,R as J,a as d,I as Q,S as Le,B as p,M as H}from"./index-DFmaZUvW.js";import{G as Te,a as De,S as Ee}from"./capital-CcLLPlDQ.js";import{G as Fe}from"./contract-TbwQC0-h.js";import{S as u}from"./index-Bqyftg-u.js";import{R as Pe}from"./SearchOutlined-DL9voMCh.js";import{R as Be}from"./ReloadOutlined-CzbpDPLD.js";import{R as D}from"./PlusOutlined-BJcRHrv7.js";import{F as E}from"./Table-DIemrw74.js";import{T as U}from"./index-B48vUfzP.js";import"./Pagination-B-JRzDfY.js";const Ge="_container_1iukc_1",W={container:Ge},Xe=()=>{const[v]=o.useForm(),[X,C]=n.useState(!1),[Y,I]=n.useState(!1),[S,F]=n.useState(!1),[b,z]=n.useState(null),[g]=o.useForm(),[m,y]=n.useState([]),[x,j]=n.useState([]),[P,Z]=n.useState([]),[Ne,ee]=n.useState(0),[B,Ae]=n.useState(1),[G,Me]=n.useState(10),[N,te]=n.useState([]),[A,ae]=n.useState([]),[O,se]=n.useState([]),[M,k]=n.useState([]),[q,le]=n.useState([]),[_,ne]=n.useState([]),[R,oe]=n.useState([]),[ie,re]=n.useState([]);n.useEffect(()=>{ce(),de(),pe(),ue(),me(),he(),ge()},[]),n.useEffect(()=>{L()},[B,G]);const L=async e=>{C(!0);try{const a={page:B,pageSize:G,...e},s=await Te(a);console.log("....fetchData",s),s!=null&&s.result?(Z(s==null?void 0:s.result),ee(s.totalCount||0)):f.error(s.msg||"获取数据失败")}catch(a){console.error("获取业务配置列表失败:",a),f.error("获取数据失败")}finally{C(!1)}},ce=async()=>{const e=await De({page:1,pageSize:1e3});console.log("....getCapitalList",e==null?void 0:e.result),e!=null&&e.result&&te(e==null?void 0:e.result)},de=async()=>{const e=await w("BizCategoryEnum");console.log("....getProductList",e);let a=[];e==null||e.forEach(s=>{a.push({label:s.desc,value:s.code})}),ae(a)},pe=async()=>{const e=await w("BizCategorySubEnum");console.log("....getProductSmallList",e);let a=[];e==null||e.forEach(s=>{a.push({label:s.desc,value:s.code})}),se(a)},ue=async()=>{const e=await w("SignerRoleEnum");console.log("....getRoleList",e);let a=[];e==null||e.forEach(s=>{a.push({label:s.desc,value:s.code})}),le(a)},me=async()=>{ne([{id:"1",name:"上海汽车销售有限公司"},{id:"2",name:"北京汽车贸易集团"},{id:"3",name:"广州汽车服务有限公司"},{id:"4",name:"深圳汽车销售中心"}])},V=e=>{console.log("产品大类变化:",e);let a=[];e==2?a=O.filter(s=>s.value=="2"||s.value=="4"):e==1?a=O.filter(s=>s.value=="1"||s.value=="3"):a=O,k(a),g.setFieldsValue({productSmall:void 0})},he=async()=>{var s;const e=await Fe({page:1,pageSize:1e3});console.log("....getContractTemplateList",e);let a=[];(s=e==null?void 0:e.result)==null||s.forEach(r=>{a.push({label:r.name,value:r.id})}),re(a)},ge=async()=>{const e=await w("BizConfigContractTemplateScopeEnum");console.log("....getGenerateDimensionList",e);let a=[];e==null||e.forEach(s=>{a.push({label:s.desc,value:s.code})}),oe(a)},ye=[{title:"角色",dataIndex:"roleId",key:"roleId",width:200,render:(e,a)=>t.jsx(u,{value:e,placeholder:"请选择角色",options:q,style:{width:"100%"},onChange:s=>K(a.key,"roleId",s)})},{title:"商家",dataIndex:"merchantId",key:"merchantId",width:300,render:(e,a)=>t.jsx(u,{value:e,placeholder:"请选择商家",options:_.map(s=>({label:s.name,value:s.id})),style:{width:"100%"},onChange:s=>K(a.key,"merchantId",s)})},{title:"操作",key:"action",width:100,render:(e,a)=>t.jsx(p,{type:"link",danger:!0,size:"small",onClick:()=>we(a.key),children:"删除"})}],xe=[{title:"合同模板",dataIndex:"templateId",key:"templateId",width:200,render:(e,a)=>t.jsx(u,{value:e,placeholder:"请选择合同模板",options:ie,style:{width:"100%"},onChange:s=>$(a.key,"templateId",s)})},{title:"生成维度",dataIndex:"scope",key:"scope",width:200,render:(e,a)=>t.jsx(u,{value:e,placeholder:"请选择生成维度",options:R,style:{width:"100%"},onChange:s=>$(a.key,"scope",s)})},{title:"操作",key:"action",width:100,render:(e,a)=>t.jsx(p,{type:"link",danger:!0,size:"small",onClick:()=>be(a.key),children:"删除"})}],je=[{title:"ID",dataIndex:"id",key:"id",width:180},{title:"法律关系名称",dataIndex:"name",key:"name",width:200},{title:"资方",dataIndex:"capitalName",key:"capitalName",width:150},{title:"产品大类",dataIndex:"bizCategoryDesc",key:"bizCategoryDesc",width:120},{title:"产品子类",dataIndex:"bizCategorySubDesc",key:"bizCategorySubDesc",width:120},{title:"操作",key:"action",fixed:"right",width:100,render:(e,a)=>t.jsxs("span",{children:[t.jsx(p,{size:"small",type:"link",onClick:()=>Se(a),children:"修改"}),t.jsx(p,{size:"small",type:"link",danger:!0,onClick:()=>Ce(a),children:"删除"})]})}],fe=()=>{F(!1),z(null),g.resetFields(),y([]),j([]),k([]),I(!0)},Se=e=>{var r,c;console.log("handleEdit",e),F(!0),z(e);const a=((r=e.configContractTemplateList)==null?void 0:r.map(l=>({key:l.id,templateId:l.contractTemplateId,scope:l.scope})))||[],s=((c=e.fixedSignerList)==null?void 0:c.map(l=>({key:l.id,roleId:l.signerRole,merchantId:l.vendorId})))||[];g.setFieldsValue({name:e.name,capitalId:e.capitalId,bizCategory:e.bizCategory,bizCategorySub:e.bizCategorySub,term:e.term,rate:e.rate}),V(e.bizCategory),y(a),j(s),I(!0)},Ce=e=>{H.confirm({title:"确认删除",content:`确定要删除法律关系"${e.legalRelationName}"吗？`,okText:"确认",cancelText:"取消",onOk:()=>{f.success("删除成功")}})},Ie=()=>{const e={key:Date.now().toString(),templateId:"",generateDimension:""};y([...m,e])},be=e=>{y(m.filter(a=>a.key!==e))},$=(e,a,s)=>{y(r=>r.map(c=>c.key===e?{...c,[a]:s}:c))},ke=()=>{const e={key:Date.now().toString(),roleId:"",merchantId:""};j([...x,e])},we=e=>{j(x.filter(a=>a.key!==e))},K=(e,a,s)=>{j(r=>r.map(c=>c.key===e?{...c,[a]:s}:c))},ve=async()=>{try{const e=await v.validateFields();console.log("搜索条件:",e),C(!0),L(),setTimeout(()=>{C(!1)},1e3)}catch(e){console.error("表单验证失败:",e)}},ze=()=>{v.resetFields()},Oe=async()=>{try{const e=await g.validateFields();if(console.log("业务配置数据:",e),console.log("合同数据:",m),console.log("签章主体数据:",x),m.length===0){f.error("请至少添加一个合同配置");return}if(x.length===0){f.error("请至少添加一个签章主体");return}let a=[],s=[];m==null||m.forEach(l=>{console.log("....row",l,R);let i=R.find(h=>h.value==l.scope);S?a.push({contractTemplateId:l.templateId||"",scope:l.scope||"",scopeDesc:(i==null?void 0:i.label)||"",id:l.key||""}):a.push({contractTemplateId:l.templateId||"",scope:l.scope||"",scopeDesc:(i==null?void 0:i.label)||""})}),x.length&&x.forEach(l=>{let i=q.find(T=>T.value==l.roleId),h=_.find(T=>T.value==l.merchantId);S?s.push({signerRole:l.roleId||"",signerRoleDesc:(i==null?void 0:i.label)||"",vendorId:l.merchantId||"",vendorName:(h==null?void 0:h.label)||"",id:l.key}):s.push({signerRole:l.roleId||"",signerRoleDesc:(i==null?void 0:i.label)||"",vendorId:l.merchantId||"",vendorName:(h==null?void 0:h.label)||""})});let r={name:e.name,capitalId:e.capitalId,bizCategory:e.bizCategory,bizCategorySub:e.bizCategorySub,term:e.term,rate:e.rate,configContractTemplateList:a,fixedSignerList:s};S&&(r.id=b==null?void 0:b.id);const c=await Ee(r);console.log("....保存业务配置",c),f.success(S?"修改成功":"新增成功"),L(),I(!1),g.resetFields(),y([]),j([]),k([])}catch(e){console.error("表单验证失败:",e),f.error("请检查输入内容")}},Re=()=>{I(!1),z(null),g.resetFields(),y([]),j([]),k([])};return t.jsxs("div",{className:W.container,children:[t.jsx(o,{form:v,layout:"inline",className:W.searchForm,children:t.jsxs(J,{gutter:24,style:{width:"100%"},children:[t.jsx(d,{span:8,children:t.jsx(o.Item,{name:"legalRelationName",label:"法律关系名称",children:t.jsx(Q,{placeholder:"请输入法律关系名称"})})}),t.jsx(d,{span:8,children:t.jsx(o.Item,{name:"product",label:"产品",children:t.jsx(u,{placeholder:"请选择产品",options:A,allowClear:!0})})}),t.jsx(d,{span:8,children:t.jsx(o.Item,{name:"capital",label:"资方",children:t.jsx(u,{placeholder:"请选择资方",options:N.map(e=>({label:e.name,value:e.id})),allowClear:!0})})}),t.jsx(d,{span:24,children:t.jsx(o.Item,{children:t.jsxs(Le,{children:[t.jsx(p,{type:"primary",icon:t.jsx(Pe,{}),onClick:ve,children:"搜索"}),t.jsx(p,{icon:t.jsx(Be,{}),onClick:ze,children:"重置"}),t.jsx(p,{type:"primary",icon:t.jsx(D,{}),onClick:fe,children:"新增"})]})})})]})}),t.jsx(E,{columns:je,dataSource:P,loading:X,pagination:{total:P.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条`},scroll:{x:1200}}),t.jsx(H,{title:S?"编辑业务配置":"新增业务配置",open:Y,onOk:Oe,onCancel:Re,width:1e3,destroyOnClose:!0,children:t.jsxs(o,{form:g,layout:"vertical",initialValues:b||{},children:[t.jsxs(J,{gutter:16,children:[t.jsx(d,{span:12,children:t.jsx(o.Item,{name:"name",label:"法律关系名称",rules:[{required:!0,message:"请输入法律关系名称"}],children:t.jsx(Q,{placeholder:"请输入法律关系名称"})})}),t.jsx(d,{span:12,children:t.jsx(o.Item,{name:"capitalId",label:"资方",rules:[{required:!0,message:"请选择资方"}],children:t.jsx(u,{placeholder:"请选择资方",options:N.map(e=>({label:e.name,value:e.id}))})})}),t.jsx(d,{span:12,children:t.jsx(o.Item,{name:"bizCategory",label:"产品大类",rules:[{required:!0,message:"请选择产品大类"}],children:t.jsx(u,{placeholder:"请选择产品大类",options:A,onChange:V})})}),t.jsx(d,{span:12,children:t.jsx(o.Item,{name:"bizCategorySub",label:"产品小类",rules:[{required:!0,message:"请选择产品小类"}],children:t.jsx(u,{placeholder:"请先选择产品大类",options:M,disabled:M.length===0})})}),t.jsx(d,{span:12,children:t.jsx(o.Item,{name:"term",label:"天数",rules:[{required:!0,message:"请输入周期天数"}],children:t.jsx(U,{placeholder:"请输入天数",style:{width:"100%"}})})}),t.jsx(d,{span:12,children:t.jsx(o.Item,{name:"rate",label:"年化利率百分比",rules:[{required:!0,message:"请输入年化利率百分比"}],children:t.jsx(U,{placeholder:"年化利率",style:{width:"100%"}})})})]}),t.jsxs("div",{style:{marginTop:24},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[t.jsx("h4",{style:{margin:0},children:"合同配置"}),t.jsx(p,{type:"primary",icon:t.jsx(D,{}),onClick:Ie,children:"新增一组合同"})]}),t.jsx(E,{columns:xe,dataSource:m,pagination:!1,size:"small",locale:{emptyText:'暂无合同配置，请点击"新增一组合同"添加'},rowKey:"key"})]}),t.jsxs("div",{style:{marginTop:24},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[t.jsx("h4",{style:{margin:0},children:"签章主体配置"}),t.jsx(p,{type:"primary",icon:t.jsx(D,{}),onClick:ke,children:"添加签章人"})]}),t.jsx(E,{columns:ye,dataSource:x,pagination:!1,size:"small",locale:{emptyText:'暂无签章主体配置，请点击"添加签章人"添加'},rowKey:"key"})]})]})})]})};export{Xe as default};

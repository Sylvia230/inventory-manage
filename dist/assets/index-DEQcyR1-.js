import{F as t,f as pe,j as e,M as j,a as i,B as o,I as d,r as a,C as xe,R as g,S as B,d as je,s as n}from"./index-D-wqIkuG.js";import{s as ye}from"./index.module-CBa0FrbO.js";import{d as be}from"./debounce-DK5T3Zd6.js";import{U as fe}from"./index-DWg1XMdB.js";import{R as ge}from"./UploadOutlined-BB-st3N5.js";import{G as Ce,A as ke}from"./merchant-D_PcRRkx.js";import{F as Ie}from"./Table-CAvvVgJI.js";import{S as v}from"./index-DbWrGEU6.js";import{C as Se}from"./index-ByYJXtrk.js";import{T as C}from"./index-CpPlb8ug.js";import{T as z}from"./index-lnPGni--.js";import"./Pagination-DhMnuXBS.js";const Te=({open:m,onCancel:r,onOk:p,loading:x=!1,merchantData:F})=>{const[h]=t.useForm(),[y,u]=pe.useState([]),A=async()=>{try{const c=await h.validateFields();p(c)}catch(c){console.error("Validate Failed:",c)}},k=()=>{h.resetFields(),u([]),r()},M={onRemove:c=>{const L=y.indexOf(c),I=y.slice();I.splice(L,1),u(I)},beforeUpload:c=>(u([c]),!1),fileList:y};return e.jsx(j,{title:"商家审核",open:m,onCancel:k,width:600,footer:[e.jsx(o,{onClick:k,children:"驳回"},"reject"),e.jsx(o,{type:"primary",loading:x,onClick:A,children:"通过"},"approve")],children:e.jsxs(t,{form:h,layout:"inline",initialValues:F,children:[e.jsx(i,{span:24,children:e.jsx(t.Item,{label:"公司全称",name:"name",children:"张三"})}),e.jsx(i,{children:e.jsx(t.Item,{label:"公司地址",name:"address",children:"浙江杭州"})}),e.jsx(i,{span:24,children:e.jsx(t.Item,{label:"营业执照",name:"businessLicense",children:e.jsx(fe,{...M,listType:"picture",maxCount:1,accept:"image/*",children:e.jsx(o,{icon:e.jsx(ge,{}),children:"上传营业执照"})})})}),e.jsx(i,{span:24,children:e.jsx(t.Item,{label:"法人信息",name:"legalPerson",children:"李四"})}),e.jsx(i,{span:24,children:e.jsx(t.Item,{label:"经营范围",name:"businessScope",children:"浙江杭州台州"})}),e.jsx(t.Item,{label:"备注",name:"remark",rules:[{required:!0,message:"请输入备注"}],children:e.jsx(d.TextArea,{rows:4,placeholder:"请输入备注",style:{width:"500px"}})})]})})},_e=()=>{const[m,r]=a.useState(!1),[p]=t.useForm(),[x]=t.useForm(),[F,h]=a.useState(!1),[y,u]=a.useState(!1),[A,k]=a.useState([]),[M,c]=a.useState(!1),[L,I]=a.useState([]),[E,V]=a.useState(!1),[we,O]=a.useState(!1),[U,ve]=a.useState(1),[_,Fe]=a.useState(10),[Ae,$]=a.useState(0),[G,q]=a.useState(!1),[Me,S]=a.useState(null),[T]=t.useForm(),[J,w]=a.useState(!1),[b]=t.useForm(),[N,D]=a.useState([]),K=[{label:"新车",value:"new_car"},{label:"二手车",value:"used_car"},{label:"试驾车",value:"test_car"}],Q=[{label:"自有场地",value:"owned"},{label:"租赁场地",value:"rented"},{label:"合作场地",value:"cooperative"}],H=[{value:"beijing",label:"北京",children:[{value:"chaoyang",label:"朝阳区",children:[{value:"branch1",label:"朝阳支行"}]}]}],P=async(s=U,l=_)=>{r(!0);try{const R=await Ce({page:s,pageSize:l});console.log("商家列表",R),D(R.result||[]),$(R.totalCount||0)}catch(f){console.error("获取商家列表失败:",f),n.error("获取数据失败")}finally{r(!1)}};a.useEffect(()=>{P()},[]);const W=s=>{j.confirm({title:"确认加入黑名单",content:`确定要将商家"${s.name}"加入黑名单吗？`,okText:"确认",cancelText:"取消",onOk:async()=>{try{r(!0),D(N.map(l=>l.id===s.id?{...l,status:"黑名单"}:l)),n.success("已加入黑名单")}catch{n.error("操作失败")}finally{r(!1)}}})},X=s=>{S(s),h(!0)},Y=s=>{S(s),u(!0)},Z=async s=>{try{r(!0),n.success("标签添加成功"),h(!1)}catch{n.error("操作失败")}finally{r(!1)}},ee=async s=>{try{r(!0),n.success("银行卡添加成功"),u(!1),x.resetFields()}catch{n.error("操作失败")}finally{r(!1)}},se=async s=>{try{r(!0),console.log("搜索条件：",s)}catch{n.error("搜索失败")}finally{r(!1)}},te=()=>{p.resetFields()},le=()=>{w(!0),b.resetFields()},ae=async s=>{try{r(!0);const l={customerName:s.customerName,mainBusiness:s.mainBusiness,venueType:s.venueType,totalCapital:s.totalCapital,totalDebt:s.totalDebt,revenue:s.revenue,employeeCount:s.employeeCount,mainTradingPartner:s.mainTradingPartner,productType:s.productType};await ke(l)?(n.success("新增商家成功"),w(!1),b.resetFields(),P()):n.error("新增失败")}catch(l){console.error("新增商家失败:",l),n.error("新增失败")}finally{r(!1)}},re=s=>{switch(s){case"待审核":return"warning";case"正常":return"success";case"黑名单":return"error";default:return"default"}},ne=s=>{switch(s){case"A":return"success";case"B":return"processing";case"C":return"warning";case"D":return"error";default:return"default"}},ie=s=>{S(s),V(!0)},oe=async s=>{try{O(!0),n.success("审核成功"),V(!1)}catch{n.error("审核失败")}finally{O(!1)}},ce=s=>{S(s),T.setFieldsValue({dailyRate:s.creditLimit}),q(!0)},de=async s=>{try{r(!0),{code:200,msg:"更新成功"}.code===200&&(n.success("日费率更新成功"),q(!1),P())}catch(l){console.error("更新日费率失败:",l),n.error("更新失败")}finally{r(!1)}},ue=[{title:"商家名称",dataIndex:"name",key:"name"},{title:"统一社会信用代码",width:160,dataIndex:"socialCreditCode",key:"socialCreditCode"},{title:"法人代表",dataIndex:"legalPerson",key:"legalPerson"},{title:"法人代表身份证",width:160,dataIndex:"legalPersonId",key:"legalPersonId"},{title:"法人签章人",dataIndex:"legalSignature",key:"legalSignature"},{title:"企业签章人",dataIndex:"companySignature",key:"companySignature"},{title:"联系人",dataIndex:"contactName",key:"contactName"},{title:"经营场所",dataIndex:"businessAddress",key:"businessAddress"},{title:"商家信用等级",dataIndex:"creditLevel",key:"creditLevel",render:s=>e.jsx(z,{color:ne(s),children:s})},{title:"服务费日费率",dataIndex:"creditLimit",key:"creditLimit"},{title:"状态",dataIndex:"status",key:"status",render:s=>e.jsx(z,{color:re(s),children:s})},{title:"操作",key:"action",fixed:"right",width:"200",render:(s,l)=>e.jsxs("div",{children:[e.jsx(o,{type:"link",onClick:()=>ce(l),children:"修改日费率"}),e.jsx(o,{type:"link",onClick:()=>ie(l),children:"审核"}),e.jsx(o,{type:"link",onClick:()=>X(l),children:"新增标签"}),l.status!=="黑名单"&&e.jsx(o,{type:"link",onClick:()=>W(l),children:"添加黑名单"}),e.jsx(o,{type:"link",onClick:()=>Y(l),children:"添加银行卡"})]})}],he=async s=>{c(!0);try{const l=[{value:"urgent",label:"加急",color:"red"},{value:"vip",label:"VIP客户",color:"gold"},{value:"new",label:"新客户",color:"green"},{value:"special",label:"特殊处理",color:"purple"}].filter(f=>f.label.toLowerCase().includes(s.toLowerCase()));I(l)}catch{n.error("获取标签列表失败")}finally{c(!1)}},me=a.useMemo(()=>be(he,500),[]);return e.jsxs("div",{children:[e.jsx(xe,{className:"mb-16",children:e.jsx(t,{form:p,onFinish:se,layout:"inline",children:e.jsxs(g,{gutter:24,style:{width:"100%"},children:[e.jsx(i,{span:7,children:e.jsx(t.Item,{name:"name",label:"商家名称",children:e.jsx(d,{placeholder:"请输入商家名称",allowClear:!0})})}),e.jsx(i,{span:10,style:{textAlign:"left"},children:e.jsxs(B,{children:[e.jsx(o,{type:"primary",htmlType:"submit",loading:m,children:"查询"}),e.jsx(o,{onClick:te,children:"重置"}),e.jsx(o,{type:"primary",onClick:le,children:"新增商家"})]})})]})})}),e.jsx("div",{className:ye.container,children:e.jsx(Ie,{columns:ue,dataSource:N,rowKey:"id",loading:m,scroll:{x:1500},pagination:{showSizeChanger:!0,showQuickJumper:!0,showTotal:s=>`共 ${s} 条`}})}),e.jsx(j,{title:"添加标签",open:F,onOk:Z,onCancel:()=>{h(!1),p.resetFields()},okText:"确定",cancelText:"取消",children:e.jsx(t,{form:p,layout:"inline",children:e.jsx(t.Item,{label:"标签",required:!0,tooltip:"请至少选择一个标签",children:e.jsx(v,{style:{width:"280px"},placeholder:"请选择或搜索标签",value:A,onChange:k,onSearch:me,notFoundContent:M?e.jsx(je,{size:"small"}):null,options:L,optionLabelProp:"label",optionFilterProp:"label",showSearch:!0,allowClear:!0})})})}),e.jsx(j,{title:"添加银行卡",open:y,onCancel:()=>{u(!1),x.resetFields()},footer:null,children:e.jsxs(t,{form:x,onFinish:ee,layout:"vertical",children:[e.jsx(t.Item,{name:"accountName",label:"户名",rules:[{required:!0,message:"请输入户名"}],children:e.jsx(d,{placeholder:"请输入户名"})}),e.jsx(t.Item,{name:"bankBranch",label:"开户支行",children:e.jsx(Se,{options:H,placeholder:"请选择开户支行",allowClear:!0})}),e.jsx(t.Item,{name:"accountNumber",label:"账户",rules:[{required:!0,message:"请输入账户"}],children:e.jsx(d,{placeholder:"请输入账户"})}),e.jsx(t.Item,{name:"phone",label:"手机号",rules:[{required:!0,message:"请输入手机号"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号"}],children:e.jsx(d,{placeholder:"请输入手机号"})}),e.jsx(t.Item,{name:"idType",label:"证件类型",children:e.jsx(v,{placeholder:"请选择证件类型",allowClear:!0,options:[{value:"身份证",label:"身份证"},{value:"护照",label:"护照"},{value:"其他",label:"其他"}]})}),e.jsx(t.Item,{name:"idNumber",label:"证件编号",children:e.jsx(d,{placeholder:"请输入证件编号"})}),e.jsx(t.Item,{children:e.jsxs(B,{style:{width:"100%",justifyContent:"flex-end"},children:[e.jsx(o,{onClick:()=>{u(!1),x.resetFields()},children:"取消"}),e.jsx(o,{type:"primary",htmlType:"submit",loading:m,children:"确定"})]})})]})}),e.jsx(j,{title:"修改日费率",open:G,onOk:()=>{T.validateFields().then(s=>{de()})},onCancel:()=>{q(!1),T.resetFields()},okText:"确定",cancelText:"取消",children:e.jsx(t,{form:T,layout:"vertical",children:e.jsx(t.Item,{label:"日费率 (%)",name:"dailyRate",rules:[{required:!0,message:"请输入日费率"},{type:"number",min:0,max:100,message:"请输入0~100之间的数值"}],children:e.jsx(C,{placeholder:"请输入日费率 (%)",style:{width:"100%"}})})})}),e.jsx(Te,{open:E,onCancel:()=>V(!1),onOk:oe}),e.jsx(j,{title:"新增商家",open:J,onCancel:()=>{w(!1),b.resetFields()},footer:null,width:800,children:e.jsxs(t,{form:b,onFinish:ae,layout:"vertical",children:[e.jsxs(g,{gutter:16,children:[e.jsx(i,{span:12,children:e.jsx(t.Item,{name:"customerName",label:"客户名",rules:[{required:!0,message:"请填写公司名称"}],children:e.jsx(d,{placeholder:"请填写公司名称"})})}),e.jsx(i,{span:12,children:e.jsx(t.Item,{name:"mainBusiness",label:"主营业务",rules:[{required:!0,message:"请填写主营业务"}],children:e.jsx(d,{placeholder:"请填写主营业务"})})})]}),e.jsxs(g,{gutter:16,children:[e.jsx(i,{span:12,children:e.jsx(t.Item,{name:"venueType",label:"经营场地类型",rules:[{required:!0,message:"请选择经营场地类型"}],children:e.jsx(v,{placeholder:"请选择经营场地类型",options:Q})})}),e.jsx(i,{span:12,children:e.jsx(t.Item,{name:"productType",label:"产品类型",rules:[{required:!0,message:"请选择产品类型"}],children:e.jsx(v,{placeholder:"请选择产品类型",options:K})})})]}),e.jsxs(g,{gutter:16,children:[e.jsx(i,{span:8,children:e.jsx(t.Item,{name:"totalCapital",label:"资金总额（万）",rules:[{required:!0,message:"请输入资金总额"}],children:e.jsx(C,{placeholder:"请输入资金总额",style:{width:"100%"},min:0,precision:2})})}),e.jsx(i,{span:8,children:e.jsx(t.Item,{name:"totalDebt",label:"负债总额（万）",rules:[{required:!0,message:"请输入负债总额"}],children:e.jsx(C,{placeholder:"请输入负债总额",style:{width:"100%"},min:0,precision:2})})}),e.jsx(i,{span:8,children:e.jsx(t.Item,{name:"revenue",label:"营业收入（万）",rules:[{required:!0,message:"请输入营业收入"}],children:e.jsx(C,{placeholder:"请输入营业收入",style:{width:"100%"},min:0,precision:2})})})]}),e.jsxs(g,{gutter:16,children:[e.jsx(i,{span:12,children:e.jsx(t.Item,{name:"employeeCount",label:"员工人数（人）",rules:[{required:!0,message:"请输入员工人数"}],children:e.jsx(C,{placeholder:"请输入员工人数",style:{width:"100%"},min:1,precision:0})})}),e.jsx(i,{span:12,children:e.jsx(t.Item,{name:"mainTradingPartner",label:"主要交易对手名称",rules:[{required:!0,message:"请填写公司名称"}],children:e.jsx(d,{placeholder:"请填写公司名称"})})})]}),e.jsx(t.Item,{style:{marginTop:24,textAlign:"right"},children:e.jsxs(B,{children:[e.jsx(o,{onClick:()=>{w(!1),b.resetFields()},children:"取消"}),e.jsx(o,{type:"primary",htmlType:"submit",loading:m,children:"确定"})]})})]})})]})};export{_e as default};

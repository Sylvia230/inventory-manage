import{y as f,r as a,F as l,s as u,j as t,B as m,M as k,I,S as A}from"./index-D8ReppmJ.js";import{a as B}from"./dept-Bm6bgNYr.js";import{F as Q}from"./Table-uXQ28xlW.js";import{S as U}from"./index-D5ba-O3m.js";import"./Pagination-DkTh5KJv.js";const $="_container_iawkd_1",J="_header_iawkd_7",R={container:$,header:J};function K(r){return f.post("/userRole/pageQuery",r).then(n=>n)}async function G(r){return f.post("/userRole/saveUserRole",r)}async function H(r){return f.post("/userRole/removeUserRole?id="+r)}const se=()=>{const[r,n]=a.useState(!1),[T,i]=a.useState(!1),[y,S]=a.useState("add"),[b,g]=a.useState(null),[o]=l.useForm(),[C,F]=a.useState([]),[v,L]=a.useState([]),[c,x]=a.useState({current:1,pageSize:10,total:0}),[N,p]=a.useState([]),[W,j]=a.useState(!1);a.useEffect(()=>{h(),z()},[c.current,c.pageSize]);const h=async(e,s)=>{try{n(!0);const d=s||c,E={...e,pageNo:d.current,pageSize:d.pageSize},w=await K(E);F(w.result||[]),x(V=>({...V,total:w.totalCount||0}))}catch(d){console.error("获取部门列表失败:",d)}finally{n(!1)}},z=async(e={pageSize:1e3})=>{j(!0);try{const s=await B(e);console.log(s,"response"),L(s||[])}catch(s){console.error("获取用户数据失败:",s),u.error("获取用户数据失败")}finally{j(!1)}},M=e=>{x(e)},_=[{title:"角色名称",dataIndex:"roleName",key:"roleName",width:150},{title:"已选员工",dataIndex:"userInfoDTOList",key:"userInfoDTOList",width:200,render:e=>t.jsx("span",{children:e?e.map(s=>s.personName).join(", "):"未选择员工"})},{title:"描述",dataIndex:"description",key:"description",width:180},{title:"创建时间",dataIndex:"createTimeStr",key:"createTimeStr",width:180},{title:"操作",key:"action",width:150,render:(e,s)=>t.jsxs(A,{size:"middle",children:[t.jsx(m,{type:"link",children:"分配权限"}),t.jsx(m,{type:"link",onClick:()=>O(s),children:"编辑"}),t.jsx(m,{type:"link",danger:!0,onClick:()=>P(s),children:"删除"})]})}],D=()=>{S("add"),g(null),i(!0),o.resetFields()},O=e=>{S("edit"),g(e),i(!0),p(e.permissions||[]),o.setFieldsValue({...e,staffIds:e.staffIds})},P=e=>{k.confirm({title:"确认删除",content:`确定要删除角色 ${e.name} 吗？`,okText:"确认",cancelText:"取消",onOk:async()=>{try{n(!0),await H(e.id),u.success("删除成功"),h()}catch(s){console.error("删除失败:",s)}finally{n(!1)}}})},q=async()=>{try{let e=await o.validateFields();const s={...e,permissions:N};y==="add"||(e={...b,...s}),await G(e),u.success("保存成功"),i(!1),o.resetFields(),p([]),h()}catch(e){console.error("表单提交失败:",e),u.error("保存失败")}};return t.jsxs("div",{className:R.container,children:[t.jsx("div",{className:R.header,children:t.jsx(m,{type:"primary",onClick:D,children:"新增角色"})}),t.jsx(Q,{columns:_,dataSource:C,loading:r,rowKey:"id",pagination:{...c,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条`},onChange:M}),t.jsx(k,{title:y==="add"?"新增角色":"编辑角色",open:T,onOk:q,onCancel:()=>{i(!1),o.resetFields(),p([])},destroyOnClose:!0,width:800,children:t.jsxs(l,{form:o,layout:"vertical",children:[t.jsx(l.Item,{name:"roleName",label:"角色名称",rules:[{required:!0,message:"请输入角色名称"}],children:t.jsx(I,{placeholder:"请输入角色名称"})}),t.jsx(l.Item,{name:"description",label:"描述",rules:[{required:!0,message:"请输入描述"}],children:t.jsx(I,{placeholder:"请输入描述"})}),t.jsx(l.Item,{name:"userIds",label:"选择员工",rules:[{required:!1,message:"请选择员工"}],children:t.jsx(U,{mode:"multiple",placeholder:"请选择员工",style:{width:"100%"},options:v.map(e=>({label:e.personName,value:e.id}))})})]})})]})};export{se as default};

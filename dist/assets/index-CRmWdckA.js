var ls=Object.defineProperty;var as=(d,o,m)=>o in d?ls(d,o,{enumerable:!0,configurable:!0,writable:!0,value:m}):d[o]=m;var H=(d,o,m)=>as(d,typeof o!="symbol"?o+"":o,m);import{r as c,b as je,j as e,M as L,R as S,a as u,S as F,B as b,s as r,c as rs,u as is,F as p,G as os,d as cs,C as R,I as M}from"./index-D-wqIkuG.js";import{d as U}from"./dayjs.min-DgkXXTSy.js";import{a as ds,b as us,P as _,d as ms,s as hs,u as Me}from"./waybill-DrscvDT3.js";import{m as xs}from"./mobx.esm-J_RULll_.js";import{D as Ue}from"./index-B21Kr0WP.js";import{F as Fe,R as de}from"./Table-CAvvVgJI.js";import{D as l}from"./index-DWc-Cnp1.js";import{R as ps}from"./ArrowLeftOutlined-Ct5qgGPj.js";import{R as ue}from"./DeleteOutlined-BB4mUHSo.js";import{R as js}from"./CarOutlined-BMwrVxX2.js";import{T as me}from"./index-lnPGni--.js";import{R as Y}from"./EyeOutlined-DRE-aj0F.js";import{U as ee}from"./index-DWg1XMdB.js";import{R as se}from"./PlusOutlined-DwBRAV9i.js";import{I as Le}from"./index-BQMSiQ38.js";import{S as gs}from"./index-DbWrGEU6.js";import"./Pagination-DhMnuXBS.js";var fs={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM504 618H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM312 490v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8z"}}]},name:"file-text",theme:"outlined"},ys={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 248H728l-32.4-90.8a32.07 32.07 0 00-30.2-21.2H358.6c-13.5 0-25.6 8.5-30.1 21.2L296 248H160c-44.2 0-80 35.8-80 80v456c0 44.2 35.8 80 80 80h704c44.2 0 80-35.8 80-80V328c0-44.2-35.8-80-80-80zm8 536c0 4.4-3.6 8-8 8H160c-4.4 0-8-3.6-8-8V328c0-4.4 3.6-8 8-8h186.7l17.1-47.8 22.9-64.2h250.5l22.9 64.2 17.1 47.8H864c4.4 0 8 3.6 8 8v456zM512 384c-88.4 0-160 71.6-160 160s71.6 160 160 160 160-71.6 160-160-71.6-160-160-160zm0 256c-53 0-96-43-96-96s43-96 96-96 96 43 96 96-43 96-96 96z"}}]},name:"camera",theme:"outlined"},bs={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M644.7 669.2a7.92 7.92 0 00-6.5-3.3H594c-6.5 0-10.3 7.4-6.5 12.7l73.8 102.1c3.2 4.4 9.7 4.4 12.9 0l114.2-158c3.8-5.3 0-12.7-6.5-12.7h-44.3c-2.6 0-5 1.2-6.5 3.3l-63.5 87.8-22.9-31.9zM688 306v-48c0-4.4-3.6-8-8-8H296c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8zm-392 88c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H296zm184 458H208V148h560v296c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V108c0-17.7-14.3-32-32-32H168c-17.7 0-32 14.3-32 32v784c0 17.7 14.3 32 32 32h312c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm402.6-320.8l-192-66.7c-.9-.3-1.7-.4-2.6-.4s-1.8.1-2.6.4l-192 66.7a7.96 7.96 0 00-5.4 7.5v251.1c0 2.5 1.1 4.8 3.1 6.3l192 150.2c1.4 1.1 3.2 1.7 4.9 1.7s3.5-.6 4.9-1.7l192-150.2c1.9-1.5 3.1-3.8 3.1-6.3V538.7c0-3.4-2.2-6.4-5.4-7.5zM826 763.7L688 871.6 550 763.7V577l138-48 138 48v186.7z"}}]},name:"file-protect",theme:"outlined"};function he(){return he=Object.assign?Object.assign.bind():function(d){for(var o=1;o<arguments.length;o++){var m=arguments[o];for(var f in m)Object.prototype.hasOwnProperty.call(m,f)&&(d[f]=m[f])}return d},he.apply(this,arguments)}const vs=(d,o)=>c.createElement(je,he({},d,{ref:o,icon:ys})),Is=c.forwardRef(vs);function xe(){return xe=Object.assign?Object.assign.bind():function(d){for(var o=1;o<arguments.length;o++){var m=arguments[o];for(var f in m)Object.prototype.hasOwnProperty.call(m,f)&&(d[f]=m[f])}return d},xe.apply(this,arguments)}const ws=(d,o)=>c.createElement(je,xe({},d,{ref:o,icon:bs})),Cs=c.forwardRef(ws);function pe(){return pe=Object.assign?Object.assign.bind():function(d){for(var o=1;o<arguments.length;o++){var m=arguments[o];for(var f in m)Object.prototype.hasOwnProperty.call(m,f)&&(d[f]=m[f])}return d},pe.apply(this,arguments)}const Ps=(d,o)=>c.createElement(je,pe({},d,{ref:o,icon:fs})),_s=c.forwardRef(Ps),Ss="_container_121v0_1",Ds="_header_121v0_6",Ts="_card_121v0_21",Os="_loadingContainer_121v0_40",ks="_errorContainer_121v0_48",Rs="_uploadModal_121v0_76",Ns="_photoGrid_121v0_135",Ms="_photoItem_121v0_142",Ls="_uploadedPhoto_121v0_206",Us="_photoActions_121v0_214",g={container:Ss,header:Ds,card:Ts,loadingContainer:Os,errorContainer:ks,uploadModal:Rs,photoGrid:Ns,photoItem:Ms,uploadedPhoto:Ls,photoActions:Us},Fs="_insuranceModal_1os2t_1",As="_modalContent_1os2t_10",Es="_stepContent_1os2t_17",zs="_dateSelector_1os2t_28",Vs="_label_1os2t_35",$s="_hint_1os2t_40",Hs="_vehicleTable_1os2t_56",Ys="_infoSection_1os2t_85",Bs="_stepButtons_1os2t_115",w={insuranceModal:Fs,modalContent:As,stepContent:Es,dateSelector:zs,label:Vs,hint:$s,vehicleTable:Hs,infoSection:Ys,stepButtons:Bs};class Ws{constructor(){H(this,"wayBilllist",[]);H(this,"setWayBillList",o=>{this.wayBilllist=o});H(this,"insurancePersonInfo",{});H(this,"setInsurancePersonInfo",o=>{this.insurancePersonInfo=o});xs(this)}}const qs=new Ws,Gs=({visible:d,onCancel:o,selectedVehicles:m,onSuccess:f,waybillNo:n})=>{const[B,v]=c.useState(0),[O,W]=c.useState(null),[N,A]=c.useState([]),[te,q]=c.useState(!1),{insurancePersonInfo:j,setInsurancePersonInfo:ne}=qs;c.useEffect(()=>{if((m==null?void 0:m.length)>0){const h=m.map(y=>({id:y.id,vin:y.vin,vehicleAttribute:`${y.vehicleName}`,startLocation:"上海市浦东新区",endLocation:y.targetWarehouse,contractPrice:y.contractPrice?y.contractPrice/1e4:0,insuranceAmount:y.contractPrice?y.contractPrice*.8:0,insurancePremium:y.contractPrice?y.contractPrice*.008:0,insuranceStartDate:"",insuranceEndDate:""}));A(h)}},[m]),c.useEffect(()=>{d&&ae()},[d]);const G=h=>{if(W(h),h){const y=h.format("YYYY-MM-DD HH:mm:ss"),E=h.add(3,"month").format("YYYY-MM-DD HH:mm:ss"),z=N.map(k=>({...k,insuranceStartDate:y,insuranceEndDate:E}));A(z)}},le=[{title:"序号",key:"index",width:60,render:(h,y,E)=>E+1},{title:"车架号",dataIndex:"vin",key:"vin",width:150},{title:"车型",dataIndex:"vehicleName",key:"vehicleName",width:200},{title:"起始地",dataIndex:"startLocation",key:"startLocation",width:150},{title:"目的地",dataIndex:"endLocation",key:"endLocation",width:120},{title:"合同价(万元)",dataIndex:"contractPrice",key:"contractPrice",width:120,render:h=>h.toFixed(2)},{title:"保额",dataIndex:"insuranceAmount",key:"insuranceAmount",width:120,render:h=>h.toLocaleString()},{title:"保险金额(万元)",dataIndex:"insurancePremium",key:"insurancePremium",width:120,render:h=>(h/1e4).toFixed(2)},{title:"保险起期",dataIndex:"insuranceStartDate",key:"insuranceStartDate",width:120},{title:"保险终期",dataIndex:"insuranceEndDate",key:"insuranceEndDate",width:120}],ae=async()=>{const h=await ds({tmsWaybillNo:n});ne(h.result),console.log(h,"getInsurancePersonInfo")},D=()=>{v(0)},I=async()=>{try{q(!0),await new Promise(h=>setTimeout(h,2e3)),await us({tmsWaybillNo:n,takeEffect:U(O).format("YYYY-MM-DD HH:mm:ss"),tmsWaybillCarDTOList:N}),r.success(`成功创建 ${m.length} 辆车的电子保单`),q(!1),f(),T()}catch{q(!1),r.error("创建保单失败")}},T=()=>{v(0),W(null),o()};return e.jsx(L,{title:"创建电子保单",open:d,onCancel:T,width:1200,height:600,style:{overflowY:"scroll"},onOk:I,okText:"创建",cancelText:"关闭",className:w.insuranceModal,destroyOnClose:!0,children:e.jsxs("div",{className:w.modalContent,children:[B===0&&e.jsxs("div",{className:w.stepContent,children:[e.jsx("div",{className:w.dateSelector,children:e.jsxs(S,{gutter:16,align:"middle",children:[e.jsx(u,{span:4,children:e.jsx("label",{className:w.label,children:"保险生效起期："})}),e.jsx(u,{span:8,children:e.jsx(Ue,{showTime:!0,value:O,onChange:G,placeholder:"请选择保险生效起期",style:{width:"100%"},disabledDate:h=>h&&h<U().startOf("day")})}),e.jsx(u,{span:12,children:e.jsx("span",{className:w.hint,children:"选择起期后，保险终期将自动设置为起期后3个月"})})]})}),e.jsx("div",{className:w.vehicleTable,children:e.jsx(Fe,{columns:le,dataSource:N,rowKey:"id",pagination:!1,scroll:{x:1200},size:"small"})}),e.jsx("div",{children:e.jsxs(S,{gutter:24,children:[e.jsx(u,{span:12,children:e.jsxs(l,{bordered:!0,column:1,size:"small",className:w.infoSection,children:[e.jsx(l.Item,{label:"被投保人",children:j.insuredPersonName}),e.jsx(l.Item,{label:"统一社会信用代码",children:j.insuredPersonReditCode}),e.jsx(l.Item,{label:"被投保联系人",children:j.insuredPersonContactName}),e.jsx(l.Item,{label:"联系电话",children:j.insuredPersonContactPhone})]})}),e.jsx(u,{span:12,children:e.jsxs(l,{bordered:!0,column:1,size:"small",className:w.infoSection,children:[e.jsx(l.Item,{label:"投保人",children:j.policyholderName}),e.jsx(l.Item,{label:"统一社会信用代码",children:j.policyholderReditCode}),e.jsx(l.Item,{label:"投保联系人",children:j.policyholderContactName}),e.jsx(l.Item,{label:"联系电话",children:j.policyholderContactPhone})]})})]})})]}),B===1&&e.jsxs("div",{className:w.stepContent,children:[e.jsx("h3",{children:"投被保信息"}),e.jsx("div",{children:e.jsxs(S,{gutter:24,children:[e.jsx(u,{span:12,children:e.jsxs(l,{bordered:!0,column:1,size:"small",className:w.infoSection,children:[e.jsx(l.Item,{label:"被投保人",children:j.insuredPersonName}),e.jsx(l.Item,{label:"统一社会信用代码",children:j.insuredPersonReditCode}),e.jsx(l.Item,{label:"被投保联系人",children:j.insuredPersonContactName}),e.jsx(l.Item,{label:"联系电话",children:j.insuredPersonContactPhone})]})}),e.jsx(u,{span:12,children:e.jsxs(l,{bordered:!0,column:1,size:"small",className:w.infoSection,children:[e.jsx(l.Item,{label:"投保人",children:j.policyholderName}),e.jsx(l.Item,{label:"统一社会信用代码",children:j.policyholderReditCode}),e.jsx(l.Item,{label:"投保联系人",children:j.policyholderContactName}),e.jsx(l.Item,{label:"联系电话",children:j.policyholderContactPhone})]})})]})}),e.jsx("div",{className:w.stepButtons,children:e.jsxs(F,{children:[e.jsx(b,{onClick:T,children:"关闭"}),e.jsx(b,{onClick:D,children:"上一步"}),e.jsx(b,{type:"primary",onClick:I,loading:te,children:"创建"})]})})]})]})})},gt=()=>{var ve,Ie,we,Ce,Pe,_e,Se,De,Te,Oe,ke,Re,Ne;const{id:d}=rs(),o=is(),[m,f]=c.useState(!0),[n,B]=c.useState(null),[v,O]=c.useState([]),[W,N]=c.useState(!1),[A,te]=c.useState(""),[q,j]=c.useState(_.FRONT_LEFT_45),[ne,G]=c.useState(!1),[le,ae]=c.useState(""),[D]=p.useForm(),[I,T]=c.useState({}),[h,y]=c.useState(!1),[E,z]=c.useState(!1),[k]=p.useForm(),[ge,Q]=c.useState(!1),[K,V]=c.useState([]),[C,re]=c.useState(null),[Ae,X]=c.useState(!1),[ie,J]=c.useState([]),[Ee,fe]=c.useState("inspection"),[Qs,Ks]=c.useState(!1),[Xs,Js]=c.useState(!1),ye=[{name:"leftFront45",label:"左前45度照片",value:"1"},{name:"leftFrontDoor",label:"左前门含A柱的照片",value:"2"},{name:"leftRearDoor",label:"左后门的照片",value:"3"},{name:"rearWheel",label:"后轮轮毂照片",value:"4"},{name:"centerConsole",label:"中控台照片",value:"5"},{name:"dashboard",label:"仪表盘照片",value:"6"},{name:"rightRear45",label:"右后45度照片",value:"7"},{name:"rightFrontDoor",label:"右前门含A柱的照片",value:"8"},{name:"nameplate",label:"铭牌照片",value:"9"},{name:"inventoryForm",label:"商品车入库信息采集表",value:"10"},{name:"engineBay",label:"发动机舱",value:"11"}];_.FRONT_LEFT_45,_.FRONT_LEFT_DOOR_A_PILLAR,_.REAR_LEFT_DOOR,_.REAR_WHEEL_HUB,_.CENTER_CONSOLE,_.DASHBOARD,_.RIGHT_REAR_45,_.RIGHT_FRONT_DOOR_A_PILLAR,_.NAMEPLATE,_.INVENTORY_FORM,_.ENGINE_BAY,c.useEffect(()=>{ze(),d&&$()},[d]);const ze=async()=>{const s=await os("FileTypeEnum");console.log("....getUploadVehicleTypeEnum",s)},$=async()=>{try{f(!0);const s=await ms(d);console.log("....response",s),B(s)}catch(s){r.error("获取运单详情失败"),console.error("获取运单详情失败:",s)}finally{f(!1)}},Ve=s=>{const a={pending:{color:"orange",text:"待发车"},in_transit:{color:"blue",text:"运输中"},delivered:{color:"green",text:"已送达"},cancelled:{color:"red",text:"已取消"}}[s]||{color:"default",text:"未知"};return e.jsx(me,{color:a.color,children:a.text})},$e=[{title:"序号",key:"index",width:60,render:(s,t,a)=>a+1},{title:"车架号",dataIndex:"vin",key:"vin",width:150},{title:"车型",dataIndex:"vehicleName",key:"vehicleName",width:120},{title:"内外饰",dataIndex:"outInColor",key:"outInColor",width:150},{title:"目的仓库",dataIndex:"targetWarehouse",key:"targetWarehouse",width:120,render:s=>{var t;return e.jsx("div",{color:"blue",children:(t=n==null?void 0:n.wmsWarehouseDTO)==null?void 0:t.warehouseAddress})}},{title:"合同价(元)",dataIndex:"contractAmountStr",key:"contractAmountStr",width:100},{title:"指导价(元)",dataIndex:"guidePrice",key:"guidePrice",width:100},{title:"预计到达时间",dataIndex:"estimatedArrivalTime",key:"estimatedArrivalTime",width:150,render:s=>e.jsx("div",{children:n==null?void 0:n.reachTimeStr})},{title:"质损照片",dataIndex:"isQualityDamage",key:"isQualityDamage",width:80,render:(s,t)=>{var a,i;return e.jsx(F,{size:"small",children:e.jsx(b,{type:"link",icon:e.jsx(Y,{}),onClick:()=>Ge(t.id),size:"small",disabled:!((a=t.qualityDamageImgUrlList)!=null&&a.length),children:((i=t.qualityDamageImgUrlList)==null?void 0:i.length)||0})})}},{title:"验车照片",key:"photos",width:100,render:(s,t)=>{var a,i;return e.jsx(F,{size:"small",children:e.jsx(b,{type:"link",icon:e.jsx(Y,{}),onClick:()=>qe(t.id),size:"small",disabled:!((a=t.inspectionCarDTOS)!=null&&a.length),children:((i=t.inspectionCarDTOS)==null?void 0:i.length)||0})})}},{title:"操作",key:"action",width:100,fixed:"right",render:(s,t)=>e.jsx(b,{type:"link",icon:e.jsx(Is,{}),onClick:()=>Ye(t.id),children:"上传照片"})}],He={selectedRowKeys:v,onChange:s=>{O(s)}},be=()=>{o("/waybill/list")},Ye=s=>{var a;te(s);const t=(a=n==null?void 0:n.carInfo)==null?void 0:a.find(i=>i.id===s);if(re(t),Q((t==null?void 0:t.isQualityDamage)||!1),N(!0),D.setFieldsValue({vin:t==null?void 0:t.vin,odometer:t==null?void 0:t.odometer,isQualityDamage:t==null?void 0:t.isQualityDamage,productionDate:t!=null&&t.productionDate?U(t.productionDate):null}),t!=null&&t.inspectionCarDTOS&&t.inspectionCarDTOS.length>0){const i={};t.inspectionCarDTOS.forEach(x=>{const P=ye.find(ce=>ce.value===x.anglePosition);P&&(i[P.name]={uid:x.id||Date.now().toString(),name:`${P.label}.jpg`,status:"done",url:x.fileUrl,anglePosition:x.anglePosition,fileUrl:x.fileUrl})}),T(i)}if(t!=null&&t.qualityDamageImgUrlList&&t.qualityDamageImgUrlList.length>0){const i=t.qualityDamageImgUrlList.map((x,P)=>({uid:`damage_${P}_${Date.now()}`,name:`质损照片_${P+1}.jpg`,status:"done",url:x,fileUrl:x}));V(i)}},Be=()=>{Object.values(I).forEach(s=>{s!=null&&s.url&&s.url.startsWith("blob:")&&URL.revokeObjectURL(s.url)}),K.forEach(s=>{s!=null&&s.url&&s.url.startsWith("blob:")&&URL.revokeObjectURL(s.url)}),N(!1),T({}),V([]),Q(!1),re(null),D.resetFields()},We=async()=>{var s;try{let t=await D.validateFields();if(console.log("...handleSavePhotos",t),Object.keys(I).length===0&&!((s=C==null?void 0:C.inspectionCarDTOS)!=null&&s.length)){r.warning("请至少上传一张验车照片");return}r.loading("正在保存照片...",0),console.log(I,"uploadedPhotos");let a=[];Object.values(I).forEach(x=>{a.push({anglePosition:x.anglePosition,fileUrl:x.fileUrl})});let i=[];Object.values(K).forEach(x=>{i.push(x.fileUrl)}),await hs({carId:A,inspectionCarDTOList:a,vin:t.vin,odometer:t.odometer,tmsWaybillNo:n==null?void 0:n.waybillNo,productionDate:U(t.productionDate).format("YYYY-MM-DD"),isQualityDamage:t.isQualityDamage?1:0,qualityDamageImgUrlList:i,mileage:t.mileage}),r.destroy(),r.success("成功保存验车信息"),N(!1),T({}),V([]),Q(!1),re(null),D.resetFields(),$()}catch(t){r.destroy(),r.error("保存照片失败"),console.error("保存照片失败:",t)}},qe=s=>{var a;const t=(a=n==null?void 0:n.carInfo)==null?void 0:a.find(i=>i.id===s);t!=null&&t.inspectionCarDTOS&&t.inspectionCarDTOS.length>0?(J(t.inspectionCarDTOS),fe("inspection"),X(!0)):r.info("该车辆暂无验车照片")},Ge=s=>{var a;const t=(a=n==null?void 0:n.carInfo)==null?void 0:a.find(i=>i.id===s);if(t!=null&&t.qualityDamageImgUrlList&&t.qualityDamageImgUrlList.length>0){const i=t.qualityDamageImgUrlList.map((x,P)=>({id:`damage_${P}`,fileUrl:x,anglePosition:"质损照片",createTime:t.createTime||new Date().toISOString()}));J(i),fe("damage"),X(!0)}else r.info("该车辆暂无质损照片")},Z=s=>{ae(s),G(!0)},Qe=s=>{var t;(t=I[s])!=null&&t.url&&URL.revokeObjectURL(I[s].url),T(a=>{const i={...a};return delete i[s],i}),D.setFieldValue(s,void 0),r.success("照片删除成功")},Ke=()=>{O([]),$()},Xe=()=>{y(!1)},Je=async()=>{try{const s=await k.validateFields();r.loading("正在提交交车单信息...",0),await new Promise(t=>setTimeout(t,1500)),r.destroy(),r.success(`成功提交 ${s.selectedVins.length} 辆车的交车单信息`),z(!1),O([]),k.resetFields(),$()}catch(s){r.destroy(),s!=null&&s.errorFields?r.error("请填写完整信息"):(r.error("交车单提交失败"),console.error("交车单提交失败:",s))}},Ze=()=>{z(!1),k.resetFields()},oe=async s=>{if(v.length===0){r.warning("请先选择车辆");return}if(s==="createInsurance"){y(!0);return}if(s==="uploadDeliveryDoc"){z(!0);return}try{const t={createInsurance:"创建保单",completePickup:"完成提车",vehicleArrival:"车辆到达",startTransport:"开始运输",cancelInsurance:"退保",uploadDeliveryDoc:"上传交车单"};if(s==="cancelInsurance"){L.confirm({title:"确认退保操作",content:e.jsxs("div",{children:[e.jsx("p",{children:"请确认是否退保已选的车辆？"}),e.jsxs("p",{style:{color:"#ff4d4f",fontSize:"14px",marginTop:"8px"},children:["⚠️ 已选中 ",e.jsx("strong",{children:v.length})," 辆车，退保后将无法恢复"]})]}),okText:"确认退保",cancelText:"取消",okType:"danger",onOk:async()=>{try{r.loading("正在处理退保操作...",0),await new Promise(a=>setTimeout(a,1500)),r.destroy(),r.success(`成功退保 ${v.length} 辆车`),O([]),$()}catch(a){r.destroy(),r.error("退保操作失败"),console.error("退保操作失败:",a)}}});return}L.confirm({title:`确认${t[s]}`,content:`是否对选中的 ${v.length} 辆车执行${t[s]}操作？`,onOk:async()=>{r.success(`${t[s]}操作成功`),O([])}})}catch{r.error("批量操作失败")}},es=async(s,t,a,i)=>{try{r.loading(`正在上传${a}...`,0);let x=await Me({currentVehicleId:A,file:s});console.log(x,"upload");const P=URL.createObjectURL(s);T(ce=>({...ce,[t]:{uid:Date.now().toString(),name:s.name,status:"done",url:P,originFileObj:s,anglePosition:i,fileUrl:x.result.path}})),D.setFieldValue(t,[{uid:Date.now().toString(),name:s.name,status:"done",url:P}]),r.destroy(),r.success(`${a} 上传成功`)}catch(x){r.destroy(),r.error("照片上传失败"),console.error("照片上传失败:",x)}},ss=async s=>{try{r.loading("正在上传质损照片...",0);const t=URL.createObjectURL(s);let a=await Me({file:s});const i={uid:Date.now().toString(),name:s.name,status:"done",url:t,originFileObj:s,fileUrl:a.result.path};V(x=>[...x,i]),r.destroy(),r.success("质损照片上传成功")}catch(t){r.destroy(),r.error("质损照片上传失败"),console.error("质损照片上传失败:",t)}},ts=s=>{const t=K.find(a=>a.uid===s);t!=null&&t.url&&URL.revokeObjectURL(t.url),V(a=>a.filter(i=>i.uid!==s)),r.success("质损照片删除成功")},ns=(s,t,a)=>({name:"file",multiple:!1,accept:"image/*",showUploadList:!1,beforeUpload:i=>i.type.startsWith("image/")?i.size/1024/1024<10?(es(i,s,t,a),!1):(r.error("图片大小不能超过10MB!"),!1):(r.error("只能上传图片文件!"),!1)});return m?e.jsxs("div",{className:g.loadingContainer,children:[e.jsx(cs,{size:"large"}),e.jsx("div",{style:{marginTop:16},children:"加载中..."})]}):n?e.jsxs("div",{className:g.container,children:[e.jsx("div",{className:g.header,children:e.jsxs(F,{children:[e.jsx(b,{icon:e.jsx(ps,{}),onClick:be,style:{background:"transparent"},children:"返回"}),e.jsxs("h2",{children:["运单详情 - ",n.waybillNo]})]})}),e.jsxs(S,{gutter:8,children:[e.jsx(u,{span:15,children:e.jsx(R,{title:"运单基本信息",className:g.card,children:e.jsxs(l,{column:1,children:[e.jsx(l.Item,{label:"运单号",span:1,children:n.waybillNo}),e.jsx(l.Item,{label:"状态",span:1,children:Ve(n.statusDesc)}),e.jsxs(l.Item,{label:"始发地",span:1,children:[n.senderProvince,n.senderCity,n.senderAddress]}),e.jsx(l.Item,{label:"目的地",span:1,children:n.warehouseName}),e.jsx(l.Item,{label:"下单时间",span:1,children:n.inWarehouseTimeStr?U(n.inWarehouseTimeStr).format("YYYY-MM-DD HH:mm:ss"):"-"}),e.jsx(l.Item,{label:"提车时间",span:1,children:n.pickupTimeStr?U(n.pickupTimeStr).format("YYYY-MM-DD HH:mm:ss"):"-"})]})})}),e.jsx(u,{span:9,children:e.jsx(R,{title:"订单宝信息",className:g.card,children:e.jsxs(l,{column:2,children:[e.jsx(l.Item,{label:"订单号",span:1,children:(ve=n==null?void 0:n.orderDTO)==null?void 0:ve.orderNo}),e.jsx(l.Item,{label:"业务经理",span:1,children:(Ie=n==null?void 0:n.orderDTO)==null?void 0:Ie.managerName}),e.jsx(l.Item,{label:"经销商",span:1,children:(we=n==null?void 0:n.orderDTO)==null?void 0:we.vendorName}),e.jsx(l.Item,{label:"供应商",span:1,children:(Ce=n==null?void 0:n.orderDTO)==null?void 0:Ce.sellerName})]})})}),e.jsx(u,{span:6,children:e.jsx(R,{title:"客户信息",className:g.card,children:e.jsxs(l,{column:1,children:[e.jsx(l.Item,{label:"客户名",children:(Pe=n==null?void 0:n.customerDTO)==null?void 0:Pe.name}),e.jsx(l.Item,{label:"联系人",children:(_e=n==null?void 0:n.customerDTO)==null?void 0:_e.contactName}),e.jsx(l.Item,{label:"联系方式",children:n.contactPhone})]})})}),e.jsx(u,{span:9,children:e.jsx(R,{title:"发车方联系方式",className:g.card,children:e.jsxs(l,{column:1,children:[e.jsx(l.Item,{label:"提车联系人",children:n.pickupContactName}),e.jsx(l.Item,{label:"联系方式",children:n.pickupContactPhone}),e.jsx(l.Item,{label:"提车地址",children:n.senderAddress})]})})}),e.jsx(u,{span:9,children:e.jsx(R,{title:"收车方联系方式",className:g.card,children:e.jsxs(l,{column:1,children:[e.jsx(l.Item,{label:"库管",span:1,children:(Se=n==null?void 0:n.wmsWarehouseDTO)==null?void 0:Se.keeperName}),e.jsx(l.Item,{label:"联系方式",children:(De=n==null?void 0:n.wmsWarehouseDTO)==null?void 0:De.keeperPhone}),e.jsx(l.Item,{label:"交车地址",children:(Te=n==null?void 0:n.wmsWarehouseDTO)==null?void 0:Te.warehouseAddress})]})})}),e.jsx(u,{span:24,children:e.jsx(R,{title:e.jsxs(F,{children:[e.jsx(js,{}),"车辆信息",e.jsxs(me,{color:"blue",children:[(Oe=n==null?void 0:n.orderDTO)==null?void 0:Oe.carCount," 辆"]})]}),className:g.card,extra:e.jsxs(F,{children:[e.jsx(b,{type:"primary",icon:e.jsx(Cs,{}),onClick:()=>oe("createInsurance"),disabled:v.length===0,children:"创建保单"}),e.jsx(b,{icon:e.jsx(ue,{}),danger:!0,onClick:()=>oe("cancelInsurance"),disabled:v.length===0,children:"退保"}),e.jsx(b,{icon:e.jsx(_s,{}),onClick:()=>oe("uploadDeliveryDoc"),disabled:v.length===0,children:"上传交车单"})]}),children:e.jsx(Fe,{rowSelection:He,columns:$e,dataSource:n==null?void 0:n.carInfo,rowKey:"id",pagination:!1,scroll:{x:1200},size:"middle"})})})]}),e.jsx(L,{title:"上传验车信息",open:W,onCancel:Be,onOk:We,okText:"提交",cancelText:"取消",width:1e3,height:600,style:{overflowY:"scroll"},okButtonProps:{disabled:Object.keys(I).length===0},className:g.uploadModal,children:e.jsxs(p,{form:D,layout:"inline",requiredMark:!1,children:[e.jsxs(S,{gutter:8,style:{width:"100%"},children:[e.jsx(u,{span:8,children:e.jsx(p.Item,{label:"车型",children:e.jsx(M,{value:C==null?void 0:C.vehicleName,disabled:!0,style:{background:"#f5f5f5"}})})}),e.jsx(u,{span:8,children:e.jsx(p.Item,{label:"内外饰",children:e.jsx(M,{value:C==null?void 0:C.outInColor,disabled:!0,style:{background:"#f5f5f5"}})})})]}),e.jsxs(S,{gutter:8,style:{width:"100%"},children:[e.jsx(u,{span:8,children:e.jsx(p.Item,{name:"vin",label:"车架号",rules:[{required:!0,message:"请输入车架号"}],children:e.jsx(M,{placeholder:"请输入车架号",maxLength:17,defaultValue:C==null?void 0:C.vin})})}),e.jsx(u,{span:8,children:e.jsx(p.Item,{name:"productionDate",label:"生产日期",rules:[{required:!0,message:"请选择生产日期"}],children:e.jsx(Ue,{placeholder:"请选择生产日期",style:{width:"100%"},disabledDate:s=>s&&s>U().endOf("day")})})}),e.jsx(u,{span:8,children:e.jsx(p.Item,{name:"odometer",label:"公里数(km)",rules:[{required:!0,message:"请输入公里数"}],children:e.jsx(M,{placeholder:"请输入公里数",maxLength:7,onChange:s=>{const t=s.target.value.replace(/[^\d]/g,"");D.setFieldsValue({odometer:t})}})})})]}),e.jsx(S,{gutter:8,style:{width:"100%"},children:e.jsx(u,{span:24,children:e.jsx(p.Item,{label:"是否质损",labelCol:{span:2},name:"isQualityDamage",children:e.jsxs(de.Group,{value:ge,onChange:s=>Q(s.target.value),defaultValue:!1,children:[e.jsx(de,{value:!1,children:"否"}),e.jsx(de,{value:!0,children:"是"})]})})})}),ge&&e.jsx(S,{gutter:8,style:{width:"100%"},children:e.jsx(u,{span:24,children:e.jsxs(p.Item,{label:"质损照片",labelCol:{span:2},children:[e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",alignItems:"flex-start"},children:[K.map(s=>e.jsxs("div",{style:{position:"relative",border:"1px solid #d9d9d9",borderRadius:"6px"},children:[e.jsx("img",{src:s.url,alt:"质损照片",style:{width:"104px",height:"104px",objectFit:"cover",borderRadius:"6px"},onClick:()=>Z(s.url)}),e.jsxs("div",{style:{position:"absolute",top:0,right:0,background:"rgba(0, 0, 0, 0.5)",borderRadius:"0 6px 0 6px",padding:"4px"},children:[e.jsx(b,{type:"text",icon:e.jsx(Y,{}),size:"small",onClick:()=>Z(s.url),style:{color:"white",padding:"0 4px",marginRight:"2px"}}),e.jsx(b,{type:"text",icon:e.jsx(ue,{}),size:"small",onClick:()=>ts(s.uid),style:{color:"white",padding:"0 4px"}})]})]},s.uid)),e.jsx(ee,{name:"file",accept:"image/*",showUploadList:!1,beforeUpload:s=>s.type.startsWith("image/")?s.size/1024/1024<10?(ss(s),!1):(r.error("图片大小不能超过10MB!"),!1):(r.error("只能上传图片文件!"),!1),children:e.jsxs("div",{style:{width:"104px",height:"104px",border:"1px dashed #d9d9d9",borderRadius:"6px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",background:"#fafafa"},children:[e.jsx(se,{style:{fontSize:"20px",color:"#999"}}),e.jsx("div",{style:{marginTop:"8px",fontSize:"12px",color:"#999"},children:"上传质损照片"})]})})]}),e.jsx("div",{style:{color:"#999",fontSize:"12px",marginTop:"8px"},children:"支持jpg、png格式，单个文件不超过10MB，可上传多张"})]})})}),e.jsx(S,{gutter:8,style:{width:"100%"},children:e.jsx(u,{span:24,children:e.jsx(p.Item,{label:"验车照片",labelCol:{span:2},children:e.jsx("div",{className:g.photoGrid,style:{width:"100%"},children:ye.map((s,t)=>e.jsx("div",{className:g.photoItem,children:e.jsx(p.Item,{name:s.name,rules:[{required:!1,message:`请上传${s.label}`}],children:I[s.name]?e.jsxs("div",{className:g.uploadedPhoto,children:[e.jsx("img",{src:I[s.name].url,alt:s.label,style:{width:"100%",height:"140px",objectFit:"cover",borderRadius:"6px"},onClick:()=>Z(I[s.name].url)}),e.jsxs("div",{className:g.photoActions,children:[e.jsx(b,{type:"text",icon:e.jsx(Y,{}),onClick:()=>Z(I[s.name].url),style:{color:"white"}}),e.jsx(b,{type:"text",icon:e.jsx(ue,{}),onClick:()=>Qe(s.name),style:{color:"white"}})]})]}):e.jsx(ee,{...ns(s.name,s.label,s.value),listType:"picture-card",maxCount:1,children:e.jsxs("div",{children:[e.jsx(se,{}),e.jsxs("div",{style:{marginTop:8},children:["点击上传",s.label]})]})})})},s.name))})})})})]})}),e.jsx(L,{open:ne,title:"照片预览",footer:null,onCancel:()=>G(!1),width:800,children:e.jsx(Le,{alt:"照片预览",style:{width:"100%"},src:le})}),e.jsx(Gs,{visible:h,onCancel:Xe,selectedVehicles:(ke=n==null?void 0:n.carInfo)==null?void 0:ke.filter(s=>v.includes(s.id)),onSuccess:Ke,waybillNo:n.waybillNo}),e.jsxs(L,{title:"上传交车单",open:E,onCancel:Ze,onOk:Je,okText:"提交",cancelText:"取消",width:600,className:g.deliveryDocModal,children:[e.jsx("div",{style:{marginBottom:16},children:e.jsxs("p",{children:["可选车辆数量：",e.jsx("strong",{children:v.length})," 辆"]})}),e.jsxs(p,{form:k,layout:"inline",requiredMark:!1,children:[e.jsx(p.Item,{name:"selectedVins",label:"关联车架号",rules:[{required:!0,message:"请选择要上传交车单的车架号"}],initialValue:(Re=n==null?void 0:n.carInfo)==null?void 0:Re.filter(s=>v.includes(s.id)).map(s=>s.vin),children:e.jsx(gs,{mode:"multiple",placeholder:"请选择车架号",style:{width:"450px"},options:(Ne=n==null?void 0:n.vehicles)==null?void 0:Ne.filter(s=>v.includes(s.id)).map(s=>({value:s.vin,label:`${s.vin} (${s.model})`,key:s.id}))})}),e.jsxs(S,{gutter:16,children:[e.jsx(u,{span:24,children:e.jsx(p.Item,{name:"contactPerson",label:"交车联系人",rules:[{required:!0,message:"请输入交车联系人"}],children:e.jsx(M,{placeholder:"请输入交车联系人"})})}),e.jsx(u,{span:24,children:e.jsx(p.Item,{name:"contactPhone",label:"联系电话",rules:[{required:!0,message:"请输入联系电话"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码"}],children:e.jsx(M,{placeholder:"请输入联系电话"})})})]}),e.jsx(u,{span:24,children:e.jsx(p.Item,{name:"idCard",label:"身份证号",rules:[{required:!0,message:"请输入身份证号"},{pattern:/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/,message:"请输入正确的身份证号码"}],children:e.jsx(M,{placeholder:"请输入身份证号码"})})}),e.jsxs(S,{gutter:16,children:[e.jsx(u,{span:24,children:e.jsx(p.Item,{name:"deliveryDocPhoto",label:"交车单",rules:[{required:!0,message:"请上传交车单照片"}],children:e.jsx(ee,{listType:"picture-card",maxCount:1,accept:"image/*",beforeUpload:()=>!1,onChange:({fileList:s})=>{k.setFieldValue("deliveryDocPhoto",s)},children:e.jsxs("div",{children:[e.jsx(se,{}),e.jsx("div",{style:{marginTop:8},children:"上传交车单"})]})})})}),e.jsx(u,{span:24,children:e.jsx(p.Item,{name:"personVehiclePhoto",label:"人车照",rules:[{required:!0,message:"请上传人车照"}],children:e.jsx(ee,{listType:"picture-card",maxCount:1,accept:"image/*",beforeUpload:()=>!1,onChange:({fileList:s})=>{k.setFieldValue("personVehiclePhoto",s)},children:e.jsxs("div",{children:[e.jsx(se,{}),e.jsx("div",{style:{marginTop:8},children:"上传人车照"})]})})})})]})]})]}),e.jsx(L,{title:e.jsxs("div",{children:[e.jsx("span",{children:Ee==="inspection"?"验车照片预览":"质损照片预览"}),e.jsxs(me,{color:"blue",style:{marginLeft:8},children:["共 ",ie.length," 张"]})]}),open:Ae,onCancel:()=>{X(!1),J([])},footer:[e.jsx(b,{onClick:()=>{X(!1),J([])},children:"关闭"},"close")],width:1200,className:g.photoViewModal,children:e.jsxs("div",{style:{maxHeight:"70vh",overflowY:"auto"},children:[e.jsx(S,{gutter:[16,16],children:ie.map((s,t)=>{const a=i=>({1:"左前45度照片",2:"左前门含A柱的照片",3:"左后门的照片",4:"后轮轮毂照片",5:"中控台照片",6:"仪表盘照片",7:"右后45度照片",8:"右前门含A柱的照片",9:"铭牌照片",10:"商品车入库信息采集表",11:"发动机舱"})[i]||i||"未知位置";return e.jsx(u,{xs:24,sm:12,md:8,lg:6,children:e.jsx(R,{hoverable:!0,cover:e.jsx("div",{style:{height:200,overflow:"hidden"},children:e.jsx(Le,{alt:a(s.anglePosition),src:"http://120.26.232.36"+s.fileUrl,style:{width:"100%",height:"100%",objectFit:"cover"},preview:{mask:e.jsxs("div",{style:{color:"white",textAlign:"center"},children:[e.jsx(Y,{style:{fontSize:20}}),e.jsx("div",{style:{marginTop:4},children:"预览"})]})}})}),size:"small",children:e.jsx(R.Meta,{title:e.jsx("div",{style:{fontSize:"12px",lineHeight:"16px"},children:a(s.anglePosition)})})})},s.id||t)})}),ie.length===0&&e.jsx("div",{style:{textAlign:"center",padding:"40px 0",color:"#999"},children:"暂无照片"})]})})]}):e.jsxs("div",{className:g.errorContainer,children:[e.jsx("div",{children:"运单详情不存在"}),e.jsx(b,{type:"primary",onClick:be,style:{marginTop:16},children:"返回列表"})]})};export{gt as default};

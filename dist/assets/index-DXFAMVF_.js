import{F as a,r,G as ee,s as n,j as t,R as L,a as g,I as T,S as te,B as l,M as m}from"./index-DMKvYnLr.js";import{a as se,d as ae,e as h}from"./merchant-Ch2NxWn9.js";import{d as re}from"./debounce-DjS9g-T5.js";import{S as C}from"./index-CIhK1E4t.js";import{R as ne}from"./SearchOutlined-DDdjSPdr.js";import{R as oe}from"./ReloadOutlined-Ch4B7x8x.js";import{R as ie}from"./PlusOutlined-BKiRrpec.js";import{F as le}from"./Table-34TOMWnZ.js";import{T as ce}from"./index-C-jp-M4o.js";import"./Pagination-D83B2W2M.js";const de="_container_15n9t_1",ue={container:de},Ce=()=>{const[p]=a.useForm(),[c]=a.useForm(),[u]=a.useForm(),[b,i]=r.useState(!1),[z,R]=r.useState([]),[V,N]=r.useState(0),[y,f]=r.useState(1),[x,D]=r.useState(10),[E,S]=r.useState(!1),[j,M]=r.useState(null),[k,v]=r.useState(!1),[F,O]=r.useState([]),[I,$]=r.useState([]),[P,w]=r.useState(!1);r.useEffect(()=>{o(),A(),G()},[y,x]);const G=async()=>{try{const e=await ee("BizCategorySubEnum");$(e)}catch(e){console.error("获取产品类型数据失败:",e),n.error("获取产品类型数据失败")}},A=async e=>{v(!0);try{const s=await se({pageSize:1e3,name:e});O(s.result)}catch(s){console.error("获取商家数据失败:",s),n.error("获取商家数据失败")}finally{v(!1)}},o=async e=>{i(!0);try{const s={page:y,pageSize:x,...e},d=await ae(s);console.log("授信额度列表",d),R(d.result),N(d.totalCount||0)}catch(s){console.error("获取授信额度列表失败:",s),n.error("获取数据失败")}finally{i(!1)}},_=[{title:"商家名称",dataIndex:"vendorName",key:"vendorName",width:150},{title:"产品类型",dataIndex:"bizCategorySubDesc",key:"bizCategorySubDesc",width:90},{title:"授信额度",dataIndex:"creditAmountStr",key:"creditAmountStr",width:90},{title:"已用额度",dataIndex:"usedCreditAmountStr",key:"usedCreditAmountStr",width:90},{title:"剩余额度",dataIndex:"remainingCreditAmountStr",key:"remainingCreditAmountStr",width:90},{title:"状态",dataIndex:"statusDesc",key:"statusDesc",width:90},{title:"操作",key:"action",fixed:"right",width:60,render:(e,s)=>t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[t.jsx(l,{size:"small",type:"link",onClick:()=>q(s),children:"调整额度"}),s.status===1&&t.jsx(l,{type:"link",size:"small",danger:!0,onClick:()=>B(s),children:"冻结"}),s.status===2&&t.jsx(l,{type:"link",size:"small",onClick:()=>J(s),children:"启用"})]})}],q=e=>{M(e),w(!0)},B=async e=>{m.confirm({title:"确认冻结额度",content:`确定要将商家"${e.vendorName}"额度冻结吗？`,okText:"确认",cancelText:"取消",onOk:async()=>{try{i(!0);const s={id:e==null?void 0:e.id,status:2};await h(s),o(),n.success("冻结成功")}catch{n.error("操作失败")}finally{i(!1)}}})},J=async e=>{m.confirm({title:"确认启用额度",content:`确定要将商家"${e.vendorName}"额度启用吗？`,okText:"确认",cancelText:"取消",onOk:async()=>{try{i(!0);const s={id:e==null?void 0:e.id,status:1};await h(s),o(),n.success("启用成功")}catch{n.error("操作失败")}finally{i(!1)}}})},K=async()=>{try{const e=await u.validateFields();console.log("v",e);const s={id:j==null?void 0:j.id,creditAmount:(e==null?void 0:e.creditAmount)*100};await h(s),o(),n.success("额度调整成功")}catch{n.error("额度调整异常")}finally{u.resetFields(),w(!1)}},Q=async()=>{try{const e=await p.validateFields();console.log("搜索条件:",e),f(1),o(e)}catch(e){console.error("表单验证失败:",e)}},U=()=>{S(!0),c.resetFields()},H=async()=>{try{let e=await c.validateFields(),s=F.find(d=>d.id===e.vendorId);e.vendorName=s.name,e.creditAmount=(e==null?void 0:e.creditAmount)*100,await h(e),n.success("保存成功"),S(!1),o(),c.resetFields()}catch(e){console.error("保存数据失败:",e)}},W=re(e=>{/[\u4e00-\u9fff\u3400-\u4dbf\uf900-\ufaff]/.test(e)&&A(e)},400),X=()=>{S(!1),c.resetFields()},Y=()=>{p.resetFields(),f(1),o()},Z=e=>{f(e.current),D(e.pageSize)};return t.jsxs("div",{className:ue.container,children:[t.jsxs(a,{form:p,onFinish:Q,layout:"inline",children:[t.jsxs(L,{gutter:24,style:{width:"100%"},children:[t.jsx(g,{span:8,children:t.jsx(a.Item,{name:"vendorName",label:"商家名称",children:t.jsx(T,{placeholder:"请输入商家名称",allowClear:!0})})}),t.jsx(g,{span:8,children:t.jsx(a.Item,{name:"bizCategorySub",label:"产品类型",children:t.jsx(C,{placeholder:"请选择产品类型",allowClear:!0,options:I.map(e=>({label:e.desc,value:e.code}))})})})]}),t.jsx(L,{gutter:24,style:{width:"100%"},children:t.jsx(g,{span:16,children:t.jsxs(te,{children:[t.jsx(l,{icon:t.jsx(ne,{}),type:"primary",htmlType:"submit",loading:b,children:"查询"}),t.jsx(l,{icon:t.jsx(oe,{}),onClick:Y,children:"重置"}),t.jsx(l,{icon:t.jsx(ie,{}),type:"primary",onClick:U,children:"新增授信额度"})]})})})]}),t.jsx(le,{columns:_,dataSource:z,loading:b,pagination:{current:y,pageSize:x,total:V,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条`},onChange:Z,scroll:{x:1100},rowKey:"id"}),t.jsx(m,{title:"添加额度",open:E,onOk:H,onCancel:X,width:800,children:t.jsxs(a,{form:c,layout:"vertical",requiredMark:!1,children:[t.jsx(a.Item,{name:"vendorId",label:"商家",style:{width:"100%"},children:t.jsx(C,{showSearch:!0,allowClear:!0,loading:k,filterOption:!1,onSearch:W,placeholder:"请选择商家",options:F.map(e=>({label:e.name,value:e.id}))})}),t.jsx(a.Item,{name:"bizCategorySub",label:"产品类型",style:{width:"100%"},children:t.jsx(C,{showSearch:!0,allowClear:!0,loading:k,filterOption:!1,placeholder:"请选择产品类型",options:I.map(e=>({label:e.desc,value:e.code}))})}),t.jsx(a.Item,{name:"creditAmount",label:"额度（元）",rules:[{required:!0,message:"请输入授信额度"},{pattern:/^\d{1,19}$/,message:"请输入数字"}],style:{width:"100%"},children:t.jsx(T,{placeholder:"请输入授信额度"})})]})}),t.jsx(m,{title:"调整额度",open:P,onOk:K,onCancel:()=>{w(!1),u.resetFields()},okText:"确定",cancelText:"取消",children:t.jsx(a,{form:u,layout:"vertical",children:t.jsx(a.Item,{label:"授信额度（元）",name:"creditAmount",rules:[{required:!0,message:"请输入授信额度"},{type:"number",min:0,max:1e11,message:"请输入数值"}],children:t.jsx(ce,{placeholder:"请输入授信额度（元）",style:{width:"100%"}})})})})]})};export{Ce as default};

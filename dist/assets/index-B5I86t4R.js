import{c as K,u as Q,F as l,r as n,j as e,S as y,B as c,C as x,I as P,M as I,s as r}from"./index-CyB-NFsd.js";import{u as X}from"./waybill-CIDwooDC.js";import{R as Z}from"./ArrowLeftOutlined-CT1Pur_J.js";import{D as i}from"./index-FC4NsB_w.js";import{F as ee}from"./Table-BaXE-4d7.js";import{U as te}from"./index-DGQitmkr.js";import{R as se}from"./UploadOutlined-BT3WnjeL.js";import{I as ae}from"./index-DpwK3Pk4.js";import"./styleChecker-BxO4dLT-.js";import"./index-CyGbgfxR.js";const re="_container_cqzbg_1",ne="_header_cqzbg_6",oe="_card_cqzbg_15",h={container:re,header:ne,card:oe},we=()=>{const{id:N}=K(),j=Q(),[k]=l.useForm(),[U,C]=n.useState(!1),[L,R]=n.useState(""),[_,A]=n.useState(""),[g,M]=n.useState([]),[V,w]=n.useState(!1),[m,T]=n.useState([]),[d,v]=n.useState(0),[z,b]=n.useState(!1),[p]=l.useForm(),[le,B]=n.useState({}),o={settlementId:N||"JS202403150001",orderNo:"YH202411060879036513",amount:15e4,payeeAccount:"6222020300012345678",payeeBranch:"中国工商银行上海分行营业部",payeeName:"上海汽车金融有限公司",status:"pending",createTime:"2024-03-15 10:00:00"},D=[{key:"1",amount:5e4,bankAccount:"6222020300098765432",accountName:"张三汽车销售有限公司",vouchers:["https://example.com/voucher1_1.jpg","https://example.com/voucher1_2.jpg","https://example.com/voucher1_3.jpg"]},{key:"2",amount:1e5,bankAccount:"6222020300011223344",accountName:"李四汽车贸易有限公司",vouchers:["https://example.com/voucher2_1.jpg","https://example.com/voucher2_2.jpg"]}],O=[{title:"打款金额",dataIndex:"amount",key:"amount",width:120,render:t=>`¥${t.toLocaleString()}`},{title:"银行账户",dataIndex:"bankAccount",key:"bankAccount",width:180},{title:"户名",dataIndex:"accountName",key:"accountName",width:200},{title:"打款凭证",dataIndex:"vouchers",key:"vouchers",width:200,render:(t,s)=>e.jsxs(y,{children:[t.length>0&&e.jsx(ae,{width:60,height:60,src:t[0],preview:!1,style:{objectFit:"cover",cursor:"pointer"},onClick:()=>F(t,0)}),t.length>1&&e.jsxs(c,{size:"small",onClick:()=>F(t,0),children:["查看全部(",t.length,"张)"]})]})}],F=(t,s=0)=>{T(t),v(s),w(!0)},q=({fileList:t})=>{M(t)},$=()=>({name:"file",multiple:!1,accept:"image/*",showUploadList:!1,beforeUpload:t=>t.type.startsWith("image/")?t.size/1024/1024<10?(E(t),!1):(r.error("图片大小不能超过10MB!"),!1):(r.error("只能上传图片文件!"),!1)}),E=async t=>{try{r.loading("正在上传...",0);let s=await X({file:t});console.log(s,"upload");const u=URL.createObjectURL(t);B(a=>({...a,fileList:{uid:Date.now().toString(),name:t.name,status:"done",url:u,originFileObj:t,fileUrl:s.result.path}})),r.destroy(),r.success("上传成功")}catch(s){r.destroy(),r.error("照片上传失败"),console.error("照片上传失败:",s)}},G=async t=>{!t.url&&!t.preview&&(t.preview=await S(t.originFileObj)),R(t.url||t.preview),C(!0),A(t.name||t.url.substring(t.url.lastIndexOf("/")+1))},S=t=>new Promise((s,u)=>{const a=new FileReader;a.readAsDataURL(t),a.onload=()=>s(a.result),a.onerror=f=>u(f)}),J=()=>{j("/financeManage/balance")},H=async()=>{try{const t=await k.validateFields(),s=[];for(const a of g)if(a.originFileObj){const f=a.url||await S(a.originFileObj);s.push(f)}else a.url&&s.push(a.url);const u={settlementId:o.settlementId,bankVoucherUrls:s,remark:t.auditComment,auditStatus:"approved"};console.log("提交审核数据:",u),r.success("审核通过成功"),j("/financeManage/balance")}catch(t){console.error("审核提交失败:",t),r.error("审核提交失败，请重试")}},W=()=>{b(!0)},Y=async()=>{try{const t=await p.validateFields();if(!t.rejectReason){r.error("请输入驳回原因");return}console.log("拒绝审核:",t),r.success("审核已拒绝"),b(!1),p.resetFields(),j("/financeManage/balance")}catch(t){console.error("表单验证失败:",t)}};return e.jsxs("div",{className:h.container,children:[e.jsx("div",{className:h.header,children:e.jsxs(y,{children:[e.jsx(c,{icon:e.jsx(Z,{}),onClick:J,style:{background:"transparent"},children:"返回"}),e.jsxs("h2",{children:["结算单审核详情 - ",o.settlementId]})]})}),e.jsx(x,{title:"基础信息",className:h.card,children:e.jsxs(i,{column:3,bordered:!0,children:[e.jsx(i.Item,{label:"结算单号",span:1,children:o.settlementId}),e.jsx(i.Item,{label:"订单号",span:1,children:o.orderNo}),e.jsxs(i.Item,{label:"结算金额",span:1,children:["¥",o.amount.toLocaleString()]}),e.jsx(i.Item,{label:"收款账户",span:1,children:o.payeeAccount}),e.jsx(i.Item,{label:"收款支行",span:1,children:o.payeeBranch}),e.jsx(i.Item,{label:"户名",span:1,children:o.payeeName})]})}),e.jsx(x,{title:"用户上传凭证",className:h.card,children:e.jsx(ee,{columns:O,dataSource:D,pagination:!1,scroll:{x:"max-content"}})}),e.jsxs(x,{title:"收款方网银凭证",className:h.card,children:[e.jsx(te,{listType:"picture-card",fileList:g,onPreview:G,onChange:q,maxCount:5,...$(),children:g.length>=5?null:e.jsxs("div",{children:[e.jsx(se,{}),e.jsx("div",{style:{marginTop:8},children:"上传凭证"})]})}),e.jsx("div",{style:{color:"#999",fontSize:"12px",marginTop:"8px"},children:"最多可上传5张图片，支持 JPG、PNG 格式"})]}),e.jsx(x,{title:"备注",className:h.card,children:e.jsxs(l,{form:k,layout:"vertical",children:[e.jsx(l.Item,{name:"auditComment",rules:[{required:!0,message:"请输入"}],children:e.jsx(P.TextArea,{rows:4,placeholder:"请输入审核意见...",maxLength:500,showCount:!0})}),e.jsx(l.Item,{children:e.jsxs(y,{children:[e.jsx(c,{type:"primary",onClick:H,size:"large",children:"审核通过"}),e.jsx(c,{danger:!0,onClick:W,size:"large",children:"拒绝审核"})]})})]})}),e.jsx(I,{open:U,title:_,footer:null,onCancel:()=>C(!1),width:800,children:e.jsx("img",{alt:"preview",style:{width:"100%"},src:L})}),e.jsx(I,{open:V,title:`打款凭证预览 (${d+1}/${m.length})`,footer:[e.jsx(c,{onClick:()=>v(Math.max(0,d-1)),disabled:d===0,children:"上一张"},"prev"),e.jsx(c,{onClick:()=>v(Math.min(m.length-1,d+1)),disabled:d===m.length-1,children:"下一张"},"next"),e.jsx(c,{onClick:()=>w(!1),children:"关闭"},"close")],onCancel:()=>w(!1),width:800,children:m.length>0&&e.jsx("img",{alt:"voucher preview",style:{width:"100%"},src:m[d]})}),e.jsx(I,{title:"拒绝审核",open:z,onOk:Y,onCancel:()=>{b(!1),p.resetFields()},okText:"确定驳回",cancelText:"取消",width:600,okButtonProps:{danger:!0},children:e.jsx(l,{form:p,layout:"inline",children:e.jsx(l.Item,{name:"rejectReason",label:"驳回原因",rules:[{required:!0,message:"请输入驳回原因"}],children:e.jsx(P.TextArea,{rows:4,placeholder:"请输入驳回原因...",maxLength:500,style:{width:"440px"},showCount:!0})})})})]})};export{we as default};

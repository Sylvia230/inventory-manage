import{r as a,F as n,g as os,G as J,j as s,C as rs,R as oe,a as I,I as h,S as is,B as m,M as j,d as cs,s as c,T as ds,e as us}from"./index-D8ReppmJ.js";import{s as u}from"./index.module-CBa0FrbO.js";import{d as K}from"./debounce-Y-c3ZRR0.js";import{a as ms,b as hs,A as ps,S as re,s as fs,c as gs,D as xs}from"./merchant-CtcbbkXQ.js";import{g as bs,a as js,s as ks}from"./finance-DTZW8aOF.js";import{F as W}from"./Table-uXQ28xlW.js";import{S as Q,E as ys}from"./index-D5ba-O3m.js";import{T as ie}from"./index-Z9mwPz8s.js";import{U as ws}from"./index-DwPqOCJo.js";import{R as Ss}from"./UploadOutlined-BaV8lvVV.js";import{T as ce}from"./index-BzBpE7l5.js";import{D as f}from"./index-BTfwLZ3y.js";import{I as Is}from"./index-BI5YGdgn.js";import{R as Cs}from"./EyeOutlined-qVL_seCx.js";import"./Pagination-DkTh5KJv.js";const ot=()=>{const[k,d]=a.useState(!1),[o]=n.useForm(),[L]=n.useForm(),[g]=n.useForm(),[F,T]=a.useState(!1),[x,C]=a.useState([]),[O,A]=a.useState(!1),[V,p]=a.useState([]),[D,v]=a.useState(!1),[P,b]=a.useState(!1),[y,B]=a.useState(1),[de,Bs]=a.useState(10),[Ns,ue]=a.useState(0),[me,z]=a.useState(!1),[i,w]=a.useState(null),[Ls,he]=a.useState(void 0),[R]=n.useForm(),[Fs,Ts]=a.useState(!1),[As,Vs]=a.useState(""),[Rs,Os]=a.useState(!1),[pe]=n.useForm(),[Ds,fe]=a.useState([]),[Ps,ge]=a.useState([]),[zs,qs]=a.useState([]),[Es,xe]=a.useState([]),[be,je]=a.useState([]),[ke,q]=a.useState(!1),[N]=n.useForm(),[$s,Ms]=a.useState([]),[Us,Gs]=a.useState(!1),[_,ye]=a.useState(null),[we,E]=a.useState(!1),[$,Se]=a.useState([]),[Ie,Ce]=a.useState(""),[ve,H]=a.useState(!1),[X,Y]=a.useState([]),[Be,Z]=a.useState(!1),[Ne,ee]=a.useState(!1),[Le,se]=a.useState(!1),[Fe,Te]=a.useState(null),[M,te]=os.useState([]),S=async(e=y,t=de)=>{d(!0);try{const r=await ms({page:e,pageSize:t});console.log("商家列表",r),je(r.result||[]),ue(r.totalCount||0)}catch(l){console.error("获取商家列表失败:",l),c.error("获取数据失败")}finally{d(!1)}};a.useEffect(()=>{S(1,10),Ve(),Re(),Ae()},[]);const Ae=async()=>{const e=await J("RunningTypeEnum");let t=[];e==null||e.forEach(l=>{t.push({label:l.desc,value:l.code})}),xe(t)},Ve=async()=>{const e=await J("BizCategoryEnum");let t=[];e==null||e.forEach(l=>{t.push({label:l.desc,value:l.code})}),fe(t)},Re=async()=>{const e=await J("BizCategorySubEnum");let t=[];e==null||e.forEach(l=>{t.push({label:l.desc,value:l.code})}),ge(t)},Oe=async e=>{se(!0);try{const t=await xs(e);console.log(t,"response"),Te(t)}catch(t){console.error("获取商家详情数据失败:",t),c.error("获取商家详情数据失败")}finally{se(!1)}},U=async e=>{H(!0);try{const t={pageSize:1e3,...e},l=await js(t);console.log(l,"response"),Se(l||[])}catch(t){console.error("获取银行数据失败:",t),c.error("获取银行数据失败")}finally{H(!1)}},ae=async e=>{Z(!0);try{const t={pageSize:1e3,...e},l=await bs(t);console.log(l,"response"),Y(l||[])}catch(t){console.error("获取银行数据失败:",t),c.error("获取银行数据失败")}finally{Z(!1)}},De=e=>{console.log("record",e),ye(e),q(!0),N.resetFields()},Pe=async e=>{try{d(!0);const t={vendorId:_.id,reason:e.reason,status:1,vendorName:_.name};await gs(t)?(c.success("添加黑名单成功"),q(!1),N.resetFields(),S(1,10)):c.error("添加黑名单失败")}catch(t){console.error("添加黑名单失败:",t),c.error("添加黑名单失败")}finally{d(!1)}},ze=()=>{q(!1),N.resetFields()},le=()=>{v(!1),w(null),pe.resetFields()},qe=e=>{w(e),E(!0),U(),g.setFieldsValue(e)},Ee=e=>{ee(!0),Oe(e.id)},$e=async e=>{try{if(d(!0),!x||x.length===0){c.warning("请选择或输入标签");return}const t=V.find(r=>r.value===x[0]);if(t&&!t.value.toString().includes("-")&&t.isNew){const r=await ps({tagName:t.label,tagType:1}),ne=await re([{tagName:t.label,tagId:r,tagType:1,bizId:(i==null?void 0:i.id)||""}]);console.log(r,"创建标签"),console.log(r,"创建标签")}else{const r=await re({tagName:t.label,tagId:t.id||"",tagType:1,bizId:(i==null?void 0:i.id)||""})}c.success("标签添加成功"),S(1,10),T(!1),C([]),p([])}catch(t){console.error("添加标签失败:",t),c.error("操作失败")}finally{d(!1)}},Me=async e=>{try{d(!0),S(1,10),console.log("搜索条件：",e)}catch{c.error("搜索失败")}finally{d(!1)}},Ue=()=>{o.resetFields()},Ge=e=>{switch(e){case"待审核":return"warning";case"正常":return"success";case"黑名单":return"error";default:return"default"}},Je=e=>{w(e),v(!0),Ke(e.bizLicenseFileId),L.setFieldsValue({...e})},Ke=async e=>{try{const t=localStorage.getItem("token"),l=await us.get(`gdv/file/loadFile/${e}`,{responseType:"blob",headers:{Authorization:`Bearer ${t}`}}),r=URL.createObjectURL(l.data);he(r)}catch(t){console.error("加载图片失败",t)}},Qe=async e=>{try{b(!0),c.success("审核成功"),v(!1)}catch{c.error("审核失败")}finally{b(!1)}},We=e=>{w(e),R.setFieldsValue({...e}),z(!0)},_e=async e=>{try{d(!0),await fs({id:i==null?void 0:i.id,feeRate:e.feeRate+""}),c.success("更新成功"),z(!1),S()}catch(t){console.error("更新日费率失败:",t),c.error("更新失败")}finally{d(!1)}},He=[{title:"商家名称",width:110,dataIndex:"name",key:"name"},{title:"统一社会信用代码",width:120,dataIndex:"socialCreditCode",key:"socialCreditCode"},{title:"服务费率（年化）",width:80,dataIndex:"feeRate",key:"feeRate",render:e=>e?`${e}%`:"-"},{title:"法人代表",width:80,dataIndex:"legalName",key:"legalName"},{title:"联系人",width:60,dataIndex:"contactName",key:"contactName"},{title:"黑名单",width:60,dataIndex:"inBlackList",key:"inBlackList",render:e=>e?"是":"否"},{title:"状态",width:40,dataIndex:"statusDesc",key:"statusDesc",render:e=>s.jsx(ce,{color:Ge(e),children:e})},{title:"操作",key:"action",fixed:"right",width:100,render:(e,t)=>s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[s.jsx(m,{type:"link",onClick:()=>We(t),children:"修改费率"}),s.jsx(m,{type:"link",onClick:()=>Je(t),children:"审核"}),!t.inBlackList&&s.jsx(m,{type:"link",onClick:()=>De(t),children:"添加黑名单"}),s.jsx(m,{type:"link",onClick:()=>qe(t),children:"添加银行卡"}),s.jsx(m,{type:"link",onClick:()=>Ee(t),children:"查看详情"})]})}],Xe=async()=>{E(!1),w(null),g.resetFields()},Ye=async()=>{try{let e=await g.validateFields();console.log("保存银行卡:",e);let t=e.bankId,l=$.find(G=>G.id===t);e.bankName=l.bankName;let r=e.bankBranchId,ne=X.find(G=>G.id===r);e.bankBranchName=ne.bankName;let ns=i==null?void 0:i.id;e.ownerName=i==null?void 0:i.name,e.accountName=i==null?void 0:i.name,e.ownerId=ns,e.purposeList=[1],e.ownerType=1,await ks(e),c.success("保存成功"),E(!1),w(null),g.resetFields(),S(),U()}catch(e){console.error("表单验证失败:",e)}},Ze=K(e=>{/[\u4e00-\u9fff\u3400-\u4dbf\uf900-\ufaff]/.test(e)&&ae({bankName:e,bankClscode:Ie})},800),es=e=>{let t="";if(e){let l=$.find(r=>r.id===e);t=l.bankCode,Ce(l.bankCode)}o.setFieldsValue({bankBranchId:void 0}),Y([]),t&&ae({bankClscode:t})},ss=K(e=>{/[\u4e00-\u9fff\u3400-\u4dbf\uf900-\ufaff]/.test(e)&&U({bankName:e})},400),ts=async e=>{A(!0);try{const t=await hs({page:1,pageSize:100,tagName:e||void 0});if(console.log(t,"标签数据"),t&&t.result){const l=t.result.map(r=>({value:r.id,label:r.tagName,color:r.color||"blue"}));e&&!l.some(r=>r.label.toLowerCase()===e.toLowerCase())&&l.unshift({value:e,label:e,color:"green",isNew:!0}),p(l)}else p(e?[{value:e,label:e,color:"green",isNew:!0}]:[])}catch(t){console.error("获取标签列表失败:",t),c.error("获取标签列表失败"),p(e?[{value:e,label:e,color:"green",isNew:!0}]:[])}finally{A(!1)}},as=a.useMemo(()=>K(ts,500),[]),ls={onRemove:e=>{const t=M.indexOf(e),l=M.slice();l.splice(t,1),te(l)},beforeUpload:e=>(te([e]),!1),fileList:M};return s.jsxs("div",{children:[s.jsx(rs,{className:"mb-16",children:s.jsx(n,{form:o,onFinish:Me,layout:"inline",children:s.jsxs(oe,{gutter:24,style:{width:"100%"},children:[s.jsx(I,{span:7,children:s.jsx(n.Item,{name:"name",label:"商家名称",children:s.jsx(h,{placeholder:"请输入商家名称",allowClear:!0})})}),s.jsx(I,{span:10,style:{textAlign:"left"},children:s.jsxs(is,{children:[s.jsx(m,{type:"primary",htmlType:"submit",loading:k,children:"查询"}),s.jsx(m,{onClick:Ue,children:"重置"})]})})]})})}),s.jsx("div",{className:u.container,children:s.jsx(W,{columns:He,dataSource:be,rowKey:"id",loading:k,scroll:{x:1e3},pagination:{showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条`}})}),s.jsx(j,{title:"添加标签",open:F,onOk:$e,onCancel:()=>{T(!1),o.resetFields()},okText:"确定",cancelText:"取消",children:s.jsx(n,{form:o,layout:"inline",children:s.jsx(n.Item,{label:"标签",required:!0,tooltip:"请至少选择一个标签",children:s.jsx(Q,{style:{width:"280px"},placeholder:"请选择或搜索标签",value:x.length>0?x[0]:void 0,onChange:e=>C(e?[e]:[]),onSearch:as,notFoundContent:O?s.jsx(cs,{size:"small"}):null,options:V,optionLabelProp:"label",optionFilterProp:"label",showSearch:!0,allowClear:!0,filterOption:!1})})})}),s.jsx(j,{title:"新增银行卡",open:we,onOk:Ye,onCancel:Xe,width:600,children:s.jsxs(n,{form:g,layout:"vertical",requiredMark:!1,children:[s.jsx(n.Item,{name:"name",label:"户名",style:{width:"100%"},children:s.jsx(h,{placeholder:"请输入账户"})}),s.jsx(n.Item,{name:"bankId",label:"开户行",rules:[{required:!0,message:"请选择开户行"}],children:s.jsx(Q,{showSearch:!0,allowClear:!0,loading:ve,filterOption:!1,onSearch:ss,onChange:es,placeholder:"请选择开户行",options:$.map(e=>({label:e.bankName,value:e.id}))})}),s.jsx(n.Item,{name:"bankBranchId",label:"支行",rules:[{required:!0,message:"请选择开户支行"}],children:s.jsx(Q,{showSearch:!0,allowClear:!0,loading:Be,filterOption:!1,onSearch:Ze,placeholder:"请选择开户支行",options:X.map(e=>({label:e.bankName,value:e.id}))})}),s.jsx(n.Item,{name:"bankAccount",label:"账户",rules:[{required:!0,message:"请输入账户"},{pattern:/^\d{7,19}$/,message:"请输入7-19位数字"}],style:{width:"100%"},children:s.jsx(h,{placeholder:"请输入账户"})})]})}),s.jsx(j,{title:"修改费率",open:me,onOk:()=>{R.validateFields().then(e=>{_e(e)})},onCancel:()=>{z(!1),R.resetFields()},okText:"确定",cancelText:"取消",children:s.jsx(n,{form:R,layout:"vertical",children:s.jsx(n.Item,{label:"年化费率 (%)",name:"feeRate",rules:[{required:!0,message:"请输入费率"},{type:"number",min:0,max:100,message:"请输入0~100之间的数值"}],children:s.jsx(ie,{placeholder:"请输入费率 (%)",style:{width:"100%"}})})})}),s.jsx(j,{title:"商家审核",open:D,onCancel:le,width:600,footer:[s.jsx(m,{onClick:le,children:"驳回"},"reject"),s.jsx(m,{type:"primary",loading:k,onClick:Qe,children:"通过"},"approve")],children:s.jsxs(n,{form:L,layout:"vertical",children:[s.jsx(I,{span:24,children:s.jsx(n.Item,{name:"name",label:"客户名",rules:[{required:!0,message:"请填写公司名称"}],children:s.jsx(h,{placeholder:"请填写公司名称"})})}),s.jsx(I,{span:24,children:s.jsx(n.Item,{name:"address",label:"经营场地",rules:[{required:!0,message:"请填写经营场地"}],children:s.jsx(h,{placeholder:"请填写经营场地"})})}),s.jsxs(oe,{gutter:16,children:[s.jsx(I,{span:12,children:s.jsx(n.Item,{name:"totalAssets",label:"注册资本（万）",rules:[{required:!0,message:"请输入注册资本"}],children:s.jsx(ie,{placeholder:"请输入注册资本",style:{width:"100%"},min:0,precision:2})})}),s.jsx(I,{span:12,children:s.jsx(n.Item,{name:"legalName",label:"法人代表",rules:[{required:!0,message:"请输入法人代表"}],children:s.jsx(h,{placeholder:"请输入法人代表",style:{width:"100%"}})})})]}),s.jsx(n.Item,{label:"主营业务",name:"mainBusiness",rules:[{required:!0,message:"请输入主营业务"}],children:s.jsx(h.TextArea,{rows:4,placeholder:"请输入主营业务",style:{width:"600px"}})}),s.jsx(n.Item,{label:"营业执照",name:"businessLicense",rules:[{required:!0}],children:s.jsx(ws,{...ls,listType:"picture",maxCount:1,accept:"image/*",children:s.jsx(m,{icon:s.jsx(Ss,{}),children:"上传营业执照"})})}),s.jsx(n.Item,{label:"备注",name:"remark",rules:[{required:!0,message:"请输入备注"}],children:s.jsx(h.TextArea,{rows:4,placeholder:"请输入备注",style:{width:"600px"}})})]})}),s.jsx(j,{title:"添加黑名单",open:ke,onOk:()=>N.submit(),onCancel:ze,confirmLoading:k,width:600,children:s.jsx(n,{form:N,layout:"inline",onFinish:Pe,children:s.jsx(n.Item,{name:"reason",label:"添加黑名单原因",rules:[{required:!0,message:"请输入添加黑名单原因"}],style:{width:"100%"},children:s.jsx(h.TextArea,{placeholder:"请输入添加黑名单的原因",rows:4,maxLength:500,showCount:!0})})})}),s.jsx(vs,{visible:Ne,onCancel:()=>ee(!1),data:Fe,loading:Le})]})},vs=({visible:k,onCancel:d,data:o,loading:L})=>{var P;const[g,F]=a.useState(!1),[T,x]=a.useState(""),[C,O]=a.useState("");if(!o)return null;const A=(b,y="照片预览")=>{x(b),O(y),F(!0)},V=()=>{var b;return s.jsx("div",{className:u.photoGrid,children:((b=o.imgInfo)==null?void 0:b.map((y,B)=>s.jsxs("div",{className:u.photoItem,children:[s.jsxs("div",{className:u.photoLabel,children:["图片 ",B+1]}),s.jsxs("div",{className:u.photoWrapper,onClick:()=>A(y,`图片 ${B+1}`),children:[s.jsx("img",{src:y,alt:`图片 ${B+1}`}),s.jsx("div",{className:u.photoOverlay,children:s.jsx(Cs,{})})]})]},B)))||s.jsx(ys,{description:"暂无图片材料"})})},p=[{key:"image",label:s.jsxs("span",{children:[s.jsx("h3",{children:"图片材料"}),(P=o.imgInfo)!=null&&P.length?s.jsx(ce,{color:"red",style:{marginLeft:8},children:o.imgInfo.length}):null]}),children:V()}],D=[{title:"户名",dataIndex:"accountName",width:160},{title:"账号",dataIndex:"bankAccount",width:140},{title:"银行",dataIndex:"bankName",width:150},{title:"支行",dataIndex:"bankBranchName",width:150}],v=[{title:"户名",dataIndex:"accountName",width:180},{title:"账号",dataIndex:"bankAccount",width:200},{title:"银行",dataIndex:"bankName",width:120},{title:"支行",dataIndex:"bankBranchName",width:120}];return s.jsxs(j,{title:"商家详情",open:k,onCancel:d,width:1e3,confirmLoading:L,footer:[s.jsx(m,{onClick:d,children:"关闭"},"close")],children:[s.jsxs("div",{className:u.detailContent,children:[s.jsxs(f,{title:s.jsx("div",{className:u.sectionTitle,children:"商家信息"}),bordered:!0,column:2,size:"small",className:u.descriptionSection,children:[s.jsx(f.Item,{label:"商家名称",children:o.name}),s.jsx(f.Item,{label:"统一社会信用代码",children:o.socialCreditCode}),s.jsx(f.Item,{label:"法定代表人",children:o.legalName||"-"}),s.jsx(f.Item,{label:"联系人",children:o.contactName||"-"}),s.jsx(f.Item,{label:"注册地址",children:o.address||"-"}),s.jsx(f.Item,{label:"主营范围",children:o.mainBusiness||"-"}),s.jsx(f.Item,{label:"状态",children:o.statusDesc||"-"})]}),s.jsxs("div",{className:u.vehicleTable,children:[s.jsx("h3",{children:"银行卡信息"}),s.jsx(W,{columns:D,dataSource:o==null?void 0:o.bankCardInfo,pagination:!1,scroll:{x:1e3}})]}),s.jsxs("div",{className:u.vehicleTable,children:[s.jsx("h3",{children:"额度信息"}),s.jsx(W,{columns:v,dataSource:o==null?void 0:o.creditInfo,pagination:!1,scroll:{x:1e3}})]}),s.jsx("div",{className:u.photoSection,children:s.jsx(ds,{items:p,className:u.photoTabs})})]}),s.jsx(j,{open:g,title:C,footer:null,onCancel:()=>F(!1),width:800,children:s.jsx(Is,{alt:C,style:{width:"100%"},src:T})})]})};export{ot as default};

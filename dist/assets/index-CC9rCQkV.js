import{r as o,F as r,u as W,j as t,C as Y,I as n,S as f,B as d,M as _,s}from"./index-DMKvYnLr.js";import{G as J,P as q}from"./taskCenter-bXp4u27N.js";import{S as h}from"./index-CIhK1E4t.js";import{R as G}from"./SearchOutlined-DDdjSPdr.js";import{R as X}from"./ReloadOutlined-Ch4B7x8x.js";import{F as K}from"./Table-34TOMWnZ.js";import{T as S}from"./index-C-jp-M4o.js";import"./Pagination-D83B2W2M.js";const{Option:j}=h,oe=()=>{const[y,I]=o.useState(!1),[v,P]=o.useState([]),[N,b]=o.useState(!1),[Q,U]=o.useState(null),[c]=r.useForm(),[m]=r.useForm(),C=W(),[l,F]=o.useState({current:1,pageSize:10,total:0}),[u,w]=o.useState({});[...Array.from({length:20},(e,a)=>({orderId:`YH2025052309${(a+10).toString().padStart(2,"0")}${Math.random().toString().slice(2,8)}`,productName:"订单宝-银行精选",createTime:Date.now()-Math.random()*864e5*30,guidePrice:Math.floor(Math.random()*3e5)+2e5,modelName:["奥迪A7L 2024款","奔驰E300L 2024款","宝马5系 2024款"][a%3],exterior:["黑色","白色","银色"][a%3],interior:["黑色","棕色","米色"][a%3],vehicleId:`V${(a+10).toString().padStart(3,"0")}`,vin:`VIN${Math.random().toString().slice(2,17).toUpperCase()}`,status:["processing","completed"][a%2],preCreditAmount:Math.floor(Math.random()*2e5)+1e5,actualPrice:Math.floor(Math.random()*4e5)+2e5}))];const M=[{label:"处理中",value:"processing"},{label:"已完成",value:"completed"}],z=[{label:"待确认",value:"unconfirmed"},{label:"已确认",value:"confirmed"},{label:"已取消",value:"cancelled"}],A=[{label:"未开始",value:"not_started"},{label:"进行中",value:"in_progress"},{label:"已完成",value:"finished"},{label:"已暂停",value:"paused"}],i=async(e,a=1,p=10)=>{try{I(!0),console.log("API调用参数:",{...e,page:a,pageSize:p});const x=await c.validateFields();let g=await J({...e,page:a,pageSize:p,type:2});console.log("Search values:",x,g),P(g||[]),F(H=>({...H,current:a,pageSize:p,total:g.length}))}catch(x){console.error("获取数据失败:",x),s.error("获取数据失败，请重试")}finally{I(!1)}},T=async()=>{try{const e=await c.validateFields();console.log("搜索参数:",e),w(e),await i(e,1,l.pageSize)}catch(e){console.error("搜索失败:",e)}},$=()=>{c.resetFields(),w({}),i({},1,l.pageSize)},B=(e,a)=>{i(u,e,a)},D=(e,a)=>{i(u,e,a)},R=e=>{C(`/orderManage/detail/${e}`)},k=async e=>{try{s.loading("正在处理预授信...",0),await q({taskId:e.taskId}),s.destroy(),s.success("预授信处理成功"),await i(u,l.current,l.pageSize)}catch(a){s.destroy(),console.error("预授信处理失败:",a),s.error("预授信处理失败，请重试")}},O=e=>{C(`/taskCenter/priceCheckDetail/${e.taskId}?type=2`)},V=async()=>{try{const e=await m.validateFields();console.log("核价参数:",e),s.success("核价处理成功"),b(!1),m.resetFields(),await i(u,l.current,l.pageSize)}catch(e){console.error("核价处理失败:",e),s.error("核价处理失败，请重试")}},E=()=>{b(!1),m.resetFields()},L=[{title:"订单号",dataIndex:"orderNo",key:"orderNo",width:180,render:(e,a)=>t.jsx("a",{onClick:()=>R(e||a.orderId),children:e||a.orderId})},{title:"产品类型",dataIndex:"bizCategorySubDesc",key:"bizCategorySubDesc",width:120},{title:"客户名称",dataIndex:"vendorName",key:"vendorName",width:180},{title:"合同金额",dataIndex:"contractAmountStr",key:"contractAmountStr",width:120},{title:"资方名称",dataIndex:"capitalName",key:"capitalName",width:150},{title:"状态",dataIndex:"status",key:"status",width:100,render:(e,a)=>t.jsx("div",{children:a.taskStatusDesc})},{title:"操作",key:"action",fixed:"right",width:100,render:(e,a)=>t.jsxs(f,{size:"middle",children:[a.taskStatus===1&&t.jsx(d,{type:"primary",size:"small",onClick:()=>k(a),disabled:a.status==="processing",children:"预授信"}),a.taskStatus===3&&t.jsx(d,{type:"primary",size:"small",onClick:()=>k(a),disabled:a.status==="processing",children:"预授信"}),a.taskStatus===4&&t.jsx(d,{type:"default",size:"small",onClick:()=>O(a),children:"重新核价"})]})}];return o.useEffect(()=>{i({},1,10)},[]),t.jsxs("div",{style:{padding:"24px"},children:[t.jsxs(Y,{children:[t.jsxs(r,{form:c,layout:"inline",style:{marginBottom:"16px"},children:[t.jsx(r.Item,{name:"orderNumber",label:"订单号",children:t.jsx(n,{placeholder:"请输入订单号",allowClear:!0})}),t.jsx(r.Item,{name:"dealer",label:"经销商",children:t.jsx(n,{placeholder:"请输入经销商",allowClear:!0})}),t.jsx(r.Item,{name:"progressStatus",label:"进度状态",children:t.jsx(h,{mode:"multiple",placeholder:"请选择进度状态",style:{width:200},allowClear:!0,children:M.map(e=>t.jsx(j,{value:e.value,children:e.label},e.value))})}),t.jsx(r.Item,{name:"orderStatus",label:"订单状态",children:t.jsx(h,{mode:"multiple",placeholder:"请选择订单状态",style:{width:200},allowClear:!0,children:z.map(e=>t.jsx(j,{value:e.value,children:e.label},e.value))})}),t.jsx(r.Item,{name:"taskStatus",label:"任务状态",children:t.jsx(h,{mode:"multiple",placeholder:"请选择任务状态",style:{width:200},allowClear:!0,children:A.map(e=>t.jsx(j,{value:e.value,children:e.label},e.value))})}),t.jsx(r.Item,{children:t.jsxs(f,{children:[t.jsx(d,{type:"primary",icon:t.jsx(G,{}),onClick:T,loading:y,children:"查询"}),t.jsx(d,{icon:t.jsx(X,{}),onClick:$,children:"重置"})]})})]}),t.jsx(K,{columns:L,dataSource:v,loading:y,rowKey:"vehicleId",scroll:{x:1800},pagination:{current:l.current,pageSize:l.pageSize,total:l.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,a)=>`第 ${a[0]}-${a[1]} 条，共 ${e} 条`,onChange:B,onShowSizeChange:D,pageSizeOptions:["10","20","50","100"]}})]}),t.jsx(_,{title:"核价处理",open:N,onOk:V,onCancel:E,width:600,children:t.jsxs(r,{form:m,layout:"vertical",children:[t.jsx(r.Item,{name:"orderId",label:"订单号",children:t.jsx(n,{disabled:!0})}),t.jsx(r.Item,{name:"modelName",label:"车型",children:t.jsx(n,{disabled:!0})}),t.jsx(r.Item,{name:"guidePrice",label:"厂商指导价",children:t.jsx(S,{style:{width:"100%"},formatter:e=>`¥ ${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>Number(e==null?void 0:e.replace(/\¥\s?|(,*)/g,"")),disabled:!0})}),t.jsx(r.Item,{name:"preCreditAmount",label:"预授信金额",children:t.jsx(S,{style:{width:"100%"},formatter:e=>`¥ ${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>Number(e==null?void 0:e.replace(/\¥\s?|(,*)/g,"")),disabled:!0})}),t.jsx(r.Item,{name:"actualPrice",label:"实际核价",rules:[{required:!0,message:"请输入实际核价"},{type:"number",min:0,message:"实际核价必须大于0"}],children:t.jsx(S,{style:{width:"100%"},formatter:e=>`¥ ${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),min:0,placeholder:"请输入实际核价"})}),t.jsx(r.Item,{name:"remark",label:"备注",children:t.jsx(n.TextArea,{rows:4,placeholder:"请输入备注信息"})})]})})]})};export{oe as default};

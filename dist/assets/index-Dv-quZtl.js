import{c as N,u as F,e as L,r as c,F as r,j as e,S as I,B as m,C as u,I as g,s as v}from"./index-DFmaZUvW.js";import{f as l}from"./index-D2i8iU4y.js";import{o as _}from"./index-BomGKUUL.js";import{R as M}from"./ArrowLeftOutlined-CbRoWV9y.js";import{D as n}from"./index-CkYte8OJ.js";import{F as x}from"./Table-DIemrw74.js";import{T as $}from"./index-B48vUfzP.js";import"./mobx.esm-J_RULll_.js";import"./Pagination-B-JRzDfY.js";import"./index-Bqyftg-u.js";const R="_container_18brn_1",w="_header_18brn_6",V="_card_18brn_15",d={container:R,header:w,card:V},U=_(()=>{const{settlementId:i}=N(),h=F(),[S]=L(),[t,p]=c.useState(null),[o,B]=c.useState(null),[y]=r.useForm(),j=S.get("mode")==="adjust";c.useEffect(()=>{if(i){const a=l.currentSettlement;if(a&&(a.settlementNo===i||a.id===i))p(a);else{const s=l.getSettlementById(i);s?(l.setCurrentSettlement(s),p(s),console.log("通过ID找到数据:",s)):console.warn("store中没有找到数据，使用模拟数据")}}},[i]),c.useEffect(()=>()=>{l.setCurrentSettlement(null)},[]);const D=[{key:"1",vin:"LSVAM4187C2184841",vehicleType:"奔驰C200",loanAmount:15e4,interest:8880,settlementAmount:158880},{key:"2",vin:"LSVAM4187C2184842",vehicleType:"宝马320i",loanAmount:18e4,interest:10656,settlementAmount:190656}],b=[{key:"1",dailyRate:1e-4,fee:500,loanDate:"2024-01-01",endDate:"2024-01-15",chargeDays:14,vehicleType:"奔驰C200",vin:"LSVAM4187C2184841"},{key:"2",dailyRate:1e-4,fee:600,loanDate:"2024-01-01",endDate:"2024-01-18",chargeDays:17,vehicleType:"宝马320i",vin:"LSVAM4187C2184842"}],k=[{title:"车型",dataIndex:"vehicleName",key:"vehicleName"},{title:"保证金金额",dataIndex:"depositAmountStr",key:"depositAmountStr",render:a=>`¥${a.toLocaleString()}`}],C=[{title:"车架号",dataIndex:"vin",key:"vin"},{title:"车型",dataIndex:"vehicleType",key:"vehicleType"},{title:"出款金额",dataIndex:"loanAmount",key:"loanAmount",render:a=>`¥${a.toLocaleString()}`},{title:"利息",dataIndex:"interest",key:"interest",render:a=>`¥${a.toLocaleString()}`},{title:"结算金额",dataIndex:"settlementAmount",key:"settlementAmount",render:a=>`¥${a.toLocaleString()}`}],T=[{title:"日费率",dataIndex:"dailyRate",key:"dailyRate",render:a=>`${(a*1e4).toFixed(1)}‰`},{title:"费用",dataIndex:"fee",key:"fee",render:a=>`¥${a.toLocaleString()}`},{title:"借款日期",dataIndex:"loanDate",key:"loanDate"},{title:"结束日期",dataIndex:"endDate",key:"endDate"},{title:"计费天数",dataIndex:"chargeDays",key:"chargeDays",render:a=>`${a}天`},{title:"车型",dataIndex:"vehicleType",key:"vehicleType"},{title:"车架号",dataIndex:"vin",key:"vin"}],f=()=>{l.setCurrentSettlement(null),h("/financeManage/balance")},A=async()=>{try{const a=await y.validateFields(),s={settlementId:t==null?void 0:t.settlementId,adjustAmount:a.adjustAmount,remark:a.remark,originalAmount:t==null?void 0:t.amount};console.log("调价数据:",s),v.success("调价成功"),l.setCurrentSettlement(null),h("/financeManage/settlement")}catch(a){console.error("调价失败:",a),v.error("调价失败，请重试")}};return t?e.jsxs("div",{className:d.container,children:[e.jsx("div",{className:d.header,children:e.jsxs(I,{children:[e.jsx(m,{icon:e.jsx(M,{}),onClick:f,style:{background:"transparent"},children:"返回"}),e.jsxs("h2",{children:[j?"结算单调价":"结算单详情"," - ",t.settlementNo]})]})}),e.jsx(u,{title:"基础信息",className:d.card,children:e.jsxs(n,{column:3,bordered:!0,children:[e.jsx(n.Item,{label:"结算单号",span:1,children:t.settlementNo}),e.jsx(n.Item,{label:"订单号",span:1,children:t.orderNo}),e.jsxs(n.Item,{label:"车辆总台数",span:1,children:[t.vehicleCount,"台"]}),t.fundTypeDesc==="保证金"&&t.customerName&&e.jsx(n.Item,{label:"客户名称",span:1,children:t.vendorName}),(t.fundTypeDesc==="本息"||t.fundTypeDesc==="服务费")&&t.deadline&&e.jsx(n.Item,{label:"截止时间",span:1,children:t.deadlineTimeStr}),e.jsx(n.Item,{label:"结算类型",span:1,children:t.fundTypeDesc}),e.jsx(n.Item,{label:"结算金额",span:1,children:t.amountStr}),e.jsx(n.Item,{label:"创建时间",span:1,children:t.createTime})]})}),e.jsxs(u,{title:"结算明细",className:d.card,children:[t.fundTypeDesc==="保证金"&&e.jsx(x,{columns:k,dataSource:t.depositCarDTOList,pagination:!1}),t.type==="interest"&&o&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{column:4,bordered:!0,children:[e.jsx(n.Item,{label:"开始时间",span:1,children:o.startTime}),e.jsx(n.Item,{label:"结束时间",span:1,children:o.endTime}),e.jsxs(n.Item,{label:"计费天数",span:1,children:[o.chargeDays,"天"]}),e.jsxs(n.Item,{label:"费率",span:1,children:[(o.rate*1e4).toFixed(1),"‰/日"]})]}),e.jsx(x,{columns:C,dataSource:D,pagination:!1,style:{marginTop:"20px"}})]}),t.type==="service"&&e.jsx(x,{columns:T,dataSource:b,pagination:!1})]}),j&&e.jsx(u,{title:"结算单调价",className:d.card,children:e.jsxs(r,{form:y,layout:"vertical",initialValues:{originalAmount:t.amount},children:[e.jsxs("div",{style:{display:"flex",gap:"24px",alignItems:"flex-start"},children:[e.jsx(r.Item,{label:"原结算金额",style:{flex:1},children:e.jsx(g,{value:`¥${t.amount.toLocaleString()}`,disabled:!0,style:{backgroundColor:"#f5f5f5"}})}),e.jsx(r.Item,{name:"adjustAmount",label:"调价金额",rules:[{required:!0,message:"请输入调价金额"},{type:"number",min:.01,message:"调价金额必须大于0"}],style:{flex:1},children:e.jsx($,{style:{width:"100%"},placeholder:"请输入调价金额",precision:2,min:.01,addonBefore:"¥"})})]}),e.jsx(r.Item,{name:"remark",label:"备注",rules:[{required:!0,message:"请输入调价原因"}],children:e.jsx(g.TextArea,{rows:4,placeholder:"请输入调价原因...",maxLength:500,showCount:!0})}),e.jsx(r.Item,{children:e.jsxs(I,{size:"large",children:[e.jsx(m,{type:"primary",size:"large",onClick:A,children:"确认调价"}),e.jsx(m,{size:"large",onClick:f,children:"取消"})]})})]})})]}):e.jsx("div",{children:"加载中..."})});export{U as default};

import{r,b as B,F as i,u as H,s as v,j as e,R as y,a as u,I,S as V,B as h}from"./index-Chixbmna.js";import{a as M}from"./finance-ELc9JRWV.js";import{f as p}from"./index-D2i8iU4y.js";import{S as b}from"./index-CTVR2mE-.js";import{R as _}from"./SearchOutlined-CJakv6Nz.js";import{R as A}from"./ReloadOutlined-DjkM37kN.js";import{F as E}from"./Table-DsHeEN0d.js";import{R as L}from"./DollarOutlined-DhfVkUZE.js";import{R as J}from"./EyeOutlined-CvHQjQS5.js";import{D as Q}from"./index-BxIddx09.js";import"./mobx.esm-J_RULll_.js";import"./Pagination-Du2F-cir.js";var q={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M296 250c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H296zm184 144H296c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zm-48 458H208V148h560v320c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V108c0-17.7-14.3-32-32-32H168c-17.7 0-32 14.3-32 32v784c0 17.7 14.3 32 32 32h264c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm440-88H728v-36.6c46.3-13.8 80-56.6 80-107.4 0-61.9-50.1-112-112-112s-112 50.1-112 112c0 50.7 33.7 93.6 80 107.4V764H520c-8.8 0-16 7.2-16 16v152c0 8.8 7.2 16 16 16h352c8.8 0 16-7.2 16-16V780c0-8.8-7.2-16-16-16zM646 620c0-27.6 22.4-50 50-50s50 22.4 50 50-22.4 50-50 50-50-22.4-50-50zm180 266H566v-60h260v60z"}}]},name:"audit",theme:"outlined"};function w(){return w=Object.assign?Object.assign.bind():function(n){for(var l=1;l<arguments.length;l++){var c=arguments[l];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(n[d]=c[d])}return n},w.apply(this,arguments)}const G=(n,l)=>r.createElement(B,w({},n,{ref:l,icon:q})),K=r.forwardRef(G),U="_container_1iukc_1",k={container:U},{RangePicker:ce}=Q,re=()=>{const[n]=i.useForm(),[l,c]=r.useState(!1),[d,z]=r.useState([]),[s,g]=r.useState({current:1,pageSize:10,total:0}),x=H(),N=[{label:"采购结算",value:"purchase"},{label:"销售结算",value:"sale"},{label:"服务费结算",value:"service"},{label:"其他",value:"other"}],C=[{label:"待审核",value:"pending"},{label:"审核中",value:"processing"},{label:"已通过",value:"approved"},{label:"已拒绝",value:"rejected"}],R=[{title:"订单号",dataIndex:"orderNo",key:"orderNo",width:180},{title:"结算单号",dataIndex:"settlementNo",key:"settlementNo",width:180},{title:"金额",dataIndex:"amountStr",key:"amountStr",width:120},{title:"资金类型",dataIndex:"fundTypeDesc",key:"fundTypeDesc",width:120},{title:"产品类型",dataIndex:"productTypeDesc",key:"productTypeDesc",width:180},{title:"客户",dataIndex:"vendorName",key:"vendorName",width:150},{title:"收款方",dataIndex:"receiveBankCardInfo",key:"receiveBankCardInfo",width:150,render:(t,a)=>e.jsx("div",{children:a.receiveBankCardInfo.accountName})},{title:"状态",dataIndex:"statusDesc",key:"statusDesc",width:100},{title:"操作",key:"action",fixed:"right",width:200,render:(t,a)=>e.jsxs("span",{children:[e.jsx(h,{type:"link",size:"small",icon:e.jsx(K,{}),onClick:()=>D(a),disabled:a.status==5||a.status===2,children:"审核"}),e.jsx(h,{type:"link",size:"small",icon:e.jsx(L,{}),onClick:()=>$(a),disabled:a.status==="approved"||a.status==="rejected",children:"调价"}),e.jsx(h,{type:"link",size:"small",icon:e.jsx(J,{}),onClick:()=>P(a),children:"查看"})]})}];r.useEffect(()=>{f()},[]);const f=async(t,a)=>{try{c(!0);const o=a||s,j={...t,page:o.current,pageSize:o.pageSize},m=await M(j);console.log(m,"res"),m&&(p.setSettlementList(m),z(m),g(T=>({...T,total:m.total||0})))}catch(o){console.error("获取数据失败:",o),v.error("获取数据失败，请稍后重试")}finally{c(!1)}},D=t=>{console.log("跳转到审核页面，结算单信息:",t);const a=p.getSettlementById(t.settlementNo);a?(p.setCurrentSettlement(a),console.log("从store获取到的审核数据:",a),x(`/financeManage/settlement/audit/${t.settlementNo}`)):(console.warn("未找到对应的结算单数据:",t.settlementNo),v.warning("未找到结算单数据，无法进行审核"))},$=t=>{console.log("跳转到调价页面，结算单信息:",t),x(`/financeManage/settlement/detail/${t.settlementNo}?mode=adjust`)},P=t=>{console.log("查看详情:",t);const a=p.getSettlementById(t.settlementNo);a?(p.setCurrentSettlement(a),console.log("从store获取到的完整数据:",a),x(`/financeManage/settlement/detail/${t.settlementNo}`)):(console.warn("未找到对应的结算单数据:",t.settlementNo),v.warning("未找到结算单详情数据"))},F=async()=>{try{const t=await n.validateFields();console.log("搜索条件:",t);const a={current:1,pageSize:s.pageSize,total:s.total};g(a),await f(t,a)}catch(t){console.error("表单验证失败:",t)}},O=()=>{n.resetFields();const t={current:1,pageSize:s.pageSize,total:s.total};g(t),f(void 0,t)},S=(t,a)=>{const o={current:t,pageSize:a,total:s.total};g(o);const j=n.getFieldsValue();f(j,o)};return e.jsxs("div",{className:k.container,children:[e.jsxs(i,{form:n,layout:"inline",className:k.searchForm,children:[e.jsxs(y,{gutter:24,style:{width:"100%"},children:[e.jsx(u,{span:6,children:e.jsx(i.Item,{name:"settlementNo",label:"结算单号",children:e.jsx(I,{placeholder:"请输入结算单号"})})}),e.jsx(u,{span:6,children:e.jsx(i.Item,{name:"settlementType",label:"结算类型",children:e.jsx(b,{placeholder:"请选择结算类型",options:N,allowClear:!0})})}),e.jsx(u,{span:6,children:e.jsx(i.Item,{name:"status",label:"状态",children:e.jsx(b,{placeholder:"请选择状态",options:C,allowClear:!0})})}),e.jsx(u,{span:6,children:e.jsx(i.Item,{name:"amount",label:"金额",children:e.jsx(I,{placeholder:"请输入金额"})})})]}),e.jsx(y,{gutter:24,style:{width:"100%"},children:e.jsx(u,{span:6,children:e.jsx(i.Item,{children:e.jsxs(V,{children:[e.jsx(h,{type:"primary",icon:e.jsx(_,{}),onClick:F,children:"搜索"}),e.jsx(h,{icon:e.jsx(A,{}),onClick:O,children:"重置"})]})})})})]}),e.jsx(E,{columns:R,dataSource:d,loading:l,pagination:{current:s.current,pageSize:s.pageSize,total:s.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:(t,a)=>`第 ${a[0]}-${a[1]} 条，共 ${t} 条`,onChange:S,onShowSizeChange:S,pageSizeOptions:["10","20","50","100"]},scroll:{x:1500}})]})};export{re as default};

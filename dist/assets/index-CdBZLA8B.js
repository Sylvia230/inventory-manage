import{F as l,f as we,j as e,M as y,a as n,B as c,I as u,r as a,G as B,C as Te,R as g,S as R,d as Fe,s as o}from"./index-DFmaZUvW.js";import{s as ve}from"./index.module-CBa0FrbO.js";import{d as Le}from"./debounce-fR_4XG9M.js";import{U as Me}from"./index-DMXe384T.js";import{R as Ae}from"./UploadOutlined-o4Hvti2M.js";import{G as Oe,A as Ve}from"./merchant-BP2dYbxx.js";import{F as Pe}from"./Table-DIemrw74.js";import{S as C}from"./index-Bqyftg-u.js";import{C as qe}from"./index-B2MT_ML1.js";import{T as S}from"./index-B48vUfzP.js";import{T as U}from"./index-D-yGRGxy.js";import"./Pagination-B-JRzDfY.js";const Ne=({open:x,onCancel:i,onOk:j,loading:m=!1,merchantData:L})=>{const[p]=l.useForm(),[b,h]=we.useState([]),M=async()=>{try{const d=await p.validateFields();j(d)}catch(d){console.error("Validate Failed:",d)}},k=()=>{p.resetFields(),h([]),i()},A={onRemove:d=>{const O=b.indexOf(d),I=b.slice();I.splice(O,1),h(I)},beforeUpload:d=>(h([d]),!1),fileList:b};return e.jsx(y,{title:"商家审核",open:x,onCancel:k,width:600,footer:[e.jsx(c,{onClick:k,children:"驳回"},"reject"),e.jsx(c,{type:"primary",loading:m,onClick:M,children:"通过"},"approve")],children:e.jsxs(l,{form:p,layout:"inline",initialValues:L,children:[e.jsx(n,{span:24,children:e.jsx(l.Item,{label:"公司全称",name:"name",children:"张三"})}),e.jsx(n,{children:e.jsx(l.Item,{label:"公司地址",name:"address",children:"浙江杭州"})}),e.jsx(n,{span:24,children:e.jsx(l.Item,{label:"营业执照",name:"businessLicense",children:e.jsx(Me,{...A,listType:"picture",maxCount:1,accept:"image/*",children:e.jsx(c,{icon:e.jsx(Ae,{}),children:"上传营业执照"})})})}),e.jsx(n,{span:24,children:e.jsx(l.Item,{label:"法人信息",name:"legalPerson",children:"李四"})}),e.jsx(n,{span:24,children:e.jsx(l.Item,{label:"经营范围",name:"businessScope",children:"浙江杭州台州"})}),e.jsx(l.Item,{label:"备注",name:"remark",rules:[{required:!0,message:"请输入备注"}],children:e.jsx(u.TextArea,{rows:4,placeholder:"请输入备注",style:{width:"500px"}})})]})})},es=()=>{const[x,i]=a.useState(!1),[j]=l.useForm(),[m]=l.useForm(),[L,p]=a.useState(!1),[b,h]=a.useState(!1),[M,k]=a.useState([]),[A,d]=a.useState(!1),[O,I]=a.useState([]),[$,V]=a.useState(!1),[Be,E]=a.useState(!1),[J,Re]=a.useState(1),[K,Ee]=a.useState(10),[ze,Q]=a.useState(0),[_,P]=a.useState(!1),[De,w]=a.useState(null),[T]=l.useForm(),[H,F]=a.useState(!1),[f]=l.useForm(),[W,X]=a.useState([]),[q,Y]=a.useState([]),[z,Z]=a.useState([]),[ee,se]=a.useState([]),[D,G]=a.useState([]),te=[{value:"beijing",label:"北京",children:[{value:"chaoyang",label:"朝阳区",children:[{value:"branch1",label:"朝阳支行"}]}]}],v=async(s=J,t=K)=>{i(!0);try{const N=await Oe({page:s,pageSize:t});console.log("商家列表",N),G(N.result||[]),Q(N.totalCount||0)}catch(r){console.error("获取商家列表失败:",r),o.error("获取数据失败")}finally{i(!1)}};a.useEffect(()=>{v(1,10),ae(),re(),le()},[]);const le=async()=>{const s=await B("RunningTypeEnum");let t=[];s==null||s.forEach(r=>{t.push({label:r.desc,value:r.code})}),se(t)},ae=async()=>{const s=await B("BizCategoryEnum");let t=[];s==null||s.forEach(r=>{t.push({label:r.desc,value:r.code})}),X(t)},re=async()=>{const s=await B("BizCategorySubEnum");let t=[];s==null||s.forEach(r=>{t.push({label:r.desc,value:r.code})}),Y(t)},ne=s=>{console.log("产品大类变化:",s);let t=[];s==2?t=q.filter(r=>r.value=="2"||r.value=="4"):s==1?t=q.filter(r=>r.value=="1"||r.value=="3"):t=q,Z(t),m.setFieldsValue({productSmall:void 0})},ie=s=>{y.confirm({title:"确认加入黑名单",content:`确定要将商家"${s.name}"加入黑名单吗？`,okText:"确认",cancelText:"取消",onOk:async()=>{try{i(!0),G(D.map(t=>t.id===s.id?{...t,status:"黑名单"}:t)),o.success("已加入黑名单")}catch{o.error("操作失败")}finally{i(!1)}}})},oe=s=>{w(s),p(!0)},ce=s=>{w(s),h(!0)},de=async s=>{try{i(!0),o.success("标签添加成功"),p(!1)}catch{o.error("操作失败")}finally{i(!1)}},ue=async s=>{try{i(!0),o.success("银行卡添加成功"),h(!1),m.resetFields()}catch{o.error("操作失败")}finally{i(!1)}},he=async s=>{try{i(!0),v(1,10),console.log("搜索条件：",s)}catch{o.error("搜索失败")}finally{i(!1)}},me=()=>{j.resetFields()},pe=()=>{F(!0),f.resetFields()},xe=async s=>{try{i(!0);const t={customerName:s.customerName,mainBusiness:s.mainBusiness,venueType:s.venueType,totalCapital:s.totalCapital,totalDebt:s.totalDebt,revenue:s.revenue,employeeCount:s.employeeCount,mainTradingPartner:s.mainTradingPartner,productType:s.productType};await Ve(t)?(o.success("新增商家成功"),F(!1),f.resetFields(),v()):o.error("新增失败")}catch(t){console.error("新增商家失败:",t),o.error("新增失败")}finally{i(!1)}},je=s=>{switch(s){case"待审核":return"warning";case"正常":return"success";case"黑名单":return"error";default:return"default"}},ye=s=>{switch(s){case"A":return"success";case"B":return"processing";case"C":return"warning";case"D":return"error";default:return"default"}},be=s=>{w(s),V(!0)},fe=async s=>{try{E(!0),o.success("审核成功"),V(!1)}catch{o.error("审核失败")}finally{E(!1)}},ge=s=>{w(s),T.setFieldsValue({dailyRate:s.creditLimit}),P(!0)},Ce=async s=>{try{i(!0),{code:200,msg:"更新成功"}.code===200&&(o.success("日费率更新成功"),P(!1),v())}catch(t){console.error("更新日费率失败:",t),o.error("更新失败")}finally{i(!1)}},Se=[{title:"商家名称",dataIndex:"name",key:"name"},{title:"统一社会信用代码",width:160,dataIndex:"socialCreditCode",key:"socialCreditCode"},{title:"法人姓名",dataIndex:"legalName",key:"legalName"},{title:"法人手机号",width:160,dataIndex:"legalMobile",key:"legalMobile"},{title:"签章人",dataIndex:"signerName",key:"signerName"},{title:"联系人",dataIndex:"contactName",key:"contactName"},{title:"联系人电话",dataIndex:"contactMobile",key:"contactMobile"},{title:"经营场所",dataIndex:"businessAddress",key:"businessAddress"},{title:"商家信用等级",dataIndex:"creditLevel",key:"creditLevel",render:s=>e.jsx(U,{color:ye(s),children:s})},{title:"服务费日费率",dataIndex:"creditLimit",key:"creditLimit"},{title:"状态",dataIndex:"status",key:"status",render:s=>e.jsx(U,{color:je(s),children:s})},{title:"操作",key:"action",fixed:"right",width:"200",render:(s,t)=>e.jsxs("div",{children:[e.jsx(c,{type:"link",onClick:()=>ge(t),children:"修改日费率"}),e.jsx(c,{type:"link",onClick:()=>be(t),children:"审核"}),e.jsx(c,{type:"link",onClick:()=>oe(t),children:"新增标签"}),t.status!=="黑名单"&&e.jsx(c,{type:"link",onClick:()=>ie(t),children:"添加黑名单"}),e.jsx(c,{type:"link",onClick:()=>ce(t),children:"添加银行卡"})]})}],ke=async s=>{d(!0);try{const t=[{value:"urgent",label:"加急",color:"red"},{value:"vip",label:"VIP客户",color:"gold"},{value:"new",label:"新客户",color:"green"},{value:"special",label:"特殊处理",color:"purple"}].filter(r=>r.label.toLowerCase().includes(s.toLowerCase()));I(t)}catch{o.error("获取标签列表失败")}finally{d(!1)}},Ie=a.useMemo(()=>Le(ke,500),[]);return e.jsxs("div",{children:[e.jsx(Te,{className:"mb-16",children:e.jsx(l,{form:j,onFinish:he,layout:"inline",children:e.jsxs(g,{gutter:24,style:{width:"100%"},children:[e.jsx(n,{span:7,children:e.jsx(l.Item,{name:"name",label:"商家名称",children:e.jsx(u,{placeholder:"请输入商家名称",allowClear:!0})})}),e.jsx(n,{span:10,style:{textAlign:"left"},children:e.jsxs(R,{children:[e.jsx(c,{type:"primary",htmlType:"submit",loading:x,children:"查询"}),e.jsx(c,{onClick:me,children:"重置"}),e.jsx(c,{type:"primary",onClick:pe,children:"新增商家"})]})})]})})}),e.jsx("div",{className:ve.container,children:e.jsx(Pe,{columns:Se,dataSource:D,rowKey:"id",loading:x,scroll:{x:1500},pagination:{showSizeChanger:!0,showQuickJumper:!0,showTotal:s=>`共 ${s} 条`}})}),e.jsx(y,{title:"添加标签",open:L,onOk:de,onCancel:()=>{p(!1),j.resetFields()},okText:"确定",cancelText:"取消",children:e.jsx(l,{form:j,layout:"inline",children:e.jsx(l.Item,{label:"标签",required:!0,tooltip:"请至少选择一个标签",children:e.jsx(C,{style:{width:"280px"},placeholder:"请选择或搜索标签",value:M,onChange:k,onSearch:Ie,notFoundContent:A?e.jsx(Fe,{size:"small"}):null,options:O,optionLabelProp:"label",optionFilterProp:"label",showSearch:!0,allowClear:!0})})})}),e.jsx(y,{title:"添加银行卡",open:b,onCancel:()=>{h(!1),m.resetFields()},footer:null,children:e.jsxs(l,{form:m,onFinish:ue,layout:"vertical",children:[e.jsx(l.Item,{name:"accountName",label:"户名",rules:[{required:!0,message:"请输入户名"}],children:e.jsx(u,{placeholder:"请输入户名"})}),e.jsx(l.Item,{name:"bankBranch",label:"开户支行",children:e.jsx(qe,{options:te,placeholder:"请选择开户支行",allowClear:!0})}),e.jsx(l.Item,{name:"accountNumber",label:"账户",rules:[{required:!0,message:"请输入账户"}],children:e.jsx(u,{placeholder:"请输入账户"})}),e.jsx(l.Item,{name:"phone",label:"手机号",rules:[{required:!0,message:"请输入手机号"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号"}],children:e.jsx(u,{placeholder:"请输入手机号"})}),e.jsx(l.Item,{name:"idType",label:"证件类型",children:e.jsx(C,{placeholder:"请选择证件类型",allowClear:!0,options:[{value:"身份证",label:"身份证"},{value:"护照",label:"护照"},{value:"其他",label:"其他"}]})}),e.jsx(l.Item,{name:"idNumber",label:"证件编号",children:e.jsx(u,{placeholder:"请输入证件编号"})}),e.jsx(l.Item,{children:e.jsxs(R,{style:{width:"100%",justifyContent:"flex-end"},children:[e.jsx(c,{onClick:()=>{h(!1),m.resetFields()},children:"取消"}),e.jsx(c,{type:"primary",htmlType:"submit",loading:x,children:"确定"})]})})]})}),e.jsx(y,{title:"修改日费率",open:_,onOk:()=>{T.validateFields().then(s=>{Ce()})},onCancel:()=>{P(!1),T.resetFields()},okText:"确定",cancelText:"取消",children:e.jsx(l,{form:T,layout:"vertical",children:e.jsx(l.Item,{label:"日费率 (%)",name:"dailyRate",rules:[{required:!0,message:"请输入日费率"},{type:"number",min:0,max:100,message:"请输入0~100之间的数值"}],children:e.jsx(S,{placeholder:"请输入日费率 (%)",style:{width:"100%"}})})})}),e.jsx(Ne,{open:$,onCancel:()=>V(!1),onOk:fe}),e.jsx(y,{title:"新增商家",open:H,onCancel:()=>{F(!1),f.resetFields()},footer:null,width:800,children:e.jsxs(l,{form:f,onFinish:xe,layout:"vertical",children:[e.jsxs(g,{gutter:16,children:[e.jsx(n,{span:12,children:e.jsx(l.Item,{name:"name",label:"客户名",rules:[{required:!0,message:"请填写公司名称"}],children:e.jsx(u,{placeholder:"请填写公司名称"})})}),e.jsx(n,{span:12,children:e.jsx(l.Item,{name:"mainBusiness",label:"主营业务",rules:[{required:!0,message:"请填写主营业务"}],children:e.jsx(u,{placeholder:"请填写主营业务"})})})]}),e.jsxs(g,{gutter:16,children:[e.jsx(n,{span:12,children:e.jsx(l.Item,{name:"venueType",label:"经营场地类型",rules:[{required:!0,message:"请选择经营场地类型"}],children:e.jsx(C,{placeholder:"请选择经营场地类型",options:ee.map(s=>({label:s.label,value:s.value}))})})}),e.jsx(n,{span:12,children:e.jsx(l.Item,{name:"bizCategory",label:"产品大类",rules:[{required:!0,message:"请选择产品大类"}],children:e.jsx(C,{placeholder:"请选择产品大类",options:W,onChange:ne})})}),e.jsx(n,{span:12,children:e.jsx(l.Item,{name:"bizCategorySub",label:"产品小类",rules:[{required:!0,message:"请选择产品小类"}],children:e.jsx(C,{placeholder:"请先选择产品大类",options:z,disabled:z.length===0})})})]}),e.jsxs(g,{gutter:16,children:[e.jsx(n,{span:8,children:e.jsx(l.Item,{name:"totalAssets",label:"资金总额（万）",rules:[{required:!0,message:"请输入资金总额"}],children:e.jsx(S,{placeholder:"请输入资金总额",style:{width:"100%"},min:0,precision:2})})}),e.jsx(n,{span:8,children:e.jsx(l.Item,{name:"totalLiabilities",label:"负债总额（万）",rules:[{required:!0,message:"请输入负债总额"}],children:e.jsx(S,{placeholder:"请输入负债总额",style:{width:"100%"},min:0,precision:2})})}),e.jsx(n,{span:8,children:e.jsx(l.Item,{name:"operatingIncome",label:"营业收入（万）",rules:[{required:!0,message:"请输入营业收入"}],children:e.jsx(S,{placeholder:"请输入营业收入",style:{width:"100%"},min:0,precision:2})})})]}),e.jsxs(g,{gutter:16,children:[e.jsx(n,{span:12,children:e.jsx(l.Item,{name:"employeeNum",label:"员工人数（人）",rules:[{required:!0,message:"请输入员工人数"}],children:e.jsx(S,{placeholder:"请输入员工人数",style:{width:"100%"},min:1,precision:0})})}),e.jsx(n,{span:12,children:e.jsx(l.Item,{name:"mainTradeCompany",label:"主要交易对手名称",rules:[{required:!0,message:"请填写公司名称"}],children:e.jsx(u,{placeholder:"请填写公司名称"})})})]}),e.jsx(l.Item,{style:{marginTop:24,textAlign:"right"},children:e.jsxs(R,{children:[e.jsx(c,{onClick:()=>{F(!1),f.resetFields()},children:"取消"}),e.jsx(c,{type:"primary",htmlType:"submit",loading:x,children:"确定"})]})})]})})]})};export{es as default};

import{r as o,b as O,F as n,u as U,j as t,R as X,a as M,I as z,S as I,B as j,M as F,s,D as Z}from"./index-CMZTZRIn.js";import{g as ee,c as te,v as D}from"./waybill-thXhVygr.js";import{d as b,D as T}from"./index-nlJJkfBw.js";import{R as ae}from"./SearchOutlined-D2-z65ZP.js";import{R as se}from"./ReloadOutlined-D9mwfiSd.js";import{F as le}from"./Table-Cg2wz00u.js";import{R as ie}from"./CarOutlined-DE7ZQpck.js";import"./index-CYJ1echB.js";import"./Pagination-BY7MwDV5.js";var re={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"check-circle",theme:"outlined"},ne={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"};function Y(){return Y=Object.assign?Object.assign.bind():function(i){for(var r=1;r<arguments.length;r++){var c=arguments[r];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(i[d]=c[d])}return i},Y.apply(this,arguments)}const oe=(i,r)=>o.createElement(O,Y({},i,{ref:r,icon:re})),N=o.forwardRef(oe);function C(){return C=Object.assign?Object.assign.bind():function(i){for(var r=1;r<arguments.length;r++){var c=arguments[r];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(i[d]=c[d])}return i},C.apply(this,arguments)}const ce=(i,r)=>o.createElement(O,C({},i,{ref:r,icon:ne})),de=o.forwardRef(ce),me="_container_1iukc_1",ue={container:me},ve=()=>{const[i]=n.useForm(),[r,c]=o.useState(!1),[d,V]=o.useState([]),[m,x]=o.useState({current:1,pageSize:10,total:0}),H=U(),[P,v]=o.useState(!1),[$,S]=o.useState(!1),[A,k]=o.useState(!1),[l,u]=o.useState(null),[f]=n.useForm(),[y]=n.useForm(),[w]=n.useForm(),p=async(e={})=>{try{const a=await ee(e);V(a||[]),x(g=>{var h;return{...g,total:((h=a.data)==null?void 0:h.total)||0}})}catch(a){s.error("获取运单列表失败"),console.error("获取运单列表失败:",a)}finally{c(!1)}};o.useEffect(()=>{let e=i.getFieldsValue();console.log("params",e),p({...e,page:1,pageSize:m.pageSize})},[]);const _=[{title:"运单号",dataIndex:"waybillNo",width:180},{title:"金融订单号",dataIndex:"loanOrderNo",width:180},{title:"状态",dataIndex:"statusDesc",width:120},{title:"起始地",dataIndex:"senderProvince",width:180,render:(e,a)=>`${a.senderProvince} ${a.senderCity} ${a.senderAddress}`},{title:"目的地",dataIndex:"warehouseName",width:180},{title:"联系人电话",dataIndex:"driverPhone",width:150},{title:"预计到达时间",dataIndex:"reachTime",width:180,render:(e,a)=>a.reachTime?b(a.reachTime).format("YYYY-MM-DD HH:mm:ss"):""},{title:"保险单号",dataIndex:"insuranceNo",width:150},{title:"操作",key:"action",fixed:"right",width:200,render:(e,a)=>{const g=()=>{const h=[];return h.push({key:"pickup",label:"完成提车",icon:t.jsx(N,{}),onClick:()=>L(a)}),h.push({key:"transport",label:"开始运输",icon:t.jsx(N,{}),onClick:()=>R(a)}),h.push({key:"arrival",label:"车辆到达",icon:t.jsx(ie,{}),onClick:()=>W(a)}),h};return t.jsxs(I,{children:[t.jsx(j,{type:"link",size:"small",onClick:()=>E(a),children:"查看详情"}),t.jsx(Z,{menu:{items:g()},trigger:["click"],placement:"bottomRight",children:t.jsx(j,{type:"link",size:"small",icon:t.jsx(de,{}),children:"更多操作"})})]})}}],B=e=>{console.log("搜索条件:",e);const a={...e,page:1,pageSize:m.pageSize};p(a),x(g=>({...g,current:1}))},q=()=>{i.resetFields(),p(),x(e=>({...e,current:1}))},E=e=>{console.log("查看运单详情:",e),H(`/waybill/detail/${e.id}`)},L=e=>{u(e),v(!0)},R=e=>{u(e),k(!0)},W=e=>{u(e),S(!0)},J=async()=>{try{const e=await f.validateFields();s.loading("正在处理提车完成操作...",0),await te({waybillNo:l==null?void 0:l.waybillNo,time:e.pickupCompletedTime.format("YYYY-MM-DD HH:mm:ss")}),s.destroy(),s.success("提车完成操作成功"),v(!1),u(null),f.resetFields();const a=i.getFieldsValue();p({...a,page:m.current,pageSize:m.pageSize})}catch(e){s.destroy(),e!=null&&e.errorFields?s.error("请填写完整信息"):(s.error("提车完成操作失败"),console.error("提车完成操作失败:",e))}},Q=async()=>{try{const e=await w.validateFields();s.loading("正在处理开始运输操作...",0),await D({waybillNo:l==null?void 0:l.waybillNo,time:e.startTime.format("YYYY-MM-DD HH:mm:ss")}),s.destroy(),s.success("开始运输操作成功"),k(!1),u(null),w.resetFields();const a=i.getFieldsValue();p({...a,page:m.current,pageSize:m.pageSize})}catch(e){s.destroy(),e!=null&&e.errorFields?s.error("请填写完整信息"):(s.error("开始运输操作失败"),console.error("开始运输操作失败:",e))}},G=async()=>{try{const e=await y.validateFields();s.loading("正在处理车辆到达操作...",0),await D({waybillNo:l==null?void 0:l.waybillNo,time:e.arrivalTime.format("YYYY-MM-DD HH:mm:ss")}),s.destroy(),s.success("车辆到达操作成功"),S(!1),u(null),y.resetFields();const a=i.getFieldsValue();p({...a,page:m.current,pageSize:m.pageSize})}catch(e){s.destroy(),e!=null&&e.errorFields?s.error("请填写完整信息"):(s.error("车辆到达操作失败"),console.error("车辆到达操作失败:",e))}},K=e=>{x(h=>({...h,current:e.current,pageSize:e.pageSize}));const g={...i.getFieldsValue(),page:e.current,pageSize:e.pageSize};p(g)};return t.jsxs("div",{className:ue.container,children:[t.jsx(n,{form:i,onFinish:B,layout:"inline",initialValues:{waybillNo:"",loanOrderNo:""},children:t.jsxs(X,{gutter:24,style:{width:"100%"},children:[t.jsx(M,{span:6,children:t.jsx(n.Item,{name:"waybillNo",label:"运单号",children:t.jsx(z,{placeholder:"请输入运单号",allowClear:!0})})}),t.jsx(M,{span:6,children:t.jsx(n.Item,{name:"loanOrderNo",label:"订单号",children:t.jsx(z,{placeholder:"订单号",allowClear:!0})})}),t.jsx(M,{span:6,children:t.jsxs(I,{children:[t.jsx(j,{icon:t.jsx(ae,{}),type:"primary",htmlType:"submit",loading:r,children:"查询"}),t.jsx(j,{icon:t.jsx(se,{}),onClick:q,children:"重置"})]})})]})}),t.jsx(le,{columns:_,dataSource:d,loading:r,pagination:{...m,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条`},onChange:K,scroll:{x:1200}}),t.jsxs(F,{title:"完成提车",open:P,onCancel:()=>{v(!1),u(null),f.resetFields()},onOk:J,okText:"确认完成",cancelText:"取消",width:500,children:[t.jsx("div",{style:{marginBottom:16},children:t.jsxs("p",{children:["运单号：",t.jsx("strong",{children:l==null?void 0:l.waybillNo})]})}),t.jsx(n,{form:f,layout:"inline",requiredMark:!1,initialValues:{pickupCompletedTime:b()},children:t.jsx(n.Item,{name:"pickupCompletedTime",label:"提车完成时间",rules:[{required:!0,message:"请选择提车完成时间"}],children:t.jsx(T,{showTime:!0,format:"YYYY-MM-DD HH:mm:ss",placeholder:"请选择提车完成时间",style:{width:"100%"}})})})]}),t.jsxs(F,{title:"开始运输",open:A,onCancel:()=>{k(!1),u(null),w.resetFields()},onOk:Q,okText:"确认开始",cancelText:"取消",width:500,children:[t.jsx("div",{style:{marginBottom:16},children:t.jsxs("p",{children:["运单号：",t.jsx("strong",{children:l==null?void 0:l.waybillNo})]})}),t.jsx(n,{form:w,layout:"inline",requiredMark:!1,initialValues:{startTime:b()},children:t.jsx(n.Item,{name:"startTime",label:"开始运输时间",rules:[{required:!0,message:"请选择开始运输时间"}],children:t.jsx(T,{showTime:!0,format:"YYYY-MM-DD HH:mm:ss",placeholder:"请选择开始运输时间",style:{width:"100%"}})})})]}),t.jsxs(F,{title:"车辆到达确认",open:$,onCancel:()=>{S(!1),u(null),y.resetFields()},onOk:G,okText:"确认到达",cancelText:"取消",width:500,children:[t.jsx("div",{style:{marginBottom:16},children:t.jsxs("p",{children:["运单号：",t.jsx("strong",{children:l==null?void 0:l.waybillNo})]})}),t.jsx(n,{form:y,layout:"inline",requiredMark:!1,initialValues:{arrivalTime:b()},children:t.jsx(n.Item,{name:"arrivalTime",label:"车辆到达时间",rules:[{required:!0,message:"请选择车辆到达时间"}],children:t.jsx(T,{showTime:!0,format:"YYYY-MM-DD HH:mm:ss",placeholder:"请选择车辆到达时间",style:{width:"100%"}})})})]})]})};export{ve as default};

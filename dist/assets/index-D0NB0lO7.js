import{r as s,F as n,s as u,j as t,I as y,S as j,B as h,M as w}from"./index-DMKvYnLr.js";import{g as A,a as J,s as K,d as Q}from"./dept-JHVra82G.js";import{R as G}from"./SearchOutlined-DDdjSPdr.js";import{F as H}from"./Table-34TOMWnZ.js";import{S as k}from"./index-CIhK1E4t.js";import{T as U}from"./index-DGhDchMJ.js";import"./Pagination-D83B2W2M.js";const W="_container_1mvle_1",X="_header_1mvle_6",b={container:W,header:X},oe=()=>{const[v,o]=s.useState(!1),[C,p]=s.useState(!1),[Y,I]=s.useState(""),[N,l]=s.useState(!1),[T,m]=s.useState(null),[r]=n.useForm(),[F,z]=s.useState([]),[f,g]=s.useState("add"),[D,L]=s.useState([]),[i,x]=s.useState({current:1,pageSize:10,total:0});s.useEffect(()=>{c(),M()},[i.current,i.pageSize]);const c=async(e,a)=>{try{o(!0);const d=a||i,B={...e,pageNo:d.current,pageSize:d.pageSize},S=await A(B);L(S.result||[]),x($=>({...$,total:S.totalCount||0}))}catch(d){console.error("获取部门列表失败:",d)}finally{o(!1)}},M=async(e={pageSize:1e3})=>{p(!0);try{const a=await J(e);console.log(a,"response"),z(a||[])}catch(a){console.error("获取用户数据失败:",a),u.error("获取用户数据失败")}finally{p(!1)}},_=()=>{g("add"),m(null),l(!0),r.resetFields()},E=e=>{x(e)},P=[{title:"部门名称",dataIndex:"deptName",key:"deptName",width:120},{title:"部门负责人",dataIndex:"leaderName",key:"leaderName",width:150},{title:"负责人电话",dataIndex:"leaderPhone",key:"leaderPhone",width:150},{title:"状态",dataIndex:"status",key:"status",width:100,render:e=>t.jsx(U,{color:e===1?"green":"red",children:e===1?"启用":"弃用"})},{title:"操作",key:"action",width:200,render:(e,a)=>t.jsxs(j,{size:"middle",children:[t.jsx(h,{type:"link",onClick:()=>R(a),children:"编辑"}),t.jsx(h,{type:"link",danger:!0,onClick:()=>V(a),children:"删除"})]})}],R=e=>{m(e),g("edit"),r.setFieldsValue(e),l(!0)},V=e=>{w.confirm({title:"确认删除",content:`确定要删除部门 ${e.deptName} 吗？`,okText:"确认",cancelText:"取消",onOk:async()=>{try{o(!0),await Q(e.id),u.success("删除成功"),c()}catch(a){console.error("删除失败:",a)}finally{o(!1)}}})},q=async()=>{try{let e=await r.validateFields();f==="add"||(e={...T,...e}),await K(e),console.log("修改数据:",e),u.success("保存成功"),l(!1),r.resetFields(),c()}catch(e){console.error("表单验证失败:",e),u.error("保存失败")}},O=e=>{I(e),c({deptName:e})};return t.jsxs("div",{className:b.container,children:[t.jsxs("div",{className:b.header,children:[t.jsx(y,{placeholder:"搜索名称",prefix:t.jsx(G,{}),onChange:e=>O(e.target.value),style:{width:200}}),t.jsx(j,{children:t.jsx(h,{type:"primary",onClick:_,children:"新增部门"})})]}),t.jsx(H,{columns:P,dataSource:D,loading:v,rowKey:"id",pagination:{...i,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条`},onChange:E}),t.jsx(w,{title:f==="add"?"新增部门":"编辑部门",open:N,onOk:q,onCancel:()=>l(!1),destroyOnClose:!0,children:t.jsxs(n,{form:r,layout:"vertical",children:[t.jsx(n.Item,{name:"deptName",label:"名称",rules:[{required:!0,message:"请输入名称"}],children:t.jsx(y,{placeholder:"请输入名称"})}),t.jsx(n.Item,{name:"leaderId",label:"部门负责人",rules:[{required:!0,message:"请选择部门负责人"}],children:t.jsx(k,{loading:C,placeholder:"请选择部门负责人",options:F.map(e=>({label:e.personName,value:e.id}))})}),t.jsx(n.Item,{name:"status",label:"状态",initialValue:1,rules:[{required:!0,message:"请选择状态"}],children:t.jsx(k,{options:[{label:"启用",value:1},{label:"弃用",value:0}]})})]})})]})};export{oe as default};

import{u as $,r as a,F as o,j as e,B as _,M as C,I as k,d as P,s as c,S as z,y as ue,C as he}from"./index-DFmaZUvW.js";import{d as V}from"./debounce-fR_4XG9M.js";import{S as h}from"./index-Bqyftg-u.js";import{o as pe}from"./index-BiEhHuj5.js";import{R as me}from"./SearchOutlined-DL9voMCh.js";import{R as xe}from"./ReloadOutlined-CzbpDPLD.js";import"./mobx.esm-J_RULll_.js";const je="_orderTableWrapper_39gtv_11",be="_table_39gtv_15",fe="_tableBorder_39gtv_28",ge="_tableFixed_39gtv_31",ve="_orderHeader_39gtv_34",Se="_actionButtons_39gtv_45",ye="_orderInfo_39gtv_48",we="_orderNumber_39gtv_51",Ce="_clickable_39gtv_61",_e="_taskStatus_39gtv_64",Oe="_orderStatusInfo_39gtv_73",Ie="_supplierInfo_39gtv_77",Ne="_vehicleTableContainer_39gtv_81",ke="_tableInner_39gtv_86",n={orderTableWrapper:je,table:be,tableBorder:fe,tableFixed:ge,orderHeader:ve,actionButtons:Se,orderInfo:ye,orderNumber:we,clickable:Ce,taskStatus:_e,orderStatusInfo:Oe,supplierInfo:Ie,vehicleTableContainer:Ne,tableInner:ke},{TextArea:Te}=k,Be=[{text:"添加备注",type:"primary",action:"addRemark"},{text:"添加标签",type:"primary",action:"addTag"},{text:"业务归属",type:"primary",action:"setBusinessOwner"},{text:"推送到资方",type:"primary",action:"pushToProvider"},{text:"核价",type:"primary",action:"priceCheck"},{text:"关闭申请单",type:"primary",danger:!0}],Fe=[{title:"车型",dataIndex:"modelName",width:140},{title:"数量",dataIndex:"uniqueNum",width:60},{title:"车架号",dataIndex:"carUniqueList"}],Le=({orderData:i})=>{console.log("orderData",i);const p=$(),[y,x]=a.useState(!1),[O,j]=a.useState(!1),[I,b]=a.useState(!1),[w,f]=a.useState(!1),[l,u]=a.useState(""),[g,T]=a.useState(""),[B,F]=a.useState([]),[q,E]=a.useState([]),[H,L]=a.useState(!1),[U,W]=a.useState([]),[Me,R]=a.useState(),[G,M]=a.useState(!1),[v]=o.useForm(),[S]=o.useForm(),Q={labelCol:{span:8},wrapperCol:{span:18}},J=s=>{console.log("点击订单号:",s),p(`/orderManage/detail/${s}`)},K=s=>{u(s),T(""),x(!0)},X=s=>{u(s),F([]),v.resetFields(),j(!0)},Y=async()=>{if(!g.trim()){c.warning("请输入备注内容");return}try{c.success("备注添加成功"),x(!1)}catch{c.error("备注添加失败")}},Z=async()=>{try{const s=await v.validateFields();if(B.length===0){c.warning("请选择至少一个标签");return}c.success("标签添加成功"),j(!1),v.resetFields()}catch{return}},D=async s=>{L(!0);try{const t=[{value:"urgent",label:"加急",color:"red"},{value:"vip",label:"VIP客户",color:"gold"},{value:"new",label:"新客户",color:"green"},{value:"special",label:"特殊处理",color:"purple"}].filter(r=>r.label.toLowerCase().includes(s.toLowerCase()));E(t)}catch{c.error("获取标签列表失败")}finally{L(!1)}},ee=a.useMemo(()=>V(D,500),[]),se=s=>{u(s),b(!0)},te=async()=>{try{c.success("推送成功"),b(!1)}catch{c.error("推送失败")}},re=s=>{u(s),R(void 0),S.resetFields(),f(!0)},ae=s=>{console.log("跳转到核价页面，订单信息:",s),p(`/taskCenter/priceCheck?orderNumber=${s.orderNo}`)},le=async()=>{try{if(!(await S.validateFields()).businessOwner){c.warning("请选择业务归属人");return}c.success("业务归属设置成功"),f(!1),S.resetFields()}catch{return}},ne=async s=>{M(!0);try{const t=[{id:"1",name:"张三"},{id:"2",name:"李四"},{id:"3",name:"王五"},{id:"4",name:"赵六"}].filter(r=>r.name.toLowerCase().includes(s.toLowerCase()));W(t)}catch{c.error("获取业务归属人列表失败")}finally{M(!1)}},oe=a.useMemo(()=>V(ne,500),[]),m=a.useMemo(()=>({addRemark:t=>{K(t)},addTag:t=>{X(t)},pushToProvider:t=>{se(t)},setBusinessOwner:t=>{re(t)},priceCheck:(t,r)=>{ae(r)}}),[]),ce=(s,t,r)=>{var d,A;t==="priceCheck"?(d=m[t])==null||d.call(m,s,r):(A=m[t])==null||A.call(m,s)},ie=(s,t)=>e.jsx("div",{className:n.orderHeader,children:e.jsx(z,{wrap:!0,className:n.actionButtons,children:Be.map((r,d)=>e.jsx(_,{type:r.type,size:"small",danger:r.danger,onClick:()=>ce(t.orderNo,r.action,t),children:r.text},d))})}),de=s=>{var t;return e.jsx("div",{className:n.vehicleTableContainer,children:e.jsxs("table",{className:n.tableInner,children:[e.jsx("thead",{children:e.jsx("tr",{children:Fe.map((r,d)=>e.jsx("th",{children:r.title},d))})}),e.jsx("tbody",{children:(t=s==null?void 0:s.carList)==null?void 0:t.map((r,d)=>e.jsxs("tr",{children:[e.jsx("td",{children:r.vehicleName}),e.jsx("td",{children:r.emission}),e.jsx("td",{children:(r==null?void 0:r.vin)||"-"})]},d))})]})})};return e.jsxs("div",{children:[i==null?void 0:i.map((s,t)=>e.jsx("div",{className:n.orderTableWrapper,children:e.jsxs("table",{className:`${n.table} ${n.tableBorder} ${n.tableFixed}`,children:[e.jsxs("thead",{children:[e.jsx("tr",{children:e.jsx("th",{colSpan:7,className:n.orderItemActions,children:ie(s.applicationStatusDesc,s)})}),e.jsxs("tr",{children:[e.jsxs("th",{colSpan:3,className:n.orderInfo,children:["订单号:",e.jsx("span",{className:`${n.orderNumber} ${n.clickable}`,onClick:()=>J(s.orderNo),children:s.orderNo}),"  时间：",new Date(s.createTime).toLocaleString()]}),e.jsx("th",{colSpan:1,className:n.taskStatus,children:e.jsx("div",{children:"进行中的任务:"})}),e.jsxs("th",{colSpan:3,className:n.orderStatusInfo,children:[e.jsx("span",{children:"订单状态: "}),e.jsx("span",{children:s.orderStatusDesc})]})]}),e.jsx("tr",{children:e.jsx("th",{colSpan:7,className:"text-left",children:e.jsx("span",{className:n.labelButtonBox,children:e.jsx(_,{size:"small",icon:e.jsx("i",{className:"el-icon-close"}),children:"6"})})})})]}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsxs("td",{colSpan:2,children:["经销商名称：",s.vendorName]}),e.jsx("td",{colSpan:2,children:e.jsx("div",{className:n.supplierInfo,children:e.jsxs("div",{children:["供应商名称：",s.sellerName]})})}),e.jsxs("td",{colSpan:2,children:["合同金额：",s.contractAmount,"元"]}),e.jsx("td",{rowSpan:2,children:de(s)})]}),e.jsxs("tr",{children:[e.jsxs("td",{children:["业务经理：",s.userName]}),e.jsxs("td",{children:["申请人：",s.contactsName]}),e.jsxs("td",{children:["手机：",s.contactsPhone]}),e.jsxs("td",{children:["联系人：",s.providerUserName]}),e.jsxs("td",{children:["手机：",s.providerUserPhone]}),e.jsxs("td",{children:["车辆数：",s.carCount]})]})]})]})},s.applicationId)),e.jsx(C,{title:"添加备注",open:y,onOk:Y,onCancel:()=>x(!1),okText:"确定",cancelText:"取消",children:e.jsx(Te,{value:g,onChange:s=>T(s.target.value),maxLength:200,showCount:!0,placeholder:"请输入备注内容（最多200字）",autoSize:{minRows:4,maxRows:6},className:"mb-20"})}),e.jsx(C,{title:"添加标签",open:O,onOk:Z,onCancel:()=>{j(!1),v.resetFields()},okText:"确定",cancelText:"取消",children:e.jsx(o,{form:v,layout:"inline",children:e.jsx(o.Item,{label:"标签",required:!0,tooltip:"请至少选择一个标签",...Q,children:e.jsx(h,{style:{width:"100%"},placeholder:"请选择或搜索标签",value:B,onChange:F,onSearch:ee,notFoundContent:H?e.jsx(P,{size:"small"}):null,options:q,optionLabelProp:"label",optionFilterProp:"label",showSearch:!0,allowClear:!0})})})}),e.jsx(C,{title:"添加归属",open:w,onOk:le,onCancel:()=>{f(!1),S.resetFields()},okText:"确定",cancelText:"取消",children:e.jsx(o,{form:S,layout:"inline",children:e.jsx(o.Item,{name:"businessOwner",label:"归属",rules:[{required:!0,message:"请选择业务归属人"}],children:e.jsx(h,{showSearch:!0,placeholder:"请选择或搜索业务归属人",defaultActiveFirstOption:!1,showArrow:!1,filterOption:!1,onSearch:oe,notFoundContent:G?e.jsx(P,{size:"small"}):null,onChange:R,style:{width:"100%"},children:U.map(s=>e.jsx(h.Option,{value:s.id,children:e.jsx("div",{children:e.jsx("div",{children:s.name})})},s.id))})})})}),e.jsx(C,{title:"确认推送",open:I,onOk:te,onCancel:()=>b(!1),okText:"确认",cancelText:"取消",children:e.jsx("p",{children:"请确认是否要推送订单？"})})]})};function Re(i){return ue.post("/order/pageQuery",i).then(p=>p.result)}const{Option:N}=h,Ue=()=>{const[i]=o.useForm(),[p,y]=a.useState(!1),[x,O]=a.useState([]);$();const j=[{label:"待处理",value:"pending"},{label:"处理中",value:"processing"},{label:"已完成",value:"completed"}],I=[{label:"待确认",value:"unconfirmed"},{label:"已确认",value:"confirmed"},{label:"已取消",value:"cancelled"}],b=[{label:"未开始",value:"not_started"},{label:"进行中",value:"in_progress"},{label:"已完成",value:"finished"},{label:"已暂停",value:"paused"}],w=async()=>{try{y(!0);const l=await i.validateFields();let u=await Re({pageNo:1,pageSize:20});console.log("Search values:",l,u);const g=u.result||[];pe.setOrderList(g),O(g)}catch(l){console.error("Search error:",l)}finally{y(!1)}};a.useEffect(()=>{w()},[]);const f=()=>{i.resetFields()};return e.jsx("div",{className:"order-list",children:e.jsxs(he,{children:[e.jsxs(o,{form:i,layout:"inline",children:[e.jsx(o.Item,{name:"orderNumber",label:"订单号",style:{marginBottom:"12px"},children:e.jsx(k,{placeholder:"请输入订单号",allowClear:!0})}),e.jsx(o.Item,{name:"dealer",label:"经销商",style:{marginBottom:"12px"},children:e.jsx(k,{placeholder:"请输入经销商",allowClear:!0})}),e.jsx(o.Item,{name:"progressStatus",label:"进度状态",style:{marginBottom:"12px"},children:e.jsx(h,{mode:"multiple",placeholder:"请选择进度状态",style:{width:200},allowClear:!0,children:j.map(l=>e.jsx(N,{value:l.value,children:l.label},l.value))})}),e.jsx(o.Item,{name:"orderStatus",label:"订单状态",style:{marginBottom:"12px"},children:e.jsx(h,{mode:"multiple",placeholder:"请选择订单状态",style:{width:200},allowClear:!0,children:I.map(l=>e.jsx(N,{value:l.value,children:l.label},l.value))})}),e.jsx(o.Item,{name:"taskStatus",label:"任务状态",style:{marginBottom:"12px"},children:e.jsx(h,{mode:"multiple",placeholder:"请选择任务状态",style:{width:200},allowClear:!0,children:b.map(l=>e.jsx(N,{value:l.value,children:l.label},l.value))})}),e.jsx(o.Item,{style:{marginBottom:"12px"},children:e.jsxs(z,{children:[e.jsx(_,{type:"primary",icon:e.jsx(me,{}),onClick:w,loading:p,children:"查询"}),e.jsx(_,{icon:e.jsx(xe,{}),onClick:f,children:"重置"})]})})]}),e.jsx(Le,{orderData:x})]})})};export{Ue as default};
